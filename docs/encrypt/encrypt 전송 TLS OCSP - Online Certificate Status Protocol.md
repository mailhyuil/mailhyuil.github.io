# encrypt 전송 TLS OCSP - Online Certificate Status Protocol

## OCSP의 기본 동작 방식

```txt
클라이언트(웹 브라우저)가 서버(Nginx)에 HTTPS 요청을 보냄.
클라이언트는 해당 SSL 인증서가 유효한지 확인하기 위해 인증 기관(CA)의 OCSP 서버에 요청을 보냄.
OCSP 서버는 인증서가 유효한지, 폐기되었는지(Revoked), 만료되었는지(Expired) 확인 후 응답을 보냄.
클라이언트가 응답을 받으면, 인증서가 유효하면 SSL 연결을 유지하고, 유효하지 않으면 경고를 표시함.
```

## OCSP Stapling

```txt
서버(Nginx)는 일정 주기마다 CA의 OCSP 서버에서 인증서 상태 정보를 받아서 캐시함.
클라이언트가 HTTPS 요청을 보내면, 서버는 OCSP Stapling 응답을 포함하여 제공함.
클라이언트는 추가적인 OCSP 서버 요청 없이 서버가 제공한 정보로 인증서 유효성을 검증함.
```

### 기존 프로세스

```txt
1️⃣ 클라이언트가 서버에 접속 요청 (ClientHello)
2️⃣ 서버가 자신의 SSL/TLS 인증서를 포함한 ServerHello 응답
3️⃣ 클라이언트가 서버 인증서 검증 (여기서 CA 서버 확인)
   - 클라이언트는 서버가 제공한 인증서가 신뢰할 수 있는 CA에서 발급된 것인지 확인함.
   - 만약 인증서가 유효하면 핸드셰이크를 계속 진행하고, 유효하지 않으면 TLS 연결이 종료됨.
4️⃣ 클라이언트가 서버의 공개키를 사용해 대칭키(세션키)를 암호화하여 전송
5️⃣ 서버가 자신의 개인키로 세션키를 복호화
6️⃣ 이후 데이터는 대칭키를 사용한 암호화 통신
```

### OCSP Stapling 프로세스

```txt
1️⃣ 클라이언트가 서버에 접속 요청 (ClientHello)
2️⃣ 서버가 자신의 SSL/TLS 인증서를 포함한 ServerHello 응답
3️⃣ 서버가 OCSP Stapling 응답을 포함하여 제공
4️⃣ 클라이언트는 추가적인 OCSP 서버 요청 없이 서버가 제공한 정보로 인증서 유효성을 검증함.
5️⃣ 클라이언트가 서버의 공개키를 사용해 대칭키(세션키)를 암호화하여 전송
6️⃣ 서버가 자신의 개인키로 세션키를 복호화
7️⃣ 이후 데이터는 대칭키를 사용한 암호화 통신
```
