# db 분산 시스템 CAP 정리

> CAP 정리 또는 브루어의 정리(Brewer 定理)는 다음과 같은 세 가지 조건을 모두 만족하는 분산 컴퓨터 시스템이 존재하지 않음을 증명한 정리이다.
>
> > "저렴함, 신속함, 우수함: 두 가지만 고르세요"라는 제목으로 조경이나 도장 또는 다른 업체들의 광고를 보신 적이 있으신가요?
> >
> > CAP 정리는 분산 시스템에 이와 유사한 논리를 적용한다.
> >
> > 즉, 분산 시스템은 일관성(Consistency), 가용성(Availability) 및 분할 내성(Partition tolerance)의 세 가지 원하는 특성 중 두 가지만 제공할 수 있다.
> >
> > > CAP 정리는 문제점이 존재하는 정리이며 이를 해결하기 위해서 PACELC 이론이 등장하였다.

```markdown
# 일관성(Consistency)

- 모든 노드가 같은 순간에 같은 데이터를 볼 수 있다.
- 분산 서버간의 데이터 불일치를 허용하지 않아야 한다.

# 가용성(Availability)

- 모든 요청이 성공 또는 실패 결과를 반환할 수 있다.
- 항상 서비스가 가능한 상태를 유지해야 한다.

# 분할내성(Partition tolerance)

- 메시지 전달이 실패하거나 시스템 일부가 망가져도 시스템이 계속 동작할 수 있다.
- 네트워크 파티션이 발생해도 시스템은 계속 동작해야한다.

  > 네트워크 파티션은 네트워크 상의 일부 노드들이 서로 통신할 수 없게 되는 상황 즉, 연결이 끊긴 상황

- 네트워크의 가용성에 해당하는 개념

* 분산 시스템에서는 위의 조건 중 두가지만 만족할 수 있다.
* 절대로 세 가지를 모두 만족할 수 없다.
```

## Consistency + Partition tolerance (CP)

> 완벽한 일관성을 갖는 분산 시스템을 위해서는 데이터의 변경 사항이 항상 동기적으로 모든 노드에 반영되어야 한다.
>
> > 이는 가용성과 성능에 크나큰 악영향을 끼친다. 만약 하나의 노드라고 문제가 있으면 트랜잭션은 실패한다. 그리고 노드가 늘어날 수록 지연시간은 길어진다.

## Availability + Partition tolerance (AP)

> 완벽한 가용성을 갖는 분산 시스템에서는 모든 노드가 어떤 상황에서도 응답할 수 있어야 한다.
>
> > 네트워크 문제가 발생해서 어떤 노드에 Replication이 제대로 이루어지지 않아도 가용성을 위해서 해당 노드에 접근한 사용자에게 데이터를 반환한다고 생각해보자. 일관성이 깨진 것은 당연하고 사용자는 문제가 발생한 것을 인지도 못할 것이다.

## Consistency + Availability (CA)

> 네트워크 파티션이 발생하면 일관성과 가용성 모두를 보장할 수 없게 되므로, 이 경우는 불가능하다.
