# db 동시성 제어 lock usecase 사용 예시

## FOR SHARE

> 읽기만 하기 위해서 거는 lock
>
> > 만약 이 행을 변경할 거라면 FOR UPDATE를 사용해야 한다.

```txt
좌석을 예매하는 동안 다른 사용자가 동시에 같은 좌석을 예매하지 못하게 하고싶을 때

현재 트랜잭션은 현재 행에 대한 업데이트를 수행하지만 다른 트랜잭션은 해당 행을 참조해서 다른 작업을 수행해야할 때
만약 다른 트랜잭션이 해당 행을 참조조차 못하게 된다면 전혀 다른 작업인데도 불구하고 성능이 저하될 수 있다.
```

## FOR UPDATE

> 이 행을 변경하려고 거는 lock
>
> > 이 행을 변경하는 동안 다른 사용자가 이 행을 읽어서 다른 작업을 못하게 하고싶을 때

```txt
현재 트랜잭션이 현재 행을 업데이트하는 동안 다른 트랜잭션이 해당 행을 참조하면 안될 때
예를 들어
```

## IN SHARE MODE

> 테이블 전체를 읽기 전용으로 보호하면서 다른 트랜잭션이 테이블을 수정하지 못하도록 할 때

```txt
월간 보고서 작성 중 테이블의 데이터를 읽으면서 동시에 데이터의 수정이나 삽입을 방지할 때
```

## IN EXCLUSIVE MODE

> 특정 테이블에 대해 독점적으로 잠금하여 다른 트랜잭션이 추가적인 잠금을 걸지 못하게 할 때

```txt
대규모 데이터 마이그레이션 작업 중 다른 트랜잭션의 테이블 접근을 방지할 때
```

## IN ACCESS EXCLUSIVE MODE

> 테이블 전체에 대한 모든 작업을 차단하고자 할 때

```txt
테이블 구조 변경(예: 컬럼 추가) 시, 다른 모든 트랜잭션의 접근을 차단
```
