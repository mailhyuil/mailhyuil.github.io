"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["707441"],{931350:function(e,r,n){n.r(r),n.d(r,{frontMatter:()=>a,toc:()=>p,default:()=>m,metadata:()=>i,assets:()=>o,contentTitle:()=>l});var i=JSON.parse('{"id":"nestjs/nest base pipe image-upload","title":"nest base pipe image-upload","description":"large, medium, small\uC744 \uBC30\uC5F4\uB85C \uBC18\uD658\uD558\uB294 \uC774\uC720","source":"@site/docs/nestjs/nest base pipe image-upload.md","sourceDirName":"nestjs","slug":"/nestjs/nest base pipe image-upload","permalink":"/docs/nestjs/nest base pipe image-upload","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest image resize (sharp)","permalink":"/docs/nestjs/nest base pipe image-resize - sharp"},"next":{"title":"pipe","permalink":"/docs/nestjs/nest base pipe"}}'),s=n(447259),t=n(255511);let a={},l="nest base pipe image-upload",o={},p=[{value:"image-upload.pipe.ts",id:"image-uploadpipets",level:2}];function c(e){let r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"nest-base-pipe-image-upload",children:"nest base pipe image-upload"})}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"large, medium, small\uC744 \uBC30\uC5F4\uB85C \uBC18\uD658\uD558\uB294 \uC774\uC720"}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"\uC774\uBBF8\uC9C0 \uD06C\uAE30\uB97C \uB7F0\uD0C0\uC784\uC5D0 \uB3D9\uC801\uC73C\uB85C \uCC98\uB9AC\uD558\uAE30\uAC00 \uC27D\uB2E4"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"image-uploadpipets",children:"image-upload.pipe.ts"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { Injectable, PipeTransform } from "@nestjs/common";\r\nimport { CreateImageDTO } from "../app/file/file.dto";\r\nimport { FileService } from "../app/file/file.service";\r\nimport { PrismaService } from "../prisma/prisma.service";\r\nimport { hashFile } from "../utils/hash-file";\r\n\r\n@Injectable()\r\nexport class ImageUploadPipe implements PipeTransform<Express.Multer.File[], Promise<CreateImageDTO>> {\r\n  constructor(private readonly fileService: FileService, private readonly prisma: PrismaService) {}\r\n  async transform(files: Express.Multer.File[]): Promise<CreateImageDTO> {\r\n    if (!files) return undefined;\r\n    if (!(files instanceof Array)) return;\r\n    const found = await this.prisma.image.findUnique({\r\n      where: {\r\n        originalUrl: await this.fileService.createUrl(files[0]),\r\n      },\r\n      select: {\r\n        hash: true,\r\n      },\r\n    });\r\n    if (found?.hash === (await hashFile(files[0]))) return undefined;\r\n    return await this.fileService.uploadImage(files);\r\n  }\r\n}\n'})})]})}function m(e={}){let{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},255511:function(e,r,n){n.d(r,{R:()=>a,x:()=>l});var i=n(596363);let s={},t=i.createContext(s);function a(e){let r=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:r},e.children)}}}]);