"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["146800"],{791511:function(e,r,s){s.r(r),s.d(r,{frontMatter:()=>d,toc:()=>a,default:()=>l,metadata:()=>t,assets:()=>c,contentTitle:()=>p});var t=JSON.parse('{"id":"db-postgres/postgres backup docker","title":"docker postgresql script backup and upload s3","description":"pg_dump","source":"@site/docs/db-postgres/postgres backup docker.md","sourceDirName":"db-postgres","slug":"/db-postgres/postgres backup docker","permalink":"/docs/db-postgres/postgres backup docker","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"postgres backup barman","permalink":"/docs/db-postgres/postgres backup barmand"},"next":{"title":"postgres WAL \uC544\uCE74\uC774\uBE0C pg_basebackup","permalink":"/docs/db-postgres/postgres backup pg_basebackup"}}'),n=s(447259),o=s(255511);let d={},p="docker postgresql script backup and upload s3",c={},a=[{value:"pg_dump",id:"pg_dump",level:2}];function u(e){let r={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"docker-postgresql-script-backup-and-upload-s3",children:"docker postgresql script backup and upload s3"})}),"\n",(0,n.jsx)(r.h2,{id:"pg_dump",children:"pg_dump"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-sh",children:'#!/bin/bash\r\n\r\nDEL_FILE=$(date -d \'30 day ago\' +\'%Y-%m-%d_\')"*.dump"\r\nFILENAME=$(date +"%Y-%m-%d_%H%M").dump\r\nBACKUP_DIR=/home/ubuntu/db_backup\r\nUSERNAME=username\r\nDB_NAME=dbname\r\nPASSWORD=password\r\nENDPOINT_URL=https://kr1-api-object-storage.nhncloudservice.com\r\nCONTAINER_NAME=postgres\r\nBUCKET_NAME=db-backup\r\n\r\ncd $BACKUP_DIR\r\n\r\n#----- DUMP BACKUP_FILE -----\r\necho "DB backup start time : " $(date +"%Y-%m-%d %H:%M:%S")\r\nPGPASSWORD=$PASSWORD sudo docker exec $CONTAINER_NAME pg_dump -U $USERNAME $DB_NAME -Fc -v > "${BACKUP_DIR}/${DB_NAME}_${FILENAME}"\r\necho "Successful db backup ( ${BACKUP_DIR}/${DB_NAME}_${FILENAME} )"\r\n\r\n#----- COPY TO S3 -----\r\nsudo aws --endpoint-url=${ENDPOINT_URL} s3 cp "${BACKUP_DIR}/${DB_NAME}_${FILENAME}" s3://${BUCKET_NAME}/${DB_NAME}_${FILENAME}\r\n\r\n#----- DELETE AFTER 30 DAYS -----\r\necho "Delete old file ${DB_NAME}_${DEL_FILE}"\r\nsudo rm "${BACKUP_DIR}/${DB_NAME}_${DEL_FILE}"\r\necho "BACKUP - End time : " $(date +"%Y-%m-%d %H:%M:%S")\n'})})]})}function l(e={}){let{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},255511:function(e,r,s){s.d(r,{R:()=>d,x:()=>p});var t=s(596363);let n={},o=t.createContext(n);function d(e){let r=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function p(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);