"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[553006],{274475:(r,e,t)=>{t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>s,default:()=>g,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"grpc/grpc \ud1b5\uc2e0 \ubc29\uc2dd bi-directional streaming","title":"grpc bi-directional streaming","description":"proto","source":"@site/docs/grpc/grpc \ud1b5\uc2e0 \ubc29\uc2dd bi-directional streaming.md","sourceDirName":"grpc","slug":"/grpc/grpc \ud1b5\uc2e0 \ubc29\uc2dd bi-directional streaming","permalink":"/docs/grpc/grpc \ud1b5\uc2e0 \ubc29\uc2dd bi-directional streaming","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"grpc proto","permalink":"/docs/grpc/grpc proto \ubb38\ubc95"},"next":{"title":"grpc client streaming","permalink":"/docs/grpc/grpc \ud1b5\uc2e0 \ubc29\uc2dd client streaming"}}');var i=t(447259),o=t(529087);const c={},s="grpc bi-directional streaming",a={},l=[{value:"proto",id:"proto",level:2},{value:"server",id:"server",level:2},{value:"client",id:"client",level:2}];function d(r){const e={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,o.R)(),...r.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"grpc-bi-directional-streaming",children:"grpc bi-directional streaming"})}),"\n",(0,i.jsx)(e.h2,{id:"proto",children:"proto"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-proto",children:"service GreetService {\r\n  rpc SayHello (stream HelloRequest) returns (stream HelloReply) {}\r\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"server",children:"server"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (*Server) GreetEveryone(stream pb.GreetService_GreetEveryoneServer) error {\r\n\tlog.Println("GreetEveryone was invoked")\r\n\r\n\tfor {\r\n\t\treq, err := stream.Recv()\r\n\r\n\t\tif err == io.EOF {\r\n\t\t\treturn nil\r\n\t\t}\r\n\r\n\t\tif err != nil {\r\n\t\t\tlog.Fatalf("Error while reading client stream: %v\\n", err)\r\n\t\t}\r\n\r\n\t\tres := "Hello " + req.FirstName + "!"\r\n\r\n\t\terr = stream.Send(&pb.GreetResponse{\r\n\t\t\tResult: res,\r\n\t\t})\r\n\r\n\t\tif err != nil {\r\n\t\t\tlog.Fatalf("Error while sending data to client: %v\\n", err)\r\n\t\t}\r\n\t}\r\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"client",children:"client"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func doGreetEveryone(c pb.GreetServiceClient) {\r\n\tlog.Println("doGreetEveryone was invoked")\r\n\r\n\tstream, err := c.GreetEveryone(context.Background())\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatalf("Error while creating stream: %v\\n", err)\r\n\t}\r\n\r\n\trequests := []*pb.GreetRequest{\r\n\t\t{FirstName: "Clement"},\r\n\t\t{FirstName: "Marie"},\r\n\t\t{FirstName: "Test"},\r\n\t}\r\n\r\n\twaitc := make(chan struct{})\r\n\tgo func() {\r\n\t\tfor _, req := range requests {\r\n\t\t\tlog.Printf("Sending message: %v\\n", req)\r\n\t\t\tstream.Send(req)\r\n\t\t\ttime.Sleep(1 * time.Second)\r\n\t\t}\r\n\t\tstream.CloseSend()\r\n\t}()\r\n\r\n\tgo func() {\r\n\t\tfor {\r\n\t\t\tres, err := stream.Recv()\r\n\t\t\tif err == io.EOF {\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tif err != nil {\r\n\t\t\t\tlog.Printf("Error while receiving: %v\\n", err)\r\n\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t\tlog.Printf("Received: %v\\n", res.Result)\r\n\t\t}\r\n\t\tclose(waitc)\r\n\t}()\r\n\r\n\t<-waitc\r\n}\n'})})]})}function g(r={}){const{wrapper:e}={...(0,o.R)(),...r.components};return e?(0,i.jsx)(e,{...r,children:(0,i.jsx)(d,{...r})}):d(r)}},529087:(r,e,t)=>{t.d(e,{R:()=>c,x:()=>s});var n=t(596363);const i={},o=n.createContext(i);function c(r){const e=n.useContext(o);return n.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function s(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(i):r.components||i:c(r.components),n.createElement(o.Provider,{value:e},r.children)}}}]);