"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["350345"],{52074:function(e,r,n){n.r(r),n.d(r,{frontMatter:()=>a,toc:()=>d,default:()=>h,metadata:()=>o,assets:()=>i,contentTitle:()=>l});var o=JSON.parse('{"id":"nodejs/nodejs module multicore worker_threads","title":"node worker_threads","description":"worker_threads\uC758 \uAC00\uC7A5 \uC911\uC694\uD55C \uBAA9\uD45C\uB294 I/O \uC791\uC5C5\uC774 \uC544\uB2CC CPU \uC9D1\uC57D\uC801\uC778 \uC791\uC5C5\uC758 \uD37C\uD3EC\uBA3C\uC2A4\uB97C \uD5A5\uC0C1\uC2DC\uD0A4\uB294 \uAC81\uB2C8\uB2E4.","source":"@site/docs/nodejs/nodejs module multicore worker_threads.md","sourceDirName":"nodejs","slug":"/nodejs/nodejs module multicore worker_threads","permalink":"/docs/nodejs/nodejs module multicore worker_threads","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"node worker_threads","permalink":"/docs/nodejs/nodejs module multicore worker_threads workerpool"},"next":{"title":"nodejs module net (TCP)","permalink":"/docs/nodejs/nodejs module net - TCP"}}'),s=n(447259),t=n(255511);let a={},l="node worker_threads",i={},d=[{value:"import",id:"import",level:2},{value:"usage",id:"usage",level:2},{value:"main.js",id:"mainjs",level:3},{value:"job.js",id:"jobjs",level:3},{value:"sample",id:"sample",level:2}];function c(e){let r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"node-worker_threads",children:"node worker_threads"})}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"worker_threads\uC758 \uAC00\uC7A5 \uC911\uC694\uD55C \uBAA9\uD45C\uB294 I/O \uC791\uC5C5\uC774 \uC544\uB2CC CPU \uC9D1\uC57D\uC801\uC778 \uC791\uC5C5\uC758 \uD37C\uD3EC\uBA3C\uC2A4\uB97C \uD5A5\uC0C1\uC2DC\uD0A4\uB294 \uAC81\uB2C8\uB2E4."}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"parallel threading\uB97C \uAD6C\uD604"}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"\uAC01 \uCF54\uC5B4\uC5D0\uC11C thread\uB97C \uC0DD\uC131\uD574\uC11C \uC791\uC5C5 \uAC00\uB2A5"}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"javascript thread\uB97C \uBA40\uD2F0\uCF54\uC5B4\uC5D0\uC11C \uC2E4\uD589\uD558\uB294 \uAC83 (nodejs \uC571\uC740 \uD558\uB098)"}),"\n",(0,s.jsx)(r.p,{children:"\uC0C8\uB85C\uC6B4 thread\uB97C \uC0DD\uC131\uD574\uC11C \uADF8 \uC704\uC5D0 v8 \uC5D4\uC9C4\uC744 \uC62C\uB824\uC11C \uC2E4\uD589\uD558\uB294 \uAC83"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"import",children:"import"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'const { Worker } = require("worker_threads");\r\n\r\nconst { isMainThread, workerPort, parentPort, MessageChannel, workerData } = require("worker_threads");\r\n\r\nconst worker = new Worker("./job.js", {\r\n  workerData: { data: "hi" }, // worker\uC5D0\uAC8C \uC804\uB2EC\uD560 \uB370\uC774\uD130\r\n}); // worker \uC0DD\uC131\r\n\r\nparentPort.postMessage("message"); // worker\uC5D0\uAC8C \uBA54\uC2DC\uC9C0 \uC804\uB2EC\r\nworkerPort.postMessage("message"); // main\uC5D0\uAC8C \uBA54\uC2DC\uC9C0 \uC804\uB2EC\n'})}),"\n",(0,s.jsx)(r.h2,{id:"usage",children:"usage"}),"\n",(0,s.jsx)(r.h3,{id:"mainjs",children:"main.js"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'const { Worker, isMainThread, parentPort } = require("worker_threads");\r\n\r\nconst main = async () => {\r\n  try {\r\n    const start = Date.now();\r\n    const values = await Promise.all([work(1), work(2), work(3)]);\r\n    console.log(values);\r\n    console.log(`done! total duration : ${Date.now() - start}ms`);\r\n  } catch (error) {\r\n    console.log(error);\r\n  }\r\n};\r\n\r\nconst work = async id => {\r\n  return new Promise((resolve, reject) => {\r\n    const start = Date.now();\r\n    // worker \uC0DD\uC131\r\n    const worker = new Worker("./job.js", {\r\n      workerData: { id },\r\n    });\r\n    // worker\uC5D0\uC11C parentPort.postMessage\uB85C \uBCF4\uB0B8 \uBA54\uC2DC\uC9C0\uB97C \uBC1B\uC74C\r\n    worker.once("message", message => {\r\n      console.log(`threadId : [${worker.threadId}] duration : ${Date.now() - start}ms`);\r\n      resolve(message);\r\n    });\r\n\r\n    worker.once("error", error => {\r\n      reject(error);\r\n    });\r\n  });\r\n};\r\n\r\nmain();\n'})}),"\n",(0,s.jsx)(r.h3,{id:"jobjs",children:"job.js"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-js",children:'const process = require("process");\r\nconst { parentPort, workerData } = require("worker_threads");\r\n\r\nfor (let i = 0; i < 1000000; i++) {\r\n  console.log(`i\'m a worker [${workerData.id}] in pid [${process.pid}]!`);\r\n}\r\n\r\nparentPort.postMessage(`worker [${workerData.id}] done`);\n'})}),"\n",(0,s.jsx)(r.h2,{id:"sample",children:"sample"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'const { Worker, isMainThread, parentPort } = require("worker_threads");\r\n\r\nif (isMainThread) {\r\n  console.time("start");\r\n  const worker = new Worker(__filename); // worker \uC0DD\uC131\r\n\r\n  worker.on("message", message => {\r\n    console.log("from worker", message);\r\n    console.timeEnd("start");\r\n  });\r\n  worker.on("error", message => console.error(message));\r\n  worker.on("exit", message => console.log("worker exit", message));\r\n\r\n  console.log("i\'m main");\r\n  let count = 0;\r\n  console.time("hi");\r\n  for (let i = 0; i < 10000000000; i++) {\r\n    count++;\r\n  }\r\n  console.timeEnd("hi");\r\n} else {\r\n  console.log("i\'m worker");\r\n  let count = 0;\r\n  console.time("hi");\r\n  for (let i = 0; i < 10000000000; i++) {\r\n    count++;\r\n  }\r\n  console.timeEnd("hi");\r\n\r\n  parentPort.postMessage(count);\r\n}\n'})})]})}function h(e={}){let{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},255511:function(e,r,n){n.d(r,{R:()=>a,x:()=>l});var o=n(596363);let s={},t=o.createContext(s);function a(e){let r=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(t.Provider,{value:r},e.children)}}}]);