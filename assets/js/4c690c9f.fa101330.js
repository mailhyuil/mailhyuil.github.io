"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[187925],{253004:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>i,contentTitle:()=>c,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"javascript/js race condition - \uacbd\uc7c1\uc0c1\ud0dc","title":"js \uacbd\uc7c1 \uc0c1\ud0dc","description":"task1\uc774 x\uac12\uc744 0\uc5d0\uc11c 1\ub85c \uc99d\uac00\uc2dc\ud0a4\uace0 \\"\uc800\uc7a5\ud558\uae30 \uc9c1\uc804\\"\uc5d0, task2\uac00 \uc99d\uac00\ub418\uae30 \uc9c1\uc804\uc758 \uac12\uc778 0\uc744 \uc77d\uc5b4\uc640\uc11c 1\ub85c \uc99d\uac00\uc2dc\ud0a8\ub2e4\uba74","source":"@site/docs/javascript/js race condition - \uacbd\uc7c1\uc0c1\ud0dc.md","sourceDirName":"javascript","slug":"/javascript/js race condition - \uacbd\uc7c1\uc0c1\ud0dc","permalink":"/docs/javascript/js race condition - \uacbd\uc7c1\uc0c1\ud0dc","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"js queueMicrotask","permalink":"/docs/javascript/js queueMicrotask"},"next":{"title":"js regex","permalink":"/docs/javascript/js regex"}}');var t=r(447259),s=r(529087);const a={},c="js \uacbd\uc7c1 \uc0c1\ud0dc",i={},l=[{value:"\uacbd\uc7c1 \uc0c1\ud0dc",id:"\uacbd\uc7c1-\uc0c1\ud0dc",level:2},{value:"\ud574\uacb0 \ubc29\ubc95 (mutex \uc0ac\uc6a9)",id:"\ud574\uacb0-\ubc29\ubc95-mutex-\uc0ac\uc6a9",level:2}];function u(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"js-\uacbd\uc7c1-\uc0c1\ud0dc",children:"js \uacbd\uc7c1 \uc0c1\ud0dc"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:'task1\uc774 x\uac12\uc744 0\uc5d0\uc11c 1\ub85c \uc99d\uac00\uc2dc\ud0a4\uace0 "\uc800\uc7a5\ud558\uae30 \uc9c1\uc804"\uc5d0, task2\uac00 \uc99d\uac00\ub418\uae30 \uc9c1\uc804\uc758 \uac12\uc778 0\uc744 \uc77d\uc5b4\uc640\uc11c 1\ub85c \uc99d\uac00\uc2dc\ud0a8\ub2e4\uba74'}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"x\uc758 \uacb0\uacfc\uac12\uc774 2\uac00 \uc544\ub2cc 1\uc774 \ub418\ubbc0\ub85c \uacbd\uc7c1\uc0c1\ud0dc\uac00 \ubc1c\uc0dd\ud55c \uac83\uc744 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"\uacbd\uc7c1-\uc0c1\ud0dc",children:"\uacbd\uc7c1 \uc0c1\ud0dc"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\r\n\r\nlet x = 0;\r\n\r\nconst foo = async () => {\r\n  await delay(500);\r\n  let y = x;\r\n  await delay(500); // \ube44\ub3d9\uae30 \ud568\uc218 \ud638\ucd9c\r\n  x = y + 1;\r\n  await delay(500);\r\n};\r\n\r\nconst main = async () => {\r\n  console.log(`initial x = ${x}`);\r\n  await Promise.all([foo(), foo(), foo()]);\r\n  console.log(`final x = ${x}`); // \uc138\uac1c\uc758 \ube44\ub3d9\uae30 \ud568\uc218\uac00 \uacbd\uc7c1 \uc0c1\ud0dc\uac00 \ub418\uc5b4 \uac12\uc774 1\uc774 \ub41c\ub2e4\r\n\r\n  //   await foo();\r\n  //   await foo();\r\n  //   await foo();\r\n  //   console.log(x); // \uc21c\ucc28\uc801\uc73c\ub85c \uc2e4\ud589\ud558\uba74 \uac12\uc774 3\uc774 \ub41c\ub2e4\r\n};\r\n\r\nmain();\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\ud574\uacb0-\ubc29\ubc95-mutex-\uc0ac\uc6a9",children:"\ud574\uacb0 \ubc29\ubc95 (mutex \uc0ac\uc6a9)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// mutex \uad6c\ud604\r\nconst lock = new WeakMap();\r\nasync function using(resource, then) {\r\n  while (lock.has(resource)) {\r\n    try {\r\n      await lock.get(resource);\r\n    } catch {}\r\n  }\r\n\r\n  const promise = Promise.resolve(then(resource));\r\n  lock.set(resource, promise);\r\n\r\n  try {\r\n    return await promise;\r\n  } finally {\r\n    lock.delete(resource);\r\n  }\r\n}\r\n\r\nconst delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\r\n\r\nlet x = 1;\r\nconst mutex = {};\r\n\r\nconst foo = async () => {\r\n  await delay(500);\r\n  await using(mutex, async () => {\r\n    let y = x;\r\n    await delay(500);\r\n    x = y + 1;\r\n  });\r\n  await delay(500);\r\n};\r\n\r\nasync function main() {\r\n  console.log(`initial x = ${x}`);\r\n  await Promise.all([foo(), foo(), foo()]);\r\n  console.log(`final x = ${x}`);\r\n}\r\n\r\nmain();\n"})})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(u,{...n})}):u(n)}},529087:(n,e,r)=>{r.d(e,{R:()=>a,x:()=>c});var o=r(596363);const t={},s=o.createContext(t);function a(n){const e=o.useContext(s);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),o.createElement(s.Provider,{value:e},n.children)}}}]);