"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[472894],{529087:(r,e,n)=>{n.d(e,{R:()=>c,x:()=>a});var s=n(596363);const o={},t=s.createContext(o);function c(r){const e=s.useContext(t);return s.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function a(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(o):r.components||o:c(r.components),s.createElement(t.Provider,{value:e},r.children)}},588755:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>i,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"nodejs/nodejs module multicore worker_threads in child_process - \uc790\uc2dd \ud504\ub85c\uc138\uc2a4\uc5d0\uc11c \uba40\ud2f0 \uc2a4\ub808\ub529","title":"node worker_threads in child_process (\uc790\uc2dd \ud504\ub85c\uc138\uc2a4\uc5d0\uc11c \uba40\ud2f0 \uc2a4\ub808\ub529)","description":"\uc790\uc2dd \ud504\ub85c\uc138\uc2a4\ub97c \uc0dd\uc131\ud558\uace0 \uadf8 \uc548\uc5d0\uc11c worker_threads\ub97c \uc0ac\uc6a9\ud558\uc5ec \uba40\ud2f0 \uc2a4\ub808\ub529\uc744 \uad6c\ud604\ud558\ub294 \ubc29\ubc95","source":"@site/docs/nodejs/nodejs module multicore worker_threads in child_process - \uc790\uc2dd \ud504\ub85c\uc138\uc2a4\uc5d0\uc11c \uba40\ud2f0 \uc2a4\ub808\ub529.md","sourceDirName":"nodejs","slug":"/nodejs/nodejs module multicore worker_threads in child_process - \uc790\uc2dd \ud504\ub85c\uc138\uc2a4\uc5d0\uc11c \uba40\ud2f0 \uc2a4\ub808\ub529","permalink":"/docs/nodejs/nodejs module multicore worker_threads in child_process - \uc790\uc2dd \ud504\ub85c\uc138\uc2a4\uc5d0\uc11c \uba40\ud2f0 \uc2a4\ub808\ub529","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"node worker_threads SharedArrayBuffer & Atomics","permalink":"/docs/nodejs/nodejs module multicore worker_threads SharedArrayBuffer & Atomics"},"next":{"title":"piscina","permalink":"/docs/nodejs/nodejs module multicore worker_threads piscina"}}');var o=n(447259),t=n(529087);const c={},a="node worker_threads in child_process (\uc790\uc2dd \ud504\ub85c\uc138\uc2a4\uc5d0\uc11c \uba40\ud2f0 \uc2a4\ub808\ub529)",i={},d=[{value:"main.js",id:"mainjs",level:2},{value:"child.js",id:"childjs",level:2},{value:"single worker",id:"single-worker",level:3},{value:"multi workers",id:"multi-workers",level:3},{value:"worker.js",id:"workerjs",level:2}];function l(r){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.R)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"node-worker_threads-in-child_process-\uc790\uc2dd-\ud504\ub85c\uc138\uc2a4\uc5d0\uc11c-\uba40\ud2f0-\uc2a4\ub808\ub529",children:"node worker_threads in child_process (\uc790\uc2dd \ud504\ub85c\uc138\uc2a4\uc5d0\uc11c \uba40\ud2f0 \uc2a4\ub808\ub529)"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\uc790\uc2dd \ud504\ub85c\uc138\uc2a4\ub97c \uc0dd\uc131\ud558\uace0 \uadf8 \uc548\uc5d0\uc11c worker_threads\ub97c \uc0ac\uc6a9\ud558\uc5ec \uba40\ud2f0 \uc2a4\ub808\ub529\uc744 \uad6c\ud604\ud558\ub294 \ubc29\ubc95"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"main process\uc640 \uaca9\ub9ac\uc2dc\ud0b4\uacfc \ub3d9\uc2dc\uc5d0 cpu-intensive\ud55c \uc791\uc5c5\uc744 \ubcd1\ub82c\ub85c \ucc98\ub9ac\ud560 \uc218 \uc788\uc74c"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"mainjs",children:"main.js"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'const { fork } = require("child_process");\r\n\r\n// \uc790\uc2dd \ud504\ub85c\uc138\uc2a4 \uc2e4\ud589\r\nconst child = fork("./child.js");\r\n\r\nchild.on("message", message => {\r\n  console.log("main got message:", message);\r\n});\r\n\r\n// \uc790\uc2dd \ud504\ub85c\uc138\uc2a4\uc5d0 \uc791\uc5c5 \uc694\uccad\r\nchild.send({ num: 100 });\n'})}),"\n",(0,o.jsx)(e.h2,{id:"childjs",children:"child.js"}),"\n",(0,o.jsx)(e.h3,{id:"single-worker",children:"single worker"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'const { Worker } = require("worker_threads");\r\n\r\n// \ubd80\ubaa8 \ud504\ub85c\uc138\uc2a4\ub85c\ubd80\ud130 \uba54\uc2dc\uc9c0 \ubc1b\uae30\r\nprocess.on("message", message => {\r\n  const { num } = message;\r\n  if (num) {\r\n    // \uc6cc\ucee4 \uc2a4\ub808\ub4dc \uc2e4\ud589\r\n    const worker = new Worker(`./worker.js`, {\r\n      workerData: {\r\n        num,\r\n      },\r\n    });\r\n\r\n    worker.on("message", data => {\r\n      console.log("child got data:", data);\r\n      process.send(data); // \ubd80\ubaa8 \ud504\ub85c\uc138\uc2a4\ub85c \uacb0\uacfc \uc804\uc1a1\r\n    });\r\n  }\r\n  process.exit(0);\r\n});\n'})}),"\n",(0,o.jsx)(e.h3,{id:"multi-workers",children:"multi workers"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'const { Worker } = require("worker_threads");\r\n\r\n// \ubd80\ubaa8 \ud504\ub85c\uc138\uc2a4\ub85c\ubd80\ud130 \uba54\uc2dc\uc9c0 \ubc1b\uae30\r\nprocess.on("message", async message => {\r\n  const { num } = message;\r\n  if (num) {\r\n    const worker1Promise = calculate("./worker.js", 0, num / 2);\r\n    const worker2Promise = calculate("./worker.js", num / 2, num);\r\n    const result = await Promise.all([worker1Promise, worker2Promise]);\r\n    const sum = result.reduce((acc, cur) => acc + cur.result, 0);\r\n    process.send(sum);\r\n  }\r\n  process.exit(0);\r\n});\r\n\r\nfunction calculate(workerPath, start, end) {\r\n  return new Promise((resolve, reject) => {\r\n    const worker = new Worker(workerPath, {\r\n      workerData: {\r\n        start,\r\n        end,\r\n      },\r\n    });\r\n    const handleError = error => {\r\n      console.error(error);\r\n      reject(error);\r\n    };\r\n    worker.addListener("error", handleError);\r\n    const handlerMessage = data => {\r\n      resolve(data); // \ubd80\ubaa8 \ud504\ub85c\uc138\uc2a4\ub85c \uacb0\uacfc \uc804\uc1a1\r\n      worker.removeListener("message", handlerMessage);\r\n      worker.removeListener("error", handleError);\r\n    };\r\n    // message \uc774\ubca4\ud2b8 \uc0ac\uc6a9 \uc2dc \uac12\uc744 \ubcf5\uc0ac\ud558\uc5ec \uc804\ub2ec (SharedArrayBuffer\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc131\ub2a5\uc744 \ud5a5\uc0c1\uc2dc\ud0ac \uc218 \uc788\uc74c)\r\n    worker.addListener("message", handlerMessage);\r\n  });\r\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"workerjs",children:"worker.js"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'const { isMainThread, parentPort, workerData } = require("worker_threads");\r\n\r\nif (isMainThread) {\r\n  console.log("\uc774 \ud30c\uc77c\uc740 \uc9c1\uc811 \uc2e4\ud589\ud558\ub294 \uac8c \uc544\ub2c8\ub77c child_process\uc5d0\uc11c \uc2e4\ud589\ud574\uc57c \ud568.");\r\n  process.exit(1);\r\n}\r\n\r\nconst { num } = workerData;\r\nconsole.log("worker got data:", num);\r\nif (num) {\r\n  console.log("worker start");\r\n  let sum = 0;\r\n  // CPU \uc9d1\uc911 \uc5f0\uc0b0\r\n  for (let i = 0; i < num; i++) {\r\n    sum += i;\r\n  }\r\n  console.log("worker end");\r\n  parentPort.postMessage({ result: sum });\r\n}\n'})})]})}function u(r={}){const{wrapper:e}={...(0,t.R)(),...r.components};return e?(0,o.jsx)(e,{...r,children:(0,o.jsx)(l,{...r})}):l(r)}}}]);