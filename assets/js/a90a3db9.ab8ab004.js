"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[181770],{262959:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>i});const o=JSON.parse('{"id":"angular/angular form ControlValueAccessor directive","title":"angular form ControlValueAccessor directive","description":"hostDirective\ub85c \uc0ac\uc6a9","source":"@site/docs/angular/angular form ControlValueAccessor directive.md","sourceDirName":"angular","slug":"/angular/angular form ControlValueAccessor directive","permalink":"/docs/angular/angular form ControlValueAccessor directive","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"angular file","permalink":"/docs/angular/angular file"},"next":{"title":"angular ControlValueAccessor","permalink":"/docs/angular/angular form ControlValueAccessor"}}');var t=n(447259),s=n(529087);const a={},l="angular form ControlValueAccessor directive",c={},i=[{value:"value-accessor.directive.ts",id:"value-accessordirectivets",level:2},{value:"component.ts",id:"componentts",level:2},{value:"component.html",id:"componenthtml",level:2}];function u(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"angular-form-controlvalueaccessor-directive",children:"angular form ControlValueAccessor directive"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"hostDirective\ub85c \uc0ac\uc6a9"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"value-accessordirectivets",children:"value-accessor.directive.ts"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { Directive, forwardRef, OnDestroy } from "@angular/core";\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from "@angular/forms";\r\nimport { Subject } from "rxjs";\r\n\r\n@Directive({\r\n  standalone: true,\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => ValueAccessorDirective),\r\n      multi: true,\r\n    },\r\n  ],\r\n})\r\nexport class ValueAccessorDirective<T> implements ControlValueAccessor, OnDestroy {\r\n  private onChange = () => {};\r\n  private onTouched = () => {};\r\n  private valueSubject = new Subject<T>();\r\n  private disabledSubject = new Subject<boolean>();\r\n  readonly value = this.valueSubject.asObservable();\r\n  readonly disabled = this.disabledSubject.asObservable();\r\n\r\n  ngOnDestroy(): void {\r\n    this.valueSubject.complete();\r\n    this.disabledSubject.complete();\r\n  }\r\n\r\n  valueChange(v: T) {\r\n    this.onChange(v);\r\n  }\r\n\r\n  touchedChange(v: boolean) {\r\n    this.onTouched(v);\r\n  }\r\n\r\n  writeValue(obj: any): void {\r\n    this.valueSubject.next(obj);\r\n  }\r\n\r\n  registerOnChange(fn: any): void {\r\n    this.onChange = fn;\r\n  }\r\n\r\n  registerOnTouched(fn: any): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {\r\n    this.disabledSubject.next(isDisabled);\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"componentts",children:"component.ts"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"ValueAccessorDirective<T>\ub85c inject\ud558\uc5ec \uc0ac\uc6a9"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { CommonModule } from "@angular/common";\r\nimport { Component, OnInit, inject } from "@angular/core";\r\nimport { ValueAccessorDirective } from "../../directives/value-accessor.directive";\r\nimport { AbstractControl, FormsModule, NgControl } from "@angular/forms";\r\n\r\n@Component({\r\n  selector: "app-some",\r\n  templateUrl: "./some.component.html",\r\n  styleUrls: ["./some.component.scss"],\r\n  standalone: true,\r\n  imports: [CommonModule, FormsModule, ErrorMessageComponent],\r\n  hostDirectives: [ValueAccessorDirective],\r\n})\r\nexport default class SomeComponent {\r\n  value?: string;\r\n\r\n  ngControl = inject(NgControl, {\r\n    optional: true,\r\n    self: true,\r\n  });\r\n  control?: AbstractControl;\r\n\r\n  constructor(public valueAccessor: ValueAccessorDirective<string>) {\r\n    valueAccessor.value.subscribe(v => (this.value = v));\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.control = this.ngControl?.control || undefined;\r\n  }\r\n\r\n  setValue(event: any) {\r\n    const newValue = event.target.value;\r\n    this.value = newValue;\r\n    this.valueAccessor.writeValue(this.value);\r\n    this.valueAccessor.valueChange(this.value);\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"componenthtml",children:"component.html"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'<input [ngModel]="value" (ngModelChange)="setValue($event)"/>\r\n<app-error-message [control]="control" [name]="label"></app-error-message>\n'})})]})}function d(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},529087:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>l});var o=n(596363);const t={},s=o.createContext(t);function a(e){const r=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),o.createElement(s.Provider,{value:r},e.children)}}}]);