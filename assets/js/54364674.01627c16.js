"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["219737"],{226454:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>t,toc:()=>c,default:()=>a,metadata:()=>o,assets:()=>u,contentTitle:()=>d});var o=JSON.parse('{"id":"nestjs/nest advanced message queue bullMQ","title":"nest advanced message queue","description":"bullmq\uB294 \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC138\uC2A4\uB97C \uC0DD\uC131\uD574\uC8FC\uC9C0 \uC54A\uB294\uB2E4. (\uBA54\uC778 \uD504\uB85C\uC138\uC2A4\uC640 \uBD84\uB9AC\uB418\uC9C0 \uC54A\uB294\uB2E4.)","source":"@site/docs/nestjs/nest advanced message queue bullMQ.md","sourceDirName":"nestjs","slug":"/nestjs/nest advanced message queue bullMQ","permalink":"/docs/nestjs/nest advanced message queue bullMQ","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest advanced message queue","permalink":"/docs/nestjs/nest advanced message queue bullMQ concurrency"},"next":{"title":"nest rabbitMQ","permalink":"/docs/nestjs/nest advanced message queue rabbitMQ"}}'),s=r(447259),l=r(255511);let t={},d="nest advanced message queue",u={},c=[{value:"install",id:"install",level:2},{value:"app.module.ts",id:"appmodulets",level:2},{value:"audio.module.ts",id:"audiomodulets",level:2},{value:"audio.processor.ts",id:"audioprocessorts",level:2},{value:"audio.controller.ts",id:"audiocontrollerts",level:2}];function i(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"nest-advanced-message-queue",children:"nest advanced message queue"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"bullmq\uB294 \uC0C8\uB85C\uC6B4 \uD504\uB85C\uC138\uC2A4\uB97C \uC0DD\uC131\uD574\uC8FC\uC9C0 \uC54A\uB294\uB2E4. (\uBA54\uC778 \uD504\uB85C\uC138\uC2A4\uC640 \uBD84\uB9AC\uB418\uC9C0 \uC54A\uB294\uB2E4.)"}),"\n",(0,s.jsx)(n.p,{children:"\uB530\uB77C\uC11C \uB3C5\uB9BD\uB41C \uC571\uC73C\uB85C \uC2E4\uD589\uC2DC\uCF1C\uC57C \uD55C\uB2E4."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"redis \uAE30\uBC18\uC758 \uAC00\uBCBC\uC6B4 \uBA54\uC138\uC9C0 \uD050"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uC694\uCCAD\uC740 \uCC98\uB9AC\uB420 \uB54C\uAE4C\uC9C0 \uD050\uC5D0\uC11C \uB300\uAE30\uD558\uAE30 \uB54C\uBB38\uC5D0 \uC11C\uBC84\uAC00 \uB2E4\uC6B4\uB418\uC5B4\uB3C4 \uBA54\uC138\uC9C0\uAC00 \uC720\uC2E4\uB418\uC9C0 \uC54A\uB294\uB2E4."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uC11C\uBC84 \uBD80\uD558\uAC00 \uB9CE\uC740 \uC791\uC5C5\uC758 \uACBD\uC6B0 MQ\uC5D0 \uC800\uC7A5\uD574\uB450\uACE0 \uD55C\uBC88\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 \uC591\uB9CC\uD07C\uB9CC \uAC00\uC838\uC640\uC11C \uCC98\uB9AC\uD55C\uB2E4."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"@Processor()\uB85C Consumer(process)\uB97C \uC0DD\uC131\uD558\uC5EC \uADF8 \uD504\uB85C\uC138\uC2A4\uC5D0\uC11C \uC791\uC5C5\uC744 \uCC98\uB9AC\uD55C\uB2E4. (\uBA54\uC778 \uD504\uB85C\uC138\uC2A4\uC640 \uBD84\uB9AC)"}),"\n",(0,s.jsx)(n.p,{children:"@Process()\uC548\uC5D0\uC11C concurrency\uB97C \uC124\uC815\uD560 \uC218 \uC788\uB2E4. (\uB3D9\uC2DC\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 job\uC758 \uAC1C\uC218)"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"install",children:"install"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npm i bull\r\nnpm i @nestjs/bull\r\n\r\n# redis \uC124\uCE58\r\ndocker run --name redis -d -p 6379:6379 redis:latest\r\n\r\n# redis-cli\r\nnpm i -g redis-cli\r\nrdcli -h localhost -p 6379\n"})}),"\n",(0,s.jsx)(n.h2,{id:"appmodulets",children:"app.module.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { Module } from "@nestjs/common";\r\nimport { BullModule } from "@nestjs/bull";\r\n\r\n@Module({\r\n  imports: [\r\n    BullModule.forRoot({\r\n      redis: {\r\n        host: "localhost",\r\n        port: 6379,\r\n      },\r\n    }),\r\n  ],\r\n})\r\nexport class AppModule {}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"audiomodulets",children:"audio.module.ts"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"registerQueue\uAC00 \uB41C \uBAA8\uB4C8\uC5D0\uC11C\uB9CC @InjectQueue\uB97C \uC0AC\uC6A9\uD560 \uC218 \uC788\uB2E4."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { BullModule } from "@nestjs/bull";\r\nimport { Module } from "@nestjs/common";\r\nimport { AudioController } from "./audio.controller";\r\nimport { AudioProcessor } from "./audio.processor";\r\n\r\n@Module({\r\n  imports: [\r\n    BullModule.registerQueue({\r\n      name: "audio",\r\n    }),\r\n  ],\r\n  controllers: [AudioController],\r\n  providers: [AudioProcessor],\r\n})\r\nexport class AudioModule {}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"audioprocessorts",children:"audio.processor.ts"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"@Process\uC5D0 \uBC18\uB4DC\uC2DC name\uC744 \uC9C0\uC815\uD574\uB3C4 \uB418\uACE0 \uC548\uD558\uBA74 \uADF8\uB0E5 add"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"concurrency: \uB3D9\uC2DC\uC5D0 \uCC98\uB9AC\uD560 \uC218 \uC788\uB294 job\uC758 \uAC1C\uC218"}),"\n",(0,s.jsx)(n.p,{children:"concurrency\uAC00 1\uC774\uBA74 transcode job\uC740 \uD55C\uBC88\uC5D0 \uD558\uB098\uB9CC \uCC98\uB9AC\uD55C\uB2E4."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { Process, Processor } from "@nestjs/bull";\r\nimport { Logger } from "@nestjs/common";\r\nimport { Job } from "bull";\r\n\r\n@Processor("audio")\r\nexport class AudioProcessor {\r\n  private readonly logger = new Logger(AudioProcessor.name);\r\n\r\n  @Process({\r\n    name: "transcode",\r\n    concurrency: 5,\r\n  })\r\n  transcode(job: Job) {\r\n    this.logger.debug("Start transcoding...");\r\n    this.logger.debug(job.data);\r\n    this.logger.debug("Transcoding completed");\r\n  }\r\n\r\n  @OnQueueCompleted()\r\n  onCompleted(job: Job, result: any) {\r\n    this.logger.debug("onCompleted");\r\n    this.logger.debug(result);\r\n  }\r\n\r\n  @OnQueueActive()\r\n  onActive(job: Job) {\r\n    this.logger.debug("onActive");\r\n  }\r\n\r\n  @OnQueueFailed()\r\n  onFailed(job: Job, err: Error) {\r\n    this.logger.debug("onFailed");\r\n    this.logger.debug(err);\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"audiocontrollerts",children:"audio.controller.ts"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"multi worker\uB85C \uBE60\uB974\uAC8C \uCC98\uB9AC\uD558\uACE0 \uC2F6\uB2E4\uBA74 data\uB97C \uB098\uB220\uC11C \uC5EC\uB7EC\uAC1C\uC758 add\uB97C \uC0AC\uC6A9 process\uC758 concurrency\uB3C4 \uB192\uC5EC\uC57C \uD55C\uB2E4."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { InjectQueue } from "@nestjs/bull";\r\nimport { Controller, Post } from "@nestjs/common";\r\nimport { Queue } from "bull";\r\n\r\n@Controller("audio")\r\nexport class AudioController {\r\n  constructor(@InjectQueue("audio") private readonly audioQueue: Queue) {}\r\n\r\n  @Post("transcode")\r\n  async transcode() {\r\n    await this.audioQueue.add(\r\n      "transcode",\r\n      {\r\n        file: "audio.mp3",\r\n      },\r\n      {\r\n        attempts: 3,\r\n        backoff: 60000,\r\n        delay: 1000,\r\n        priority: 1,\r\n      },\r\n    );\r\n  }\r\n}\n'})})]})}function a(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},255511:function(e,n,r){r.d(n,{R:()=>t,x:()=>d});var o=r(596363);let s={},l=o.createContext(s);function t(e){let n=o.useContext(l);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),o.createElement(l.Provider,{value:n},e.children)}}}]);