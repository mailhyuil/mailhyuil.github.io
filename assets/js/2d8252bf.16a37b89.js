"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["968091"],{691207:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>s,toc:()=>a,default:()=>h,metadata:()=>o,assets:()=>l,contentTitle:()=>c});var o=JSON.parse('{"id":"nodejs/nodejs webRTC","title":"nodejs webRTC","description":"web realtime communication","source":"@site/docs/nodejs/nodejs webRTC.md","sourceDirName":"nodejs","slug":"/nodejs/nodejs webRTC","permalink":"/docs/nodejs/nodejs webRTC","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"n","permalink":"/docs/nodejs/nodejs version"},"next":{"title":"nodejs webcontainer","permalink":"/docs/nodejs/nodejs webcontainer"}}'),t=r(447259),i=r(255511);let s={},c="nodejs webRTC",l={},a=[{value:"SDP (Session Description Protocol)",id:"sdp-session-description-protocol",level:2},{value:"ICE (Interactive Connectivity Establishment)",id:"ice-interactive-connectivity-establishment",level:2},{value:"STUN (Session Traversal Utilities for NAT)",id:"stun-session-traversal-utilities-for-nat",level:2},{value:"TURN (Traversal Using Relays around NAT)",id:"turn-traversal-using-relays-around-nat",level:2},{value:"install",id:"install",level:2},{value:"\uBC31\uC5D4\uB4DC",id:"\uBC31\uC5D4\uB4DC",level:2},{value:"\uD504\uB860\uD2B8\uC5D4\uB4DC",id:"\uD504\uB860\uD2B8\uC5D4\uB4DC",level:2}];function d(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"nodejs-webrtc",children:"nodejs webRTC"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"web realtime communication"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"peer to peer(p2p) \uBC29\uC2DD\uC73C\uB85C \uC2E4\uC2DC\uAC04 \uD1B5\uC2E0\uC744 \uAC00\uB2A5\uD558\uAC8C \uD574\uC8FC\uB294 \uAE30\uC220 (\uD074\uB77C\uC774\uC5B8\uD2B8\uB4E4 \uB07C\uB9AC \uD1B5\uC2E0)"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"UDP\uB97C \uAE30\uBC18\uC73C\uB85C \uC2E4\uC2DC\uAC04 \uD1B5\uC2E0\uC744 \uAC00\uB2A5\uD558\uAC8C \uD574\uC900\uB2E4."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"nodejs\uB85C\uB294 \uCD08\uAE30 \uC815\uBCF4(ice candidate, sdp \uB4F1)\uB97C \uAD50\uD658\uD558\uB294 \uC5ED\uD560\uC744 \uD558\uB294 signaling server\uB97C \uAD6C\uD604"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"sdp-session-description-protocol",children:"SDP (Session Description Protocol)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"peerConnection.localDescription"}),"\n",(0,t.jsx)(n.li,{children:"\uBBF8\uB514\uC5B4 \uC138\uC158\uC744 \uC124\uBA85\uD558\uB294 \uD504\uB85C\uD1A0\uCF5C"}),"\n",(0,t.jsx)(n.li,{children:"\uBBF8\uB514\uC5B4 \uC720\uD615, \uD3EC\uD2B8, \uCF54\uB371, \uD574\uC0C1\uB3C4 \uB4F1\uC758 \uC815\uBCF4\uB97C \uD3EC\uD568"}),"\n",(0,t.jsx)(n.li,{children:"WebRTC\uC5D0\uC11C\uB294 SDP\uB97C \uD1B5\uD574 \uBBF8\uB514\uC5B4 \uC815\uBCF4\uB97C \uAD50\uD658"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"ice-interactive-connectivity-establishment",children:"ICE (Interactive Connectivity Establishment)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'"WebRTC \uC5F0\uACB0\uC744 \uC124\uC815\uD558\uB294 \uC804\uCCB4 \uACFC\uC815"\uC744 \uB2F4\uB2F9\uD558\uB294 \uD504\uB85C\uD1A0\uCF5C'}),"\n",(0,t.jsx)(n.li,{children:"P2P \uC5F0\uACB0\uC744 \uC704\uD55C \uCD5C\uC801\uC758 \uB124\uD2B8\uC6CC\uD06C \uACBD\uB85C\uB97C \uD0D0\uC0C9"}),"\n",(0,t.jsx)(n.li,{children:"ice-candidate\uB780 \uB124\uD2B8\uC6CC\uD06C \uC815\uBCF4(ip, port)\uB97C \uAD50\uD658\uD558\uB294 \uAC83 (\uC9C1\uC811\uAD50\uD658, STUN\uC744 \uD1B5\uD55C \uAD50\uD658, TURN\uC744 \uD1B5\uD55C \uAD50\uD658)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"stun-session-traversal-utilities-for-nat",children:"STUN (Session Traversal Utilities for NAT)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"NAT \uB4A4\uC5D0 \uC788\uB294 \uD074\uB77C\uC774\uC5B8\uD2B8\uC758 \uACF5\uC6A9 IP \uC8FC\uC18C\uB97C \uCC3E\uC544\uC11C \uBC18\uD658\uD574\uC8FC\uB294 \uC11C\uBC84"}),"\n",(0,t.jsx)(n.li,{children:"NAT \uD658\uACBD\uC5D0\uC11C \uACF5\uC6A9 IP\uB97C \uCC3E\uC544 P2P \uC5F0\uACB0\uC744 \uAC00\uB2A5\uD558\uAC8C \uD574\uC90C"}),"\n",(0,t.jsx)(n.li,{children:"[Peer A - \uC0AC\uC124 IP] \u2192 (STUN \uC11C\uBC84) \u2192 [Peer B - \uC0AC\uC124 IP]"}),"\n",(0,t.jsx)(n.li,{children:"\uBB34\uB8CC \uC11C\uBE44\uC2A4\uAC00 \uB9CE\uB2E4 (\uC9C1\uC811 \uAD6C\uCD95\uD560 \uC218\uB3C4 \uC788\uC74C)"}),"\n",(0,t.jsxs)(n.li,{children:["google STUN \uC11C\uBC84: stun",":stun",".l.google.com:19302"]}),"\n",(0,t.jsxs)(n.li,{children:["twilio STUN \uC11C\uBC84: stun",":global",".stun.twilio.com"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"turn-traversal-using-relays-around-nat",children:"TURN (Traversal Using Relays around NAT)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\uBC29\uD654\uBCBD\uC73C\uB85C \uC778\uD574 P2P \uC5F0\uACB0\uC774 \uBD88\uAC00\uB2A5\uD560 \uB54C \uC0AC\uC6A9\uD558\uB294 \uC11C\uBC84"}),"\n",(0,t.jsx)(n.li,{children:"P2P \uC5F0\uACB0\uC774 \uBD88\uAC00\uB2A5\uD560 \uB54C, TURN \uC11C\uBC84\uB97C \uD1B5\uD574 \uB370\uC774\uD130\uB97C \uC804\uB2EC"}),"\n",(0,t.jsx)(n.li,{children:"[Peer A] \u2192 (TURN \uC11C\uBC84 \uC911\uACC4) \u2192 [Peer B]"}),"\n",(0,t.jsx)(n.li,{children:"twilio, xirsys \uB4F1\uC744 \uC0AC\uC6A9 (\uB300\uBD80\uBD84 \uC720\uB8CC)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"install",children:"install"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"# \uD504\uB860\uD2B8\uC5D4\uB4DC \uC11C\uBC84\r\nnpm i socket.io-client\r\n# \uBC31\uC5D4\uB4DC \uC11C\uBC84\r\nnpm i socket.io\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\uBC31\uC5D4\uB4DC",children:"\uBC31\uC5D4\uB4DC"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Signaling Server"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"WebRTC \uD53C\uC5B4 \uAC04 \uC9C1\uC811 \uC5F0\uACB0\uD558\uAE30 \uC704\uD574 \uD544\uC694\uD55C \uC815\uBCF4\uB97C \uAD50\uD658\uD558\uB294 \uC11C\uBC84"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\uC0C1\uB300 \uBE0C\uB77C\uC6B0\uC800\uC758 ip, port, \uBC29\uD654\uBCBD, \uB77C\uC6B0\uD130 \uB4F1\uB4F1\uC758 \uC815\uBCF4\uB97C \uC54C\uB824\uC8FC\uB294 \uC11C\uBC84"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const express = require("express");\r\nconst http = require("http");\r\nconst socketIo = require("socket.io");\r\n\r\nconst app = express();\r\nconst server = http.createServer(app);\r\nconst io = socketIo(server);\r\n\r\nio.on("connection", socket => {\r\n  console.log("\uC0AC\uC6A9\uC790 \uC5F0\uACB0\uB428:", socket.id);\r\n\r\n  // \uD2B9\uC815 \uBC29 \uCC38\uAC00\r\n  socket.on("join", roomId => {\r\n    socket.join(roomId);\r\n    console.log(`\uC0AC\uC6A9\uC790 ${socket.id}\uAC00 \uBC29 ${roomId}\uC5D0 \uCC38\uAC00`);\r\n\r\n    // \uBC29\uC5D0 \uB450 \uBA85\uC774 \uC788\uC73C\uBA74 \uD1B5\uC2E0 \uC2DC\uC791\r\n    const clients = io.sockets.adapter.rooms.get(roomId);\r\n    if (clients.size === 2) {\r\n      io.to(roomId).emit("ready");\r\n    }\r\n  });\r\n\r\n  // offer(\uCD08\uAE30 \uC5F0\uACB0 \uC694\uCCAD) \uC804\uB2EC\r\n  socket.on("offer", (offer, roomId) => {\r\n    socket.to(roomId).emit("offer", offer);\r\n  });\r\n\r\n  // answer(\uC751\uB2F5) \uC804\uB2EC\r\n  socket.on("answer", (answer, roomId) => {\r\n    socket.to(roomId).emit("answer", answer);\r\n  });\r\n\r\n  // ICE candidate \uC804\uB2EC\r\n  socket.on("ice-candidate", (candidate, roomId) => {\r\n    socket.to(roomId).emit("ice-candidate", candidate);\r\n  });\r\n\r\n  socket.on("disconnect", () => {\r\n    console.log("\uC0AC\uC6A9\uC790 \uC5F0\uACB0 \uD574\uC81C:", socket.id);\r\n  });\r\n});\r\n\r\nserver.listen(3000, () => {\r\n  console.log("Signaling Server\uAC00 3000\uBC88 \uD3EC\uD2B8\uC5D0\uC11C \uC2E4\uD589 \uC911...");\r\n});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\uD504\uB860\uD2B8\uC5D4\uB4DC",children:"\uD504\uB860\uD2B8\uC5D4\uB4DC"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"mediaDevices API \uC0AC\uC6A9"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\r\n<html lang="ko">\r\n  <head>\r\n    <meta charset="UTF-8" />\r\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\r\n    <title>WebRTC P2P Video</title>\r\n  </head>\r\n  <body>\r\n    <h1>WebRTC P2P Video Chat</h1>\r\n    <video id="localVideo" autoplay playsinline></video>\r\n    <video id="remoteVideo" autoplay playsinline></video>\r\n\r\n    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"><\/script>\r\n    <script>\r\n      const socket = io("http://localhost:3000");\r\n      const roomId = "testRoom";\r\n      let localStream, peerConnection;\r\n\r\n      // STUN \uC11C\uBC84 \uC124\uC815 (\uACF5\uC6A9 STUN \uC0AC\uC6A9)\r\n      const iceServers = {\r\n        iceServers: [{ urls: "stun:stun.l.google.com:19302" }],\r\n      };\r\n\r\n      async function startVideoChat() {\r\n        // \uCE74\uBA54\uB77C \uBC0F \uB9C8\uC774\uD06C \uC2A4\uD2B8\uB9BC \uAC00\uC838\uC624\uAE30\r\n        localStream = await navigator.mediaDevices.getUserMedia({\r\n          video: true,\r\n          audio: true,\r\n        });\r\n        document.getElementById("localVideo").srcObject = localStream;\r\n\r\n        // \uBC29\uC5D0 \uCC38\uAC00\r\n        socket.emit("join", roomId);\r\n      }\r\n\r\n      // WebRTC \uC5F0\uACB0 \uC0DD\uC131\r\n      function createPeerConnection() {\r\n        peerConnection = new RTCPeerConnection(iceServers);\r\n\r\n        // \uB85C\uCEEC \uC2A4\uD2B8\uB9BC\uC744 P2P \uC5F0\uACB0\uC5D0 \uCD94\uAC00\r\n        localStream.getTracks().forEach(track => {\r\n          peerConnection.addTrack(track, localStream);\r\n        });\r\n\r\n        // ICE candidate \uC774\uBCA4\uD2B8 \uC218\uC2E0\r\n        peerConnection.onicecandidate = event => {\r\n          if (event.candidate) {\r\n            socket.emit("ice-candidate", event.candidate, roomId);\r\n          }\r\n        };\r\n\r\n        // \uC6D0\uACA9 \uC2A4\uD2B8\uB9BC \uC218\uC2E0\r\n        peerConnection.ontrack = event => {\r\n          document.getElementById("remoteVideo").srcObject = event.streams[0];\r\n        };\r\n      }\r\n\r\n      // \uC0C1\uB300\uBC29\uACFC \uC5F0\uACB0 \uC900\uBE44 \uC644\uB8CC \uC2DC\r\n      socket.on("ready", async () => {\r\n        createPeerConnection();\r\n\r\n        const offer = await peerConnection.createOffer();\r\n        await peerConnection.setLocalDescription(offer);\r\n        socket.emit("offer", offer, roomId);\r\n      });\r\n\r\n      // \uC0C1\uB300\uBC29\uC758 offer \uC218\uC2E0\r\n      socket.on("offer", async offer => {\r\n        createPeerConnection();\r\n\r\n        await peerConnection.setRemoteDescription(offer);\r\n        const answer = await peerConnection.createAnswer();\r\n        await peerConnection.setLocalDescription(answer);\r\n        socket.emit("answer", answer, roomId);\r\n      });\r\n\r\n      // \uC0C1\uB300\uBC29\uC758 answer \uC218\uC2E0\r\n      socket.on("answer", async answer => {\r\n        await peerConnection.setRemoteDescription(answer);\r\n      });\r\n\r\n      // ICE candidate \uC218\uC2E0\r\n      socket.on("ice-candidate", async candidate => {\r\n        await peerConnection.addIceCandidate(new RTCIceCandidate(candidate));\r\n      });\r\n\r\n      startVideoChat();\r\n    <\/script>\r\n  </body>\r\n</html>\n'})})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},255511:function(e,n,r){r.d(n,{R:()=>s,x:()=>c});var o=r(596363);let t={},i=o.createContext(t);function s(e){let n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);