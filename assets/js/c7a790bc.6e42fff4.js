"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["837540"],{77622:function(e,r,n){n.r(r),n.d(r,{frontMatter:()=>i,toc:()=>a,default:()=>u,metadata:()=>o,assets:()=>l,contentTitle:()=>c});var o=JSON.parse('{"id":"how to implement/\uD37C\uB110","title":"\uD37C\uB110","description":"flow.service.ts","source":"@site/docs/how to implement/\uD37C\uB110.md","sourceDirName":"how to implement","slug":"/how to implement/\uD37C\uB110","permalink":"/docs/how to implement/\uD37C\uB110","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\uD14D\uC2A4\uD2B8 \uB9C8\uC2A4\uD0B9","permalink":"/docs/how to implement/\uD14D\uC2A4\uD2B8 \uB9C8\uC2A4\uD0B9"},"next":{"title":"Java","permalink":"/docs/category/java"}}'),t=n(447259),s=n(255511);let i={},c="\uD37C\uB110",l={},a=[{value:"flow.service.ts",id:"flowservicets",level:2},{value:"payment.component.ts",id:"paymentcomponentts",level:2},{value:"form-escrow.component.ts",id:"form-escrowcomponentts",level:2}];function m(e){let r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"\uD37C\uB110",children:"\uD37C\uB110"})}),"\n",(0,t.jsx)(r.h2,{id:"flowservicets",children:"flow.service.ts"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\uD37C\uB110 flow\uB97C \uAD00\uB9AC\uD558\uB294 \uC11C\uBE44\uC2A4"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { inject, Injectable, OnDestroy } from "@angular/core";\r\nimport { ActivatedRoute, NavigationEnd, Router } from "@angular/router";\r\nimport { filter, Subscription } from "rxjs";\r\n\r\n@Injectable({\r\n  providedIn: "root",\r\n})\r\nexport class FlowService implements OnDestroy {\r\n  private pageCount: number; // \uB8E8\uD2B8 \uD398\uC774\uC9C0(payment.component)\uB85C\uBD80\uD130 \uC774\uB3D9\uD55C \uD398\uC774\uC9C0 \uC218\r\n  private router = inject(Router);\r\n  private route = inject(ActivatedRoute);\r\n  private subscriptions: Subscription[] = [];\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\r\n  }\r\n\r\n  async start(url: string) {\r\n    this.pageCount = 0;\r\n\r\n    const sub = this.router.events.pipe(filter((event) => event instanceof NavigationEnd)).subscribe((event) => {\r\n      this.pageCount++;\r\n    });\r\n    this.subscriptions.push(sub);\r\n\r\n    this.router.navigate([url], {\r\n      relativeTo: this.route,\r\n    });\r\n  }\r\n\r\n  async end() {\r\n    if (this.pageCount > 0) {\r\n      // \uB8E8\uD2B8 \uD398\uC774\uC9C0\uB85C \uC774\uB3D9 (\uB8E8\uD2B8 \uD398\uC774\uC9C0\uB85C\uBD80\uD130 \uC774\uB3D9\uD55C \uD398\uC774\uC9C0 \uC218\uB9CC\uD07C \uB4A4\uB85C\uAC00\uAE30)\r\n      window.history.go(-this.pageCount);\r\n    }\r\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"paymentcomponentts",children:"payment.component.ts"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { CommonModule } from "@angular/common";\r\nimport { Component, inject } from "@angular/core";\r\nimport { FormsModule, NonNullableFormBuilder, ReactiveFormsModule } from "@angular/forms";\r\nimport { ActivatedRoute, Router, RouterModule } from "@angular/router";\r\nimport { FlowService } from "@/client/src/services/flow.service";\r\nimport { FormEscrowComponent } from "./components/form-escrow/form-escrow.component";\r\n\r\n@Component({\r\n  selector: "app-payment",\r\n  standalone: true,\r\n  templateUrl: "./payment.component.html",\r\n  styleUrls: ["./payment.component.scss"],\r\n  imports: [CommonModule, RouterModule, FormsModule, ReactiveFormsModule, FormEscrowComponent],\r\n})\r\nexport class PaymentComponent {\r\n  isEscrowAvailable = true;\r\n  isSMSCertificationRequired = false;\r\n  isPINRequired = false;\r\n  router = inject(Router);\r\n  route = inject(ActivatedRoute);\r\n  flowService = inject(FlowService);\r\n  fb = inject(NonNullableFormBuilder);\r\n  form = this.fb.group({});\r\n\r\n  async submit() {\r\n    if (this.isEscrowAvailable) {\r\n      await this.flowService.start("escrow"); // \uC5D0\uC2A4\uD06C\uB85C \uD750\uB984 \uC2DC\uC791\uD558\uAE30\r\n    }\r\n    if (this.isSMSCertificationRequired) {\r\n      await this.flowService.start("sms"); // SMS \uC778\uC99D \uD750\uB984 \uC2DC\uC791\uD558\uAE30\r\n    }\r\n    if (this.isPINRequired) {\r\n      await this.flowService.start("payment-password"); // \uACB0\uC81C \uBE44\uBC00\uBC88\uD638 \uC785\uB825 \uD750\uB984 \uC2DC\uC791\uD558\uAE30\r\n    }\r\n    await this.confirm();\r\n  }\r\n  async confirm() {\r\n    const body = this.form.value;\r\n    console.log(body);\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"form-escrowcomponentts",children:"form-escrow.component.ts"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { CommonModule } from "@angular/common";\r\nimport { Component, inject } from "@angular/core";\r\nimport { FlowService } from "@/client/src/services/flow.service";\r\n\r\n@Component({\r\n  selector: "app-form-escrow",\r\n  templateUrl: "./form-escrow.component.html",\r\n  styleUrls: ["./form-escrow.component.scss"],\r\n  standalone: true,\r\n  imports: [CommonModule],\r\n})\r\nexport class FormEscrowComponent {\r\n  flowService = inject(FlowService);\r\n  submit() {\r\n    // do something\r\n    this.flowService.end();\r\n  }\r\n}\n'})})]})}function u(e={}){let{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}},255511:function(e,r,n){n.d(r,{R:()=>i,x:()=>c});var o=n(596363);let t={},s=o.createContext(t);function i(e){let r=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(s.Provider,{value:r},e.children)}}}]);