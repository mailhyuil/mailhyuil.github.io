"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[445495],{498834:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"x algorithm/x algorithm Bucket","title":"Bucket","description":"Leaky Bucket","source":"@site/docs/x algorithm/x algorithm Bucket.md","sourceDirName":"x algorithm","slug":"/x algorithm/x algorithm Bucket","permalink":"/docs/x algorithm/x algorithm Bucket","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Brute Force","permalink":"/docs/x algorithm/x algorithm Brute Force"},"next":{"title":"Diffing","permalink":"/docs/x algorithm/x algorithm diffing"}}');var s=t(447259),i=t(529087);const a={},l="Bucket",o={},c=[{value:"Leaky Bucket",id:"leaky-bucket",level:2},{value:"usage \uc911\uc778 \ud50c\ub7ab\ud3fc",id:"usage-\uc911\uc778-\ud50c\ub7ab\ud3fc",level:3},{value:"Token Bucket",id:"token-bucket",level:2},{value:"usage \uc911\uc778 \ud50c\ub7ab\ud3fc",id:"usage-\uc911\uc778-\ud50c\ub7ab\ud3fc-1",level:3}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"bucket",children:"Bucket"})}),"\n",(0,s.jsx)(n.h2,{id:"leaky-bucket",children:"Leaky Bucket"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"class LeakyBucket {\r\n  constructor(maxRequestPerSec) {\r\n    this.capacity = maxRequestPerSec;\r\n    this.used = 0;\r\n    this.leakInterval = 1000 / maxRequestPerSec;\r\n    this.lastLeakTime = Date.now();\r\n  }\r\n\r\n  allow() {\r\n    this.leak();\r\n    this.used++;\r\n    if (this.used >= this.capacity) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  leak() {\r\n    const now = Date.now();\r\n    if (now > this.lastLeakTime) {\r\n      const millisSinceLastLeak = now - this.lastLeakTime;\r\n      const leaks = Math.floor(millisSinceLastLeak / this.leakInterval);\r\n      if (leaks > 0) {\r\n        if (this.used <= leaks) {\r\n          this.used = 0;\r\n        } else {\r\n          this.used -= leaks;\r\n        }\r\n        this.lastLeakTime = now;\r\n      }\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usage-\uc911\uc778-\ud50c\ub7ab\ud3fc",children:"usage \uc911\uc778 \ud50c\ub7ab\ud3fc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Amazon MWS(Maketplace WEb Service)\r\nNGINX\r\nUber-go rate limiter\r\nShopify\r\nGuava RateLimiter\n"})}),"\n",(0,s.jsx)(n.h2,{id:"token-bucket",children:"Token Bucket"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"class TokenBucket {\r\n  constructor(maxRequestPerSec) {\r\n    this.tokens = maxRequestPerSec;\r\n    this.capacity = maxRequestPerSec;\r\n    this.lastRefillTime = this.scaledTime();\r\n  }\r\n\r\n  allow() {\r\n    this.refillTokens();\r\n    if (this.tokens === 0) {\r\n      return false;\r\n    }\r\n    this.tokens--;\r\n    return true;\r\n  }\r\n\r\n  refillTokens() {\r\n    const now = this.scaledTime();\r\n    if (now > this.lastRefillTime) {\r\n      const elapsedTime = now - this.lastRefillTime;\r\n      const refill = Math.floor(elapsedTime * this.maxRequestPerSec);\r\n      this.tokens = Math.min(this.tokens + refill, this.capacity);\r\n      this.lastRefillTime = now;\r\n    }\r\n  }\r\n\r\n  scaledTime() {\r\n    return Math.floor(Date.now() / 1000);\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usage-\uc911\uc778-\ud50c\ub7ab\ud3fc-1",children:"usage \uc911\uc778 \ud50c\ub7ab\ud3fc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"AWS : API Gateway, EC2, EBS, CPU Credit\r\nSpring Cloud Netflix Zuul\r\nBucket4j\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},529087:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var r=t(596363);const s={},i=r.createContext(s);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);