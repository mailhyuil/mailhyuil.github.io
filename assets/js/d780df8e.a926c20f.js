"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[308771],{529087:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>c});var r=s(596363);const t={},o=r.createContext(t);function i(n){const e=r.useContext(o);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),r.createElement(o.Provider,{value:e},n.children)}},756657:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"cicd github actions/cicd github actions","title":"github actions","description":"\uc21c\uc11c","source":"@site/docs/cicd github actions/cicd github actions.md","sourceDirName":"cicd github actions","slug":"/cicd github actions/","permalink":"/docs/cicd github actions/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"cicd github actions uses","permalink":"/docs/cicd github actions/cicd github actions uses"},"next":{"title":"CI/CD Jenkins","permalink":"/docs/category/cicd-jenkins"}}');var t=s(447259),o=s(529087);const i={},c="github actions",l={},a=[{value:"\uc21c\uc11c",id:"\uc21c\uc11c",level:2},{value:"\ubcc0\uc218 \uc124\uc815",id:"\ubcc0\uc218-\uc124\uc815",level:2},{value:".github/workflows/deploy.yaml",id:"githubworkflowsdeployyaml",level:2},{value:"slack-notify workflow",id:"slack-notify-workflow",level:2},{value:"deploy workflow",id:"deploy-workflow",level:2}];function u(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"github-actions",children:"github actions"})}),"\n",(0,t.jsx)(e.h2,{id:"\uc21c\uc11c",children:"\uc21c\uc11c"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"1. \ub808\ud3ec\uc9c0\ud1a0\ub9ac \uc0dd\uc131\r\n2. local ssh key \uae43\ud5c8\ube0c\uc5d0 \ub4f1\ub85d (ssh-keygen isa_rsa.pub \ud30c\uc77c)\r\n3. ec2 \uc11c\ubc84 ssh key \uae43\ud5c8\ube0c\uc5d0 \ub4f1\ub85d (ssh-keygen isa_rsa.pub \ud30c\uc77c)\r\n4. ec2 git \uc124\uce58 (sudo yum install git)\r\n5. git init -> git remote add ssh_url\r\n6. output files gitignore\r\n7. \uc2ac\ub799, \ub514\uc2a4\ucf54\ub4dc \uc5f0\ub3d9\r\n8. test \ub4f1\ub4f1 \ucd94\uac00\r\n9. repository Actions \ud0ed\uc5d0\uc11c nodejs \ucd94\uac00\r\n10. \uc124\uc815\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\ubcc0\uc218-\uc124\uc815",children:"\ubcc0\uc218 \uc124\uc815"}),"\n",(0,t.jsx)(e.p,{children:"repository -> settings -> secrets and variables -> Actions"}),"\n",(0,t.jsx)(e.h2,{id:"githubworkflowsdeployyaml",children:".github/workflows/deploy.yaml"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:'name: Deploy Client\r\non:\r\n  push:\r\n    branches:\r\n      - main\r\npermissions:\r\n  contents: read\r\nenv:\r\n  SSH_USER: ubuntu\r\n  SSH_HOST: 103.218.158.175\r\n  DEPLOY_PATH: /home/ubuntu/samil-client\r\njobs:\r\n  deploy:\r\n    name: Deploy Client\r\n    runs-on: self-hosted\r\n    steps:\r\n      - uses: actions/checkout@v3\r\n        with:\r\n          fetch-depth: 0\r\n          ref: main\r\n      - name: Install and Build\r\n        run: |\r\n          yarn install\r\n          yarn build\r\n      - name: Upload files\r\n        run: |\r\n          ssh -i ./scripts/samil-key.pem -o StrictHostKeyChecking=no ${{ env.SSH_USER }}@${{ env.SSH_HOST }} "rm -rf ${{ env.DEPLOY_PATH }}/.output"\r\n          ssh -i ./scripts/samil-key.pem -o StrictHostKeyChecking=no ${{ env.SSH_USER }}@${{ env.SSH_HOST }} "mkdir ${{ env.DEPLOY_PATH }}/.output"\r\n          scp -i ./scripts/samil-key.pem -r .output ${{ env.SSH_USER }}@${{ env.SSH_HOST }}:${{ env.DEPLOY_PATH }}\r\n          scp -i ./scripts/samil-key.pem -r .env.production ${{ env.SSH_USER }}@${{ env.SSH_HOST }}:${{ env.DEPLOY_PATH }}\r\n          scp -i ./scripts/samil-key.pem -r ecosystem.config.js ${{ env.SSH_USER }}@${{ env.SSH_HOST }}:${{ env.DEPLOY_PATH }}\r\n      - name: Run Process Manager\r\n        run: |\r\n          ssh -i ./scripts/samil-key.pem -o StrictHostKeyChecking=no ${{ env.SSH_USER }}@${{ env.SSH_HOST }} "pm2 restart ${{ env.DEPLOY_PATH }}/ecosystem.config.js"\r\n          ssh -i ./scripts/samil-key.pem -o StrictHostKeyChecking=no ${{ env.SSH_USER }}@${{ env.SSH_HOST }} "pm2 save"\n'})}),"\n",(0,t.jsx)(e.h2,{id:"slack-notify-workflow",children:"slack-notify workflow"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:"on: push\r\nname: Slack Notification Demo\r\njobs:\r\n  slackNotification:\r\n    name: Slack Notification\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n      - uses: actions/checkout@v2\r\n      - name: Slack Notification\r\n        uses: rtCamp/action-slack-notify@v2\r\n        env:\r\n          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"deploy-workflow",children:"deploy workflow"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"appleboy/ssh-action \uc0ac\uc6a9"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",children:'name: deploy\r\n  on:\r\n    workflow_run:\r\n      workflow: ["test_workflow", "lint_workflow"]\r\n      types:\r\n        - completed\r\n  jobs:\r\n    deploy:\r\n      runs-on: ubuntu-latest\r\n      steps:\r\n      - name: remote-ssh\r\n        uses: appleboy/ssh-action@v0.1.8\r\n        with:\r\n          host: ${{ secrets.HOST }}\r\n          username: ${{ secrets.USERNAME }}\r\n          key: ${{ secrets.KEY }}\r\n          port: ${{ secrets.PORT }}\r\n          script: |\r\n            cd my_server\r\n            git pull\r\n            pm2 restart ecosystem.config.js\n'})})]})}function d(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(u,{...n})}):u(n)}}}]);