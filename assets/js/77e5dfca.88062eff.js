"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["143838"],{566174:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>c,toc:()=>l,default:()=>p,metadata:()=>r,assets:()=>i,contentTitle:()=>a});var r=JSON.parse('{"id":"how to implement/\uBA71\uB4F1\uD0A4","title":"\uBA71\uB4F1\uD0A4","description":"client\uC5D0\uC11C POST \uC694\uCCAD \uC2DC Header\uC5D0 Idempotency-Key\uB97C \uB123\uC5B4\uC11C \uBCF4\uB0B4\uAE30","source":"@site/docs/how to implement/\uBA71\uB4F1\uD0A4.md","sourceDirName":"how to implement","slug":"/how to implement/\uBA71\uB4F1\uD0A4","permalink":"/docs/how to implement/\uBA71\uB4F1\uD0A4","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\uB7AD\uD0B9\uC11C\uBC84","permalink":"/docs/how to implement/\uB7AD\uD0B9\uC11C\uBC84"},"next":{"title":"\uBB38\uC790 \uC778\uC99D","permalink":"/docs/how to implement/\uBB38\uC790 \uC778\uC99D - SMS \uC778\uC99D"}}'),s=t(447259),o=t(255511);let c={},a="\uBA71\uB4F1\uD0A4",i={},l=[{value:"Idempotency Database",id:"idempotency-database",level:2},{value:"angular",id:"angular",level:2},{value:"nestjs",id:"nestjs",level:2}];function d(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\uBA71\uB4F1\uD0A4",children:"\uBA71\uB4F1\uD0A4"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"client\uC5D0\uC11C POST \uC694\uCCAD \uC2DC Header\uC5D0 Idempotency-Key\uB97C \uB123\uC5B4\uC11C \uBCF4\uB0B4\uAE30"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uC11C\uBC84\uC5D0\uC11C\uB294 \uBA71\uB4F1\uD0A4\uB97C db\uC5D0 \uBA71\uB4F1\uD0A4:\uC751\uB2F5 \uD615\uC2DD\uC73C\uB85C \uC800\uC7A5 (Idempotency-Key : Response)"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uC774\uC804 \uC694\uCCAD\uACFC \uB3D9\uC77C\uD55C \uBA71\uB4F1\uD0A4\uB97C \uAC00\uC9C4 \uC694\uCCAD\uC744 \uBC1B\uC73C\uBA74 \uC11C\uBC84\uC5D0\uC11C \uC774 \uC694\uCCAD\uC744 \uC911\uBCF5\uC73C\uB85C \uD310\uB2E8\uD55C \uB4A4 \uC2E4\uC81C\uB85C \uCC98\uB9AC\uD558\uC9C0 \uC54A\uACE0 \uCCAB \uC694\uCCAD\uACFC \uAC19\uC740 \uC751\uB2F5\uC744 \uBC18\uD658\uD558\uB294 \uBC29\uC2DD"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"# HTTP HEADER\r\nIdempotency-Key: {IDEMPOTENCY_KEY}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"idempotency-database",children:"Idempotency Database"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uBA71\uB4F1\uD0A4\uB97C \uC800\uC7A5\uD558\uB294 db"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\uBA71\uB4F1\uD0A4\uC640 \uC751\uB2F5\uC744 key",":value","\uB85C \uC800\uC7A5"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prisma",children:"model Idempotency {\r\n  key String @id\r\n  response        String\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"angular",children:"angular"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'@Component({\r\n  selector: "app-some",\r\n  templateUrl: "./some.component.html",\r\n  styleUrls: ["./some.component.scss"],\r\n})\r\nexport class SomeComponent {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  post() {\r\n    const body = this.formGroup.value;\r\n    // \uBA71\uB4F1\uD0A4 \uC0DD\uC131\r\n    const idempotencyKey = uuidv4();\r\n    // \uBA71\uB4F1\uD0A4 header\uC5D0 \uCD94\uAC00\r\n    const headers = new HttpHeaders().set("Idempotency-Key", idempotencyKey);\r\n\r\n    this.http.post("some-url", body, { headers }).subscribe((res) => {\r\n      console.log(res);\r\n    });\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"nestjs",children:"nestjs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"@Injectable()\r\nexport class SomeService {\r\n  constructor(private readonly prisma: PrismaService) {}\r\n\r\n  async post(body: any, idempotencyKey: string) {\r\n    const isExist = await this.prisma.idempotency.findUnique({\r\n      where: {\r\n        key: idempotencyKey,\r\n      },\r\n    });\r\n    if (isExist) {\r\n      const exist = JSON.parse(isExist.response);\r\n      return plainToClass(SomeDto, exist);\r\n    }\r\n\r\n    const created = await this.prisma.$transaction(async (tx) => {\r\n      const created = await tx.some.create({\r\n        data: body,\r\n      });\r\n      // \uBA71\uB4F1\uD0A4 \uC800\uC7A5\r\n      await tx.idempotency.create({\r\n        data: {\r\n          key: idempotencyKey,\r\n          response: JSON.stringify(created),\r\n        },\r\n      });\r\n    });\r\n    return plainToClass(SomeDto, created);\r\n  }\r\n}\n"})})]})}function p(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},255511:function(e,n,t){t.d(n,{R:()=>c,x:()=>a});var r=t(596363);let s={},o=r.createContext(s);function c(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);