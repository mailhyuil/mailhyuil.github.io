"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[607603],{529087:(e,r,s)=>{s.d(r,{R:()=>c,x:()=>d});var n=s(596363);const t={},o=n.createContext(t);function c(e){const r=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),n.createElement(o.Provider,{value:r},e.children)}},556969:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>p,contentTitle:()=>d,default:()=>i,frontMatter:()=>c,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"db-postgres/postgres backup docker","title":"docker postgresql script backup and upload s3","description":"pg_dump","source":"@site/docs/db-postgres/postgres backup docker.md","sourceDirName":"db-postgres","slug":"/db-postgres/postgres backup docker","permalink":"/docs/db-postgres/postgres backup docker","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"postgres backup barman","permalink":"/docs/db-postgres/postgres backup barmand"},"next":{"title":"postgres WAL \uc544\uce74\uc774\ube0c pg_basebackup","permalink":"/docs/db-postgres/postgres backup pg_basebackup"}}');var t=s(447259),o=s(529087);const c={},d="docker postgresql script backup and upload s3",p={},a=[{value:"pg_dump",id:"pg_dump",level:2}];function u(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"docker-postgresql-script-backup-and-upload-s3",children:"docker postgresql script backup and upload s3"})}),"\n",(0,t.jsx)(r.h2,{id:"pg_dump",children:"pg_dump"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh",children:'#!/bin/bash\r\n\r\nDEL_FILE=$(date -d \'30 day ago\' +\'%Y-%m-%d_\')"*.dump"\r\nFILENAME=$(date +"%Y-%m-%d_%H%M").dump\r\nBACKUP_DIR=/home/ubuntu/db_backup\r\nUSERNAME=username\r\nDB_NAME=dbname\r\nPASSWORD=password\r\nENDPOINT_URL=https://kr1-api-object-storage.nhncloudservice.com\r\nCONTAINER_NAME=postgres\r\nBUCKET_NAME=db-backup\r\n\r\ncd $BACKUP_DIR\r\n\r\n#----- DUMP BACKUP_FILE -----\r\necho "DB backup start time : " $(date +"%Y-%m-%d %H:%M:%S")\r\nPGPASSWORD=$PASSWORD sudo docker exec $CONTAINER_NAME pg_dump -U $USERNAME $DB_NAME -Fc -v > "${BACKUP_DIR}/${DB_NAME}_${FILENAME}"\r\necho "Successful db backup ( ${BACKUP_DIR}/${DB_NAME}_${FILENAME} )"\r\n\r\n#----- COPY TO S3 -----\r\nsudo aws --endpoint-url=${ENDPOINT_URL} s3 cp "${BACKUP_DIR}/${DB_NAME}_${FILENAME}" s3://${BUCKET_NAME}/${DB_NAME}_${FILENAME}\r\n\r\n#----- DELETE AFTER 30 DAYS -----\r\necho "Delete old file ${DB_NAME}_${DEL_FILE}"\r\nsudo rm "${BACKUP_DIR}/${DB_NAME}_${DEL_FILE}"\r\necho "BACKUP - End time : " $(date +"%Y-%m-%d %H:%M:%S")\n'})})]})}function i(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}}}]);