"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[723323],{497342:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>i,frontMatter:()=>c,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"kubernetes/kube ControlPlane etcd snapshot - backup & restore","title":"etcd snapshot (backup & restore)","description":"trusted-ca-file, cert-file, key-file \uc778\uc99d\uc11c\uac00 \ud544\uc694","source":"@site/docs/kubernetes/kube ControlPlane etcd snapshot - backup & restore.md","sourceDirName":"kubernetes","slug":"/kubernetes/kube ControlPlane etcd snapshot - backup & restore","permalink":"/docs/kubernetes/kube ControlPlane etcd snapshot - backup & restore","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"CoreDNS & kube-dns","permalink":"/docs/kubernetes/kube ControlPlane CoreDNS & kube-dns"},"next":{"title":"etcd","permalink":"/docs/kubernetes/kube ControlPlane etcd"}}');var s=r(447259),o=r(529087);const c={},a="etcd snapshot (backup & restore)",d={},l=[{value:"Backup (snapshot save)",id:"backup-snapshot-save",level:2},{value:"Restore (snapshot restore)",id:"restore-snapshot-restore",level:2}];function p(e){const t={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"etcd-snapshot-backup--restore",children:"etcd snapshot (backup & restore)"})}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"trusted-ca-file, cert-file, key-file \uc778\uc99d\uc11c\uac00 \ud544\uc694"}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"ps -ef | grep kube | grep <option_name>"})," \uc73c\ub85c \uc778\uc99d\uc11c \uacbd\ub85c \ud655\uc778"]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"ETCDCTL_API=3 \ub294 version\uc744 \uba85\uc2dc\ud558\ub294 \uac83"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"backup-snapshot-save",children:"Backup (snapshot save)"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"# master node\uc5d0\uc11c \uc2e4\ud589\r\netcd --version\r\netcdctl version\r\n\r\n# backup\r\nETCDCTL_API=3 etcdctl \\\r\n--endpoints=https://127.0.0.1:2379 \\\r\n--cacert=<trusted-ca-file> \\\r\n--cert=<cert-file> \\\r\n--key=<key-file> \\\r\nsnapshot save <backup-file-location>\r\n\r\n# trusted-ca-file, cert-file, key-file \uc778\uc99d\uc11c \uacbd\ub85c \ud655\uc778\r\nps -ef | grep kube | grep trusted-ca-file\r\nps -ef | grep kube | grep cert-file\r\nps -ef | grep kube | grep key-file\r\n\r\n# example\r\n## backup\r\nETCDCTL_API=3 etcdctl \\\r\n--endpoints=https://127.0.0.1:2379 \\\r\n--cacert=/etc/kubernetes/pki/etcd/ca.crt \\\r\n--cert=/etc/kubernetes/pki/etcd/server.crt \\\r\n--key=/etc/kubernetes/pki/etcd/server.key \\\r\nsnapshot save /opt/snapshot-pre-boot.db\r\n\r\n## restore\r\nETCDCTL_API=3 etcdctl \\\r\n--data-dir /var/lib/etcd-from-backup \\\r\nsnapshot restore /opt/snapshot-pre-boot.db\n"})}),"\n",(0,s.jsx)(t.h2,{id:"restore-snapshot-restore",children:"Restore (snapshot restore)"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"etcdutl --data-dir <data-dir-location> snapshot restore <backup-file>\r\n# backup-file = snapshot save \uba85\ub839\uc5b4\ub85c \ubc31\uc5c5\ub41c \ud30c\uc77c\r\n# data-dir-location = restore\ub41c etcd \ub370\uc774\ud130\uac00 \uc800\uc7a5\ub420 \ub514\ub809\ud1a0\ub9ac\r\n\r\n# \ud655\uc778\r\ndocker ps -a | grep etcd\r\n\r\n# /etc/kubernetes/manifests/etcd.yaml \ud30c\uc77c\uc5d0\uc11c\r\n# hostPath.path\ub97c <data-dir-location> \uc73c\ub85c \ubcc0\uacbd\r\n# yaml \ud30c\uc77c\uc744 \ubcc0\uacbd\ud558\uba74 etcd pod\uac00 \uc7ac\uc2dc\uc791\ub418\uc5b4 etcd\uac00 \uc0c8\ub86d\uac8c \uc124\uce58\ub41c\ub2e4.\r\n- hostPath:\r\n    path: <data-dir-location>\r\n    type: DirectoryOrCreate\r\n    name: etcd-data\n"})})]})}function i(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},529087:(e,t,r)=>{r.d(t,{R:()=>c,x:()=>a});var n=r(596363);const s={},o=n.createContext(s);function c(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);