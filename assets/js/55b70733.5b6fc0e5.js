"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[822649],{529087:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var t=r(596363);const a={},s=t.createContext(a);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},684707:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"nestjs/nest advanced microservice kafka","title":"nest kafka","description":"\uc774\ubca4\ud2b8 \ube0c\ub85c\ucee4\ub294 \uba54\uc2dc\uc9c0 \ube0c\ub85c\ucee4 \uc5ed\ud560\ub3c4 \uc218\ud589\ud558\uc9c0\ub9cc consumer\uac00 \ud2b9\uc815 \uc2dc\uc810\ubd80\ud130 \uc774\ubca4\ud2b8\ub97c \ub2e4\uc2dc \uc77d\uc5b4\uac08 \uc218 \uc788\ub2e4. (\uc774\ubca4\ud2b8 \uc18c\uc2f1)","source":"@site/docs/nestjs/nest advanced microservice kafka.md","sourceDirName":"nestjs","slug":"/nestjs/nest advanced microservice kafka","permalink":"/docs/nestjs/nest advanced microservice kafka","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest gRPC","permalink":"/docs/nestjs/nest advanced microservice gRPC"},"next":{"title":"nest microservice","permalink":"/docs/nestjs/nest advanced microservice"}}');var a=r(447259),s=r(529087);const o={},i="nest kafka",c={},l=[{value:"install",id:"install",level:2},{value:"kafka.config.ts",id:"kafkaconfigts",level:2},{value:"main.ts",id:"maints",level:2},{value:"controller",id:"controller",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"nest-kafka",children:"nest kafka"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\uc774\ubca4\ud2b8 \ube0c\ub85c\ucee4\ub294 \uba54\uc2dc\uc9c0 \ube0c\ub85c\ucee4 \uc5ed\ud560\ub3c4 \uc218\ud589\ud558\uc9c0\ub9cc consumer\uac00 \ud2b9\uc815 \uc2dc\uc810\ubd80\ud130 \uc774\ubca4\ud2b8\ub97c \ub2e4\uc2dc \uc77d\uc5b4\uac08 \uc218 \uc788\ub2e4. (\uc774\ubca4\ud2b8 \uc18c\uc2f1)"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"install",children:"install"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"npm i @nestjs/microservices\r\nnpm i kafkajs\n"})}),"\n",(0,a.jsx)(n.h2,{id:"kafkaconfigts",children:"kafka.config.ts"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { KafkaOptions, Transport } from "@nestjs/microservices";\r\n\r\nexport const kafkaConfig: KafkaOptions = {\r\n  transport: Transport.KAFKA,\r\n  options: {\r\n    client: {\r\n      brokers: ["127.0.0.1:9092"],\r\n    },\r\n    consumer: {\r\n      groupId: "myapp-consumer",\r\n    },\r\n  },\r\n};\n'})}),"\n",(0,a.jsx)(n.h2,{id:"maints",children:"main.ts"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { NestFactory } from "@nestjs/core";\r\nimport { MicroserviceOptions } from "@nestjs/microservices";\r\nimport { AppModule } from "./app.module";\r\nimport { kafkaConfig } from "./kafka.config";\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n\r\n  app.connectMicroservice<MicroserviceOptions>(kafkaConfig);\r\n  await app.startAllMicroservices();\r\n\r\n  await app.listen(3000);\r\n}\r\nbootstrap();\n'})}),"\n",(0,a.jsx)(n.h2,{id:"controller",children:"controller"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'import { Controller, Get } from "@nestjs/common";\r\nimport { Client, ClientKafka, Ctx, EventPattern, KafkaContext, MessagePattern, Payload } from "@nestjs/microservices";\r\nimport { kafkaConfig } from "./kafka.config";\r\n\r\n@Controller()\r\nexport class AppController {\r\n  @Client(kafkaConfig)\r\n  client: ClientKafka;\r\n\r\n  onModuleInit() {\r\n    const requestPatterns = ["message"];\r\n    requestPatterns.forEach(pattern => {\r\n      // reply \ud1a0\ud53d \uad6c\ub3c5\r\n      this.client.subscribeToResponseOf(pattern);\r\n    });\r\n  }\r\n\r\n  @Get("event")\r\n  emitData() {\r\n    this.client.emit<string>("event", { data: "hello world" }).subscribe(reply => {\r\n      console.log("reply", reply);\r\n    });\r\n  }\r\n\r\n  @EventPattern("event")\r\n  getEvent(@Payload("data") payload: any, @Ctx() context: KafkaContext) {\r\n    console.log(payload);\r\n  }\r\n\r\n  @EventPattern("postgres_server.public.users")\r\n  databaseChange(@Payload() payload: any, @Ctx() context: KafkaContext) {\r\n    console.log(payload);\r\n  }\r\n\r\n  @Get("message")\r\n  sendData() {\r\n    this.client.send<string>("message", { data: "hello world" }).subscribe(reply => {\r\n      console.log("reply", reply);\r\n    });\r\n  }\r\n\r\n  @MessagePattern("message")\r\n  getData(@Payload("data") payload: any, @Ctx() context: KafkaContext) {\r\n    console.log(payload);\r\n    return { data: "nice to meet you" };\r\n  }\r\n}\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);