"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["489699"],{173325:function(r,e,n){n.r(e),n.d(e,{frontMatter:()=>c,toc:()=>a,default:()=>g,metadata:()=>t,assets:()=>s,contentTitle:()=>l});var t=JSON.parse('{"id":"grpc/grpc \uD1B5\uC2E0 \uBC29\uC2DD bi-directional streaming","title":"grpc bi-directional streaming","description":"proto","source":"@site/docs/grpc/grpc \uD1B5\uC2E0 \uBC29\uC2DD bi-directional streaming.md","sourceDirName":"grpc","slug":"/grpc/grpc \uD1B5\uC2E0 \uBC29\uC2DD bi-directional streaming","permalink":"/docs/grpc/grpc \uD1B5\uC2E0 \uBC29\uC2DD bi-directional streaming","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"grpc proto","permalink":"/docs/grpc/grpc proto \uBB38\uBC95"},"next":{"title":"grpc client streaming","permalink":"/docs/grpc/grpc \uD1B5\uC2E0 \uBC29\uC2DD client streaming"}}'),i=n(447259),o=n(255511);let c={},l="grpc bi-directional streaming",s={},a=[{value:"proto",id:"proto",level:2},{value:"server",id:"server",level:2},{value:"client",id:"client",level:2}];function d(r){let e={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,o.R)(),...r.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"grpc-bi-directional-streaming",children:"grpc bi-directional streaming"})}),"\n",(0,i.jsx)(e.h2,{id:"proto",children:"proto"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-proto",children:"service GreetService {\r\n  rpc SayHello (stream HelloRequest) returns (stream HelloReply) {}\r\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"server",children:"server"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func (*Server) GreetEveryone(stream pb.GreetService_GreetEveryoneServer) error {\r\n	log.Println("GreetEveryone was invoked")\r\n\r\n	for {\r\n		req, err := stream.Recv()\r\n\r\n		if err == io.EOF {\r\n			return nil\r\n		}\r\n\r\n		if err != nil {\r\n			log.Fatalf("Error while reading client stream: %v\\n", err)\r\n		}\r\n\r\n		res := "Hello " + req.FirstName + "!"\r\n\r\n		err = stream.Send(&pb.GreetResponse{\r\n			Result: res,\r\n		})\r\n\r\n		if err != nil {\r\n			log.Fatalf("Error while sending data to client: %v\\n", err)\r\n		}\r\n	}\r\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"client",children:"client"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-go",children:'func doGreetEveryone(c pb.GreetServiceClient) {\r\n	log.Println("doGreetEveryone was invoked")\r\n\r\n	stream, err := c.GreetEveryone(context.Background())\r\n\r\n	if err != nil {\r\n		log.Fatalf("Error while creating stream: %v\\n", err)\r\n	}\r\n\r\n	requests := []*pb.GreetRequest{\r\n		{FirstName: "Clement"},\r\n		{FirstName: "Marie"},\r\n		{FirstName: "Test"},\r\n	}\r\n\r\n	waitc := make(chan struct{})\r\n	go func() {\r\n		for _, req := range requests {\r\n			log.Printf("Sending message: %v\\n", req)\r\n			stream.Send(req)\r\n			time.Sleep(1 * time.Second)\r\n		}\r\n		stream.CloseSend()\r\n	}()\r\n\r\n	go func() {\r\n		for {\r\n			res, err := stream.Recv()\r\n			if err == io.EOF {\r\n				break\r\n			}\r\n			if err != nil {\r\n				log.Printf("Error while receiving: %v\\n", err)\r\n				break\r\n			}\r\n			log.Printf("Received: %v\\n", res.Result)\r\n		}\r\n		close(waitc)\r\n	}()\r\n\r\n	<-waitc\r\n}\n'})})]})}function g(r={}){let{wrapper:e}={...(0,o.R)(),...r.components};return e?(0,i.jsx)(e,{...r,children:(0,i.jsx)(d,{...r})}):d(r)}},255511:function(r,e,n){n.d(e,{R:()=>c,x:()=>l});var t=n(596363);let i={},o=t.createContext(i);function c(r){let e=t.useContext(o);return t.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function l(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(i):r.components||i:c(r.components),t.createElement(o.Provider,{value:e},r.children)}}}]);