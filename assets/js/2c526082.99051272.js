"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["669584"],{424492:function(e,s,r){r.r(s),r.d(s,{frontMatter:()=>i,toc:()=>a,default:()=>p,metadata:()=>n,assets:()=>l,contentTitle:()=>c});var n=JSON.parse('{"id":"express/express long polling","title":"express long polling","description":"send() \uBA54\uC11C\uB4DC\uB97C \uBBF8\uB8F8\uC73C\uB85C\uC368 \uC5F0\uACB0\uC744 \uC9C0\uC18D\uC2DC\uD0A8\uB2E4.","source":"@site/docs/express/express long polling.md","sourceDirName":"express","slug":"/express/express long polling","permalink":"/docs/express/express long polling","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"http connection \uC720\uC9C0","permalink":"/docs/express/express connection \uC720\uC9C0"},"next":{"title":"express on close","permalink":"/docs/express/express on close"}}'),t=r(447259),o=r(255511);let i={},c="express long polling",l={},a=[{value:"client",id:"client",level:2},{value:"server",id:"server",level:2}];function u(e){let s={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"express-long-polling",children:"express long polling"})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"send() \uBA54\uC11C\uB4DC\uB97C \uBBF8\uB8F8\uC73C\uB85C\uC368 \uC5F0\uACB0\uC744 \uC9C0\uC18D\uC2DC\uD0A8\uB2E4."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"client",children:"client"}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"\uC7AC\uADC0\uD568\uC218\uB97C \uD1B5\uD574\uC11C \uC11C\uBC84\uC640 \uC5F0\uACB0\uC744 \uC720\uC9C0"}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"\uC5F0\uACB0\uC774 \uB04A\uAE30\uBA74 \uB2E4\uC2DC \uC5F0\uACB0\uC744 \uC2DC\uB3C4"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"async function subscribe() {\r\n  let response = await fetch(\"/subscribe\");\r\n\r\n  if (response.status == 502) {\r\n    // Status 502 is a connection timeout error,\r\n    // may happen when the connection was pending for too long,\r\n    // and the remote server or a proxy closed it\r\n    // let's reconnect\r\n    await subscribe();\r\n  } else if (response.status != 200) {\r\n    // An error - let's show it\r\n    showMessage(response.statusText);\r\n    // Reconnect in one second\r\n    await new Promise((resolve) => setTimeout(resolve, 1000));\r\n    await subscribe();\r\n  } else {\r\n    // Get and show the message\r\n    let message = await response.text();\r\n    showMessage(message);\r\n    // Call subscribe() again to get the next message\r\n    await subscribe();\r\n  }\r\n}\r\n\r\nsubscribe();\n"})}),"\n",(0,t.jsx)(s.h2,{id:"server",children:"server"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'const express = require("express");\r\nconst router = express.Router();\r\n\r\nconst subscribers = new Map();\r\n\r\n/// /subscribe\uC5D0 get\uC694\uCCAD\uC774 \uC624\uBA74 subscribers\uC5D0 \uCD94\uAC00\r\nrouter.get("/subscribe", function (req, res, next) {\r\n  const subscriber = {\r\n    id: Math.random(),\r\n    res,\r\n    send(message) {\r\n      this.res.send(message);\r\n    },\r\n  };\r\n\r\n  subscribers.set(subscriber.id, subscriber);\r\n\r\n  req.on("close", () => {\r\n    subscribers.delete(subscriber.id);\r\n  });\r\n});\r\n\r\n/// /publish\uC5D0 post\uC694\uCCAD\uC73C\uB85C \uBA54\uC2DC\uC9C0\uB97C \uBCF4\uB0B4\uBA74 subscribers\uC5D0 \uC788\uB294 \uBAA8\uB4E0 \uAD6C\uB3C5\uC790\uC5D0\uAC8C \uBA54\uC2DC\uC9C0\uB97C \uBCF4\uB0C4\r\n/// \uADF8\uB9AC\uACE0 subscribers\uB97C \uBE44\uC6C0\r\nrouter.post("/publish", function (req, res, next) {\r\n  const message = req.body.message;\r\n\r\n  for (const subscriber of subscribers.values()) {\r\n    subscriber.send(message);\r\n  }\r\n\r\n  subscribers.clear();\r\n\r\n  res.send("ok");\r\n});\r\n\r\nmodule.exports = router;\n'})})]})}function p(e={}){let{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},255511:function(e,s,r){r.d(s,{R:()=>i,x:()=>c});var n=r(596363);let t={},o=n.createContext(t);function i(e){let s=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),n.createElement(o.Provider,{value:s},e.children)}}}]);