"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[51301],{529087:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var s=n(596363);const c={},t=s.createContext(c);function o(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),s.createElement(t.Provider,{value:r},e.children)}},576148:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>s,toc:()=>p});const s=JSON.parse('{"id":"db-postgres/postgres WAL archive backup","title":"postgres WAL \uc544\uce74\uc774\ube0c backup","description":"WAL \ud30c\uc77c\uc744 \uc7ac\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 \ubcf4\uad00","source":"@site/docs/db-postgres/postgres WAL archive backup.md","sourceDirName":"db-postgres","slug":"/db-postgres/postgres WAL archive backup","permalink":"/docs/db-postgres/postgres WAL archive backup","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"postgres TLS & SSL","permalink":"/docs/db-postgres/postgres TLS & SSL"},"next":{"title":"postgres WAL restore","permalink":"/docs/db-postgres/postgres WAL archive restore"}}');var c=n(447259),t=n(529087);const o={},a="postgres WAL \uc544\uce74\uc774\ube0c backup",i={},p=[{value:"archive",id:"archive",level:2},{value:"pg_basebackup",id:"pg_basebackup",level:2}];function d(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.header,{children:(0,c.jsx)(r.h1,{id:"postgres-wal-\uc544\uce74\uc774\ube0c-backup",children:"postgres WAL \uc544\uce74\uc774\ube0c backup"})}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsx)(r.p,{children:"WAL \ud30c\uc77c\uc744 \uc7ac\uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 \ubcf4\uad00"}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsx)(r.p,{children:"\ubcf4\ud1b5 \uc678\ubd80 \uc800\uc7a5\uc18c\uc5d0 WAL \ub85c\uadf8\ub97c \uc800\uc7a5\ud558\uc5ec, \ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc2dc\uc2a4\ud15c\uc774 \uc190\uc0c1\ub41c \uacbd\uc6b0\uc5d0\ub3c4 \ub85c\uadf8\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub370\uc774\ud130\ub97c \ubcf5\uad6c\ud560 \uc218 \uc788\uac8c \ud569\ub2c8\ub2e4."}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsx)(r.p,{children:"pg_basebackup\uc744 \uc0ac\uc6a9\ud55c \uc774\ud6c4\ubd80\ud130\uc758 WAL \ub85c\uadf8\ub9cc \ubcf4\uad00\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsx)(r.p,{children:"pg_basebackup\uc744 \ud55c\ubc88\uc774\ub77c\ub3c4 \ud574\ub194\uc57c point in recovery\uac00 \uac00\ub2a5\ud558\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.h2,{id:"archive",children:"archive"}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsx)(r.p,{children:"postgres restart\uc2dc WAL \ud30c\uc77c\uc774 archive_command\uc5d0 \uc124\uc815\ub41c \uba85\ub839\uc73c\ub85c \uc2e4\ud589\ub41c\ub2e4."}),"\n",(0,c.jsx)(r.p,{children:"/mnt/server/archivedir \uc744 \uc0dd\uc131\ud558\uace0 \uc4f0\uae30 \uad8c\ud55c \ubd80\uc5ec\ud574\uc57c \ud55c\ub2e4."}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsx)(r.p,{children:"archive_command \uba85\ub839\uc740 PostgreSQL \uc11c\ubc84\ub97c \uc2e4\ud589\ud588\ub358 \uc2dc\uc2a4\ud15c \uc0ac\uc6a9\uc790 \uad8c\ud55c\uc73c\ub85c \uc2e4\ud589\ub418\uc5b4\uc57c"}),"\n",(0,c.jsx)(r.p,{children:"\ub610\ud55c \uc131\uacf5\ud55c \uacbd\uc6b0 0, \uc544\ub2cc\uacbd\uc6b0 0 \uc774 \uc544\ub2c8\uac8c \ubc18\ud658\ub418\ub3c4\ub85d \ud574\uc57c"}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-conf",children:"archive_mode = on\r\narchive_command = 'test ! -f /mnt/server/archivedir/%f && cp %p /mnt/server/archivedir/%f'  # Unix\r\narchive_timeout = 1 # 1\ucd08\ub9c8\ub2e4 \uac15\uc81c\ub85c WAL \ud30c\uc77c\uc744 archive_command\ub85c \ubcf4\ub0c4 (0\uc774\uba74 16MB \ucc44\uc6cc\uc9c0\uba74 \ubcf4\ub0c4)\n"})}),"\n",(0,c.jsx)(r.h2,{id:"pg_basebackup",children:"pg_basebackup"}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsx)(r.p,{children:"pg_basebackup\uc744 \ud558\uba74 \uc544\uce74\uc774\ube0c\uc5d0 000000010000000000000002.00000028.backup \uc774\ub807\uac8c \ub9c8\ud0b9\ub41c \ud30c\uc77c\uc774 \uc0dd\uc131\ub41c\ub2e4."}),"\n",(0,c.jsxs)(r.blockquote,{children:["\n",(0,c.jsx)(r.p,{children:"000000010000000000000002 \ubc11\uc758 \ud30c\uc77c\uc740 \uc9c0\uc6cc\ub3c4 \ub41c\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(r.pre,{children:(0,c.jsx)(r.code,{className:"language-sh",children:"pg_basebackup -D /backup/base -Ft -z -X fetch -P -v\r\n# -D : \ubc31\uc5c5\ud30c\uc77c\uc774 \uc800\uc7a5\ub420 \ub514\ub809\ud1a0\ub9ac\r\n# -Ft : tar \ud615\uc2dd\uc73c\ub85c \ubc31\uc5c5\r\n# -z : gzip\uc73c\ub85c \uc555\ucd95\r\n# -X none : WAL \ud30c\uc77c\uc744 \ubcf5\uc0ac\ud558\uc9c0 \uc54a\uc74c\r\n# -X fetch : WAL\uc744 \ubc31\uc5c5\uc774 \ub05d\ub09c \ud6c4, \ubc31\uc5c5\uc774 \uc2dc\uc791\ub41c \uc2dc\uc810\uc758 WAL\ub9cc \uac00\uc838\uc634\r\n# -X stream : WAL\uc744 \ubc31\uc5c5 \uc911 \uc2a4\ud2b8\ub9ac\ubc0d(\uc2e4\uc2dc\uac04)\uc73c\ub85c \ubc1b\uc544\uc11c \ud568\uaed8 \uc800\uc7a5\r\n# -P : \uc9c4\ud589\ub960 \ud45c\uc2dc\r\n# -v : \uc790\uc138\ud55c \uc815\ubcf4 \ud45c\uc2dc\n"})})]})}function l(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,c.jsx)(r,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);