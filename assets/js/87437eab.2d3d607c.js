"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["172559"],{888561:function(r,e,n){n.r(e),n.d(e,{frontMatter:()=>o,toc:()=>p,default:()=>d,metadata:()=>s,assets:()=>i,contentTitle:()=>l});var s=JSON.parse('{"id":"db-postgres/postgres backup pg_rman","title":"postgres pg_rman","description":"rman : Recovery Manager","source":"@site/docs/db-postgres/postgres backup pg_rman.md","sourceDirName":"db-postgres","slug":"/db-postgres/postgres backup pg_rman","permalink":"/docs/db-postgres/postgres backup pg_rman","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"postgres backup pg_backup docker","permalink":"/docs/db-postgres/postgres backup pg_dump docker"},"next":{"title":"postgres recovery psql vs pg_restore","permalink":"/docs/db-postgres/postgres backup psql vs pg_restore"}}'),t=n(447259),a=n(255511);let o={},l="postgres pg_rman",i={},p=[{value:"install",id:"install",level:2},{value:"install error",id:"install-error",level:2},{value:"usage",id:"usage",level:2}];function c(r){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...r.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"postgres-pg_rman",children:"postgres pg_rman"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"rman : Recovery Manager"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"install",children:"install"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"tar -xf pg_rman-1.3.16-pg14.tar.gz\r\ncd pg_rman-1.3.16-pg14\r\nmake\r\nmake install\r\n\r\n# BACKUP_PATH \uC124\uC815\r\nvi ~/.bash_profile\r\n  export BACKUP_PATH=/home/ubuntu/backup\r\n  export PGDATA=/var/lib/pgsql/13/data\r\n  export ARCLOG_PATH=/home/ubuntu/archivedir\r\nsource ~/.bash_profile\r\n\r\n# postgresql.conf \uC124\uC815\r\narchive_mode = on\r\narchive_command = 'test ! -f /home/ubuntu/archivedir/%f && cp %p /home/ubuntu/archivedir/%f'\r\n\r\n# \uBC31\uC5C5 \uCE74\uD0C8\uB85C\uADF8 \uCD08\uAE30\uD654\r\npg_rman init\n"})}),"\n",(0,t.jsx)(e.h2,{id:"install-error",children:"install error"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"# error\r\npg_rman.h:13:10: fatal error: postgres_fe.h: No such file or directory\r\n   13 | #include \"postgres_fe.h\"\r\n# solution\r\napt install postgresql-server-dev-14\r\n\r\n# error\r\n/usr/bin/ld: cannot find -lselinux: No such file or directory\r\n/usr/bin/ld: cannot find -llz4: No such file or directory\r\n/usr/bin/ld: cannot find -lpam: No such file or directory\r\n/usr/bin/ld: cannot find -lgssapi_krb5: No such file or directory\r\n/usr/bin/ld: cannot find -lreadline: No such file or directory\r\n# solution\r\napt install libselinux1-dev liblz4-dev libpam0g-dev libkrb5-dev libreadline-dev -y\r\n\r\n# error\r\n/bin/mkdir -p '/usr/lib/postgresql/14/bin'\r\n/usr/bin/install -c  pg_rman '/usr/lib/postgresql/14/bin'\r\n/usr/bin/install: cannot create regular file '/usr/lib/postgresql/14/bin/pg_rman': Permission denied\r\n# solution\r\nchmod 755 /usr/lib/postgresql/14/bin\n"})}),"\n",(0,t.jsx)(e.h2,{id:"usage",children:"usage"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"# Full backup -- \uC804\uCCB4 \uB370\uC774\uD130\uBCA0\uC774\uC2A4 \uD074\uB7EC\uC2A4\uD130\uB97C \uBC31\uC5C5\r\npg_rman backup -b full -d mydb\r\n\r\n# Incremental backup -- \uB3D9\uC77C\uD55C \uD0C0\uC784\uB77C\uC778\uC73C\uB85C \uB9C8\uC9C0\uB9C9 \uD655\uC778\uB41C \uBC31\uC5C5 \uC774\uD6C4\uC5D0 \"\uC218\uC815\uB41C \uD30C\uC77C \uB610\uB294 \uD398\uC774\uC9C0\uB9CC \uBC31\uC5C5\" (\uC99D\uBD84\uBC31\uC5C5)\r\npg_rman backup -b incremental -d mydb\r\n\r\n# Archive WAL backup -- \uC544\uCE74\uC774\uBE0C WAL \uD30C\uC77C\uB9CC \uBC31\uC5C5\r\npg_rman backup -b archive -d mydb\r\n\r\n# \uBC31\uC5C5 \uD655\uC778\r\npg_rman show\r\n\r\n# \uC720\uD6A8\uC131 \uAC80\uC0AC\r\npg_rman validate\r\n\r\n# \uC0AD\uC81C\r\npg_rman delete 2021-08-05 13:37:27\r\npg_rman purge # \uC0AD\uC81C\uB41C \uBC31\uC5C5\uC758 \uCE74\uD0C8\uB85C\uADF8 \uC815\uBCF4 \uC0AD\uC81C\r\n\r\n# \uBCF5\uAD6C\r\npg_ctl stop\r\n# --hard-copy : \uC544\uCE74\uC774\uBE0C \uB85C\uADF8 \uBCF5\uC0AC \uD6C4 \uBCF5\uAD6C\r\npg_rman restore --hard-copy\r\npg_rman restore --hard-copy --recovery-target-time '2024-05-18 16:55:00' # \uC2DC\uAC04\uC73C\uB85C \uBCF5\uAD6C\r\npg_rman restore --hard-copy --recovery-target-timeline=4 # \uD0C0\uC784\uB77C\uC778 4\uB85C \uBCF5\uAD6C\r\npg_ctl start\n"})})]})}function d(r={}){let{wrapper:e}={...(0,a.R)(),...r.components};return e?(0,t.jsx)(e,{...r,children:(0,t.jsx)(c,{...r})}):c(r)}},255511:function(r,e,n){n.d(e,{R:()=>o,x:()=>l});var s=n(596363);let t={},a=s.createContext(t);function o(r){let e=s.useContext(a);return s.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function l(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(t):r.components||t:o(r.components),s.createElement(a.Provider,{value:e},r.children)}}}]);