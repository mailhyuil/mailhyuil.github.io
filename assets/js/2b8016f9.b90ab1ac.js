"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[33641],{529087:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>i});var t=r(596363);const a={},s=t.createContext(a);function o(n){const e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:o(n.components),t.createElement(s.Provider,{value:e},n.children)}},853178:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"ai langchain/langchain Chat History","title":"langchain Chat History","description":"\uba40\ud2f0\ud134 \ub300\ud654\ub97c \uc704\ud55c \ub300\ud654 \uc774\ub825(Chat History) \uc800\uc7a5 \ubc0f \ud65c\uc6a9 \ubc29\ubc95","source":"@site/docs/ai langchain/langchain Chat History.md","sourceDirName":"ai langchain","slug":"/ai langchain/langchain Chat History","permalink":"/docs/ai langchain/langchain Chat History","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"langchain Chat History createHistoryAwareRetriever","permalink":"/docs/ai langchain/langchain Chat History createHistoryAwareRetriever"},"next":{"title":"langchain Document Loader Playwright","permalink":"/docs/ai langchain/langchain Document Loader AWS S3"}}');var a=r(447259),s=r(529087);const o={},i="langchain Chat History",c={},h=[{value:"\ud504\ub85c\uc138\uc2a4",id:"\ud504\ub85c\uc138\uc2a4",level:2},{value:"\uad6c\ud604",id:"\uad6c\ud604",level:2}];function l(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"langchain-chat-history",children:"langchain Chat History"})}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"\uba40\ud2f0\ud134 \ub300\ud654\ub97c \uc704\ud55c \ub300\ud654 \uc774\ub825(Chat History) \uc800\uc7a5 \ubc0f \ud65c\uc6a9 \ubc29\ubc95"}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"Chat History\ub97c \uc0ac\uc6a9\ud560 \uc218\ub85d API \uc0ac\uc6a9 \ud1a0\ud070 \uc218\uac00 \ub298\uc5b4\ub098\uae30\uc5d0 \ucd5c\uc801\ud654\ub97c \ud574\uc57c\ud55c\ub2e4."}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"\ub300\ud654 \uc774\ub825 \uc81c\ud55c: \uc774\uc804 \uba54\uc2dc\uc9c0 \uc911 \uc911\uc694\ud55c \uac83\ub9cc \uc720\uc9c0\ud558\uace0 \uc624\ub798\ub41c \ub0b4\uc6a9\uc740 \uc81c\uac70."}),"\n",(0,a.jsx)(e.p,{children:"\uc694\uc57d(Summarization) \ud65c\uc6a9: \ub300\ud654\uac00 \uae38\uc5b4\uc9c0\uba74 \uc694\uc57d\uc744 \uc0dd\uc131\ud574 \ub300\ud654 \uc774\ub825\uc758 \uae38\uc774\ub97c \uc904\uc774\uae30."}),"\n",(0,a.jsx)(e.p,{children:"\ud544\uc694\ud55c Chat History\ub9cc \ud3ec\ud568: \ubaa8\ub4e0 API \ud638\ucd9c\uc5d0\uc11c \ub300\ud654 \uc774\ub825\uc744 \ud3ec\ud568\ud558\ub294 \uac83\uc774 \uc544\ub2c8\ub77c, \ubb38\ub9e5\uc774 \ud544\uc694\ud55c \uacbd\uc6b0\uc5d0\ub9cc \ud65c\uc6a9."}),"\n",(0,a.jsxs)(e.blockquote,{children:["\n",(0,a.jsx)(e.p,{children:"\uc720\uc800\uc758 \uc9c8\ubb38\uc740 role: user, AI\uc758 \ub2f5\ubcc0\uc740 role: assistant\ub85c \uad6c\ubd84"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"\ud504\ub85c\uc138\uc2a4",children:"\ud504\ub85c\uc138\uc2a4"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-txt",children:"1. \uc774\uc804 \ub300\ud654 history\ub97c embedding (vector\ud654 \uc2dc\ucf1c\uc11c \uc6a9\ub7c9\uc744 \uc904\uc784)\r\n2. vector stores\uc5d0 \uc800\uc7a5\r\n3. \ub2e4\uc74c \ub2f5\ubcc0\uc744 \ud560 \ub54c Retriever\uac00 vector stores\uc5d0\uc11c \uad00\ub828\ub41c history\ub9cc \uac80\uc0c9 (\ube60\ub974\uac8c \uac80\uc0c9 \uac00\ub2a5)\r\n4. RAG\ub97c \uc218\ud589\ud558\uc5ec \ub2f5\ubcc0 (\ud544\uc694\ud55c history\ub9cc \uc0ac\uc6a9\ud588\uae30\uc5d0 API \ube44\uc6a9\uc774 \uc808\uac10\ub428)\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\uad6c\ud604",children:"\uad6c\ud604"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-ts",children:'import { ChatPromptTemplate, MessagesPlaceholder } from "@langchain/core/prompts";\r\n\r\n// \ub300\ud654 \uc774\ub825 \uac80\uc0c9\r\nconst searchedHistory = await this.vectorStore.get(message, 2, {\r\n  userId: id,\r\n});\r\nconst historyMap = searchedHistory.map(doc => {\r\n  const role = doc.metadata.type;\r\n  return [role, doc.pageContent] as DocumentInterface<Record<string, any>>[];\r\n});\r\n\r\nconst qaPrompt = ChatPromptTemplate.fromMessages([\r\n  ["system", systemPrompt],\r\n  new MessagesPlaceholder("chat_history"),\r\n  ["user", "{message}"],\r\n]);\r\n\r\nconst promptValue = await promptTemplate.invoke({\r\n  message,\r\n  chat_history: historyPrompts,\r\n});\r\n\r\n// \ub2f5\ubcc0 \uc0dd\uc131 \ubc0f \uc804\uc1a1\r\nconst stream = await this.model.stream(promptValue);\r\nconst subject$ = this.create(id);\r\nconst chunks = [];\r\nfor await (const chunk of stream) {\r\n  chunks.push(chunk);\r\n  subject$.next({\r\n    data: { chunk: chunk.content.toString() },\r\n  } as MessageEvent<{ chunk: string }>);\r\n}\r\nsubject$.next({\r\n  data: "end",\r\n} as MessageEvent<"end">);\r\n\r\n//! \ud788\uc2a4\ud1a0\ub9ac \uc800\uc7a5\r\nthis.vectorStore.add(id, [\r\n  {\r\n    metadata: {\r\n      type: "user",\r\n      userId: id,\r\n    },\r\n    pageContent: message,\r\n  },\r\n]);\r\nthis.vectorStore.add(id, [\r\n  {\r\n    metadata: {\r\n      type: "assistant",\r\n      userId: id,\r\n    },\r\n    pageContent: chunks.join(""),\r\n  },\r\n]);\n'})})]})}function d(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(l,{...n})}):l(n)}}}]);