"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[526568],{529087:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var t=r(596363);const i={},l=t.createContext(i);function a(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(l.Provider,{value:n},e.children)}},539278:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"spring/spring File upload - \uc11c\ubc84\uc5d0 \ud30c\uc77c \uc5c5\ub85c\ub4dc","title":"File upload (\uc11c\ubc84\uc5d0 \ud30c\uc77c \uc5c5\ub85c\ub4dc)","description":"1. pom.xml","source":"@site/docs/spring/spring File upload - \uc11c\ubc84\uc5d0 \ud30c\uc77c \uc5c5\ub85c\ub4dc.md","sourceDirName":"spring","slug":"/spring/spring File upload - \uc11c\ubc84\uc5d0 \ud30c\uc77c \uc5c5\ub85c\ub4dc","permalink":"/docs/spring/spring File upload - \uc11c\ubc84\uc5d0 \ud30c\uc77c \uc5c5\ub85c\ub4dc","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Exception (\uc608\uc678 \ucc98\ub9ac)","permalink":"/docs/spring/spring Exception - \uc608\uc678 \ucc98\ub9ac"},"next":{"title":"Gradle (\uadf8\ub808\ub4e4)","permalink":"/docs/spring/spring Gradle - \uadf8\ub808\ub4e4"}}');var i=r(447259),l=r(529087);const a={},o="File upload (\uc11c\ubc84\uc5d0 \ud30c\uc77c \uc5c5\ub85c\ub4dc)",s={},d=[{value:"\ud574\ud0b9\ubc29\uc9c0",id:"\ud574\ud0b9\ubc29\uc9c0",level:3},{value:"MultipartHttpServletRequest \uc5ec\ub7ec\uac1c\uc758 \ud30c\uc77c\uc744 \ub3d9\uc2dc\uc5d0 \uc5c5\ub85c\ub4dc \ud560\ub54c",id:"multiparthttpservletrequest-\uc5ec\ub7ec\uac1c\uc758-\ud30c\uc77c\uc744-\ub3d9\uc2dc\uc5d0-\uc5c5\ub85c\ub4dc-\ud560\ub54c",level:3},{value:"\ud30c\uc77c \uc9c0\uc6b0\uae30 (file delete)",id:"\ud30c\uc77c-\uc9c0\uc6b0\uae30-file-delete",level:3},{value:"\ube44\ub514\uc624 \uc601\uc0c1 \uc5c5\ub85c\ub4dc(video upload)",id:"\ube44\ub514\uc624-\uc601\uc0c1-\uc5c5\ub85c\ub4dcvideo-upload",level:3}];function c(e){const n={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"file-upload-\uc11c\ubc84\uc5d0-\ud30c\uc77c-\uc5c5\ub85c\ub4dc",children:"File upload (\uc11c\ubc84\uc5d0 \ud30c\uc77c \uc5c5\ub85c\ub4dc)"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"pom.xml"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"\x3c!-- commons-io --\x3e\r\n<dependency>\r\n\t<groupId>commons-io</groupId>\r\n\t<artifactId>commons-io</artifactId>\r\n\t<version>2.11.0</version>\r\n</dependency>\r\n\r\n\x3c!-- commons-fileupload --\x3e\r\n<dependency>\r\n\t<groupId>commons-fileupload</groupId>\r\n\t<artifactId>commons-fileupload</artifactId>\r\n\t<version>1.4</version>\r\n</dependency>\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"root-context"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">\r\n\t<property name="maxUploadSizePerFile" value="2000000"/>\r\n\t<property name="maxUploadSize" value="20000000"/>\r\n</bean>\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"application.yml"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"spring:\r\n  servlet:\r\n    multipart:\r\n      file-size-threshold: 1MB\r\n      location: C:/Temp/upload\r\n      max-file-size: 100MB\r\n      max-request-size: 100MB\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"jsp"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsp",children:'<form method="POST" class="bbs_write" enctype="multipart/form-data">\r\n\t<h2>\uac8c\uc2dc\ud310 \uae00\uc4f0\uae30</h2>\r\n\t<input name="b_date" type="date" value="${BBS.b_date}"\r\n\t\t\t\t\t\thidden="hidden">\r\n\t<input name="b_time" type="time" value="${BBS.b_time}"\r\n\t\t\t\t\t\thidden="hidden">\r\n\r\n\t<input name="b_writer" placeholder="\uc791\uc131\uc790"\r\n\t\t\t\tvalue="${BBS.b_writer}" readonly="readonly">\r\n\r\n\t<input name="b_subject" placeholder="\uc81c\ubaa9">\r\n\r\n\t<textarea rows="5" cols="20" name="b_content" placeholder="\ub0b4\uc6a9"></textarea>\r\n\r\n\t<input type="file" name="up_file" accept="image/*">\r\n\r\n\t<button>\uc800\uc7a5</button>\r\n</form>\r\n<%/*\r\nfile input box \uc5d0 \uc120\ud0dd\ud558\ub294 \ud30c\uc77c \uc81c\ud55c\ud558\uae30\r\naccept=".hwp" : \ud655\uc7a5\uc790\uac00 hwp \uc778 \ud30c\uc77c\ub9cc \uc120\ud0dd\ud560 \uc218 \uc788\uaed8\r\naccept=".jpg", accept=".png", accept=".gif" : \uc774\ubbf8\uc9c0 \ud30c\uc77c\ub4e4\uc911\uc5d0\uc11c\r\n\t\tjpg, png, gif \ud655\uc7a5\uc790\ub97c \uac16\ub294 \ud30c\uc77c\ub9cc\r\n\r\naccept="image/*" : \ubaa8\ub4e0 \uc774\ubbf8\uc9c0 \ud30c\uc77c\r\naccept="video/*" : \ubaa8\ub4e0 \ub3d9\uc601\uc0c1 \ud30c\uc77c\r\naccept="audio/*" : \ubaa8\ub4e0 \uc74c\uc131(\uc74c\uc545) \ud30c\uc77c\r\naccept="image/*, video/*, audio/*" : \uc774\ubbf8\uc9c0, \ub3d9\uc601\uc0c1, \uc74c\uc131 \ud30c\uc77c\r\n*/%>\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"\ud30c\uc77c \uc5c5\ub85c\ub4dc"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// Spring \uc5d0\uc11c Server \uc758 \ud2b9\uc815\ud55c \ud3f4\ub354\uc5d0 \uc811\uadfc\ud558\uae30 \uc704\ud55c \uc911\uac04 \ub3c4\uad6c\r\nprivate final ServletContext context;\r\nprivate final ResourceLoader resLoader;\r\n\r\npublic FileServiceImplV1(ServletContext context, ResourceLoader resLoader) {\r\n\tthis.context = context;\r\n\tthis.resLoader = resLoader;\r\n}\r\n// \ub9ac\uc18c\uc2a4 \uc815\ubcf4 \uc218\uc9d1\r\nString upLoadPath = resLoader.getResource("").getURI().getPath();\r\n\r\n // \ub514\ub809\ud1a0\ub9ac\uac00 \uc5c6\uc744\uc2dc \uc0dd\uc131\r\nFile dir = new File(upLoadPath);\r\nif(!dir.exists()){\r\n\tdir.mkdirs();\r\n}\r\n// \ud30c\uc77c \uc5c5\ub85c\ub4dc \uc815\ubcf4 \uc0dd\uc131\r\nFile upLoadFile = new File(upLoadPath, fileName);\r\n// \ud30c\uc77c \uc5c5\ub85c\ub4dc\r\nfile.transferTo(upLoadFile);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ud574\ud0b9\ubc29\uc9c0",children:"\ud574\ud0b9\ubc29\uc9c0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'String strUUID = UUID.randomUUID().toString();\r\n\r\nfileName = String.format("%s-%s",strUUID, fileName);\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'MultipartFile // enctype="multipart/form-data"\ub85c \uc804\uc1a1\uc2dc'}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@RequestMapping(value="/write",method=RequestMethod.POST)\r\npublic String write(@ModelAttribute("bbsVO") BBsVO bbsVO, @RequestParam("up_file") MultipartFile file, Model model) {\r\n\r\n\tString imageFile = bbsService.insertBbsAndFile(bbsVO, file);\r\n\tmodel.addAttribute("IMAGE",imageFile);\r\n\r\n\treturn "redirect:/";\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"multiparthttpservletrequest-\uc5ec\ub7ec\uac1c\uc758-\ud30c\uc77c\uc744-\ub3d9\uc2dc\uc5d0-\uc5c5\ub85c\ub4dc-\ud560\ub54c",children:"MultipartHttpServletRequest \uc5ec\ub7ec\uac1c\uc758 \ud30c\uc77c\uc744 \ub3d9\uc2dc\uc5d0 \uc5c5\ub85c\ub4dc \ud560\ub54c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsp",children:'<form:form modelAttribute="bbsVO" enctype="multipart/form-data">\r\n\t<form:input path="b_subject" />\r\n\t<form:textarea path="b_content"/>\r\n\t<input type="file" name="mFile" multiple="multiple" accept="images/*"/>\r\n\t<button>\uc791\uc131\uc644\ub8cc</button>\r\n</form:form>\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@RequestMapping(value="/fileups",method=RequestMethod.POST)\r\npublic String upFiles(@ModelAttribute("bbsVO") BBsVO bbsVO,\tMultipartHttpServletRequest mFiles,\tModel model) {\r\n\r\n\tbbsService.insertBbsAndFiles(bbsVO, mFiles);\r\n\r\n\treturn null;\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ud30c\uc77c-\uc9c0\uc6b0\uae30-file-delete",children:"\ud30c\uc77c \uc9c0\uc6b0\uae30 (file delete)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public void fileDelete(String fileName) {\r\n\r\n\tif(fileName == null) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// \uc5c5\ub85c\ub4dc \ud3f4\ub354\uc640 \ud30c\uc77c\uc774\ub984\ubb36\uc5b4 \ud30c\uc77c \uac1d\uccb4 \uc0dd\uc131\r\n\tFile file = new File(\ud30c\uc77c\uc758 \uacbd\ub85c, fileName);\r\n\r\n\t// \uc2e4\uc81c \ud30c\uc77c\uc774 \uc874\uc7ac\ud558\ub294 \ud655\uc778\ud558\uace0\r\n\tif(file.exists()) {\r\n\t\t// \uc874\uc7ac\ud558\uba74 \ud30c\uc77c\uc744 \uc0ad\uc81c\r\n\t\tfile.delete();\r\n\t}\r\n\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\ube44\ub514\uc624-\uc601\uc0c1-\uc5c5\ub85c\ub4dcvideo-upload",children:"\ube44\ub514\uc624 \uc601\uc0c1 \uc5c5\ub85c\ub4dc(video upload)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"domain"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Data\r\n@NoArgsConstructor\r\n@Entity\r\npublic class Video{\r\n    @Id\r\n    @GeneratedValue(strategy = GenerationType.AUTO)\r\n    private Long id;\r\n\r\n    @Column(unique = true)\r\n    private String name; // \ube44\ub514\uc624 \uc774\ub984\r\n\r\n    @Lob\r\n    private byte[] data; // \ube44\ub514\uc624 \ubc14\uc774\ud2b8 \ubc30\uc5f4\ud615 \ub370\uc774\ud130\r\n\r\n    public Video(String name, byte[] data) {\r\n        this.name = name;\r\n        this.data = data;\r\n    }\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"repository"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public interface VideoRepository extends JpaRepository<Video, Long> {\r\n    Video findByName(String name); // \uc774\ub984\uc744 \ucc3e\uae30\r\n\r\n    boolean existsByName(String name); // \uc774\ub984\uc73c\ub85c \uc874\uc7ac\ud558\ub294\uc9c0 \uac80\uc0c9\r\n\r\n    @Query(nativeQuery = true, value="SELECT name FROM video") // \ubaa8\ub4e0 \ube44\ub514\uc624 \uc774\ub984 \uac80\uc0c9\r\n    List<String> getAllEntryNames();\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"service"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public interface VideoService {\r\n    Video getVideo(String name); // \ube44\ub514\uc624 \uc5bb\uae30\r\n\r\n    void saveVideo(MultipartFile file, String name) throws IOException; // \ube44\ub514\uc624 \uc800\uc7a5\r\n\r\n    List<String> getAllVideoNames(); // \ubaa8\ub4e0 \ube44\ub514\uc624 \uc774\ub984 \uc5bb\uae30\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"serviceImpl"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\r\n@AllArgsConstructor\r\npublic class VideoServiceImpl implements VideoService {\r\n    private VideoRepository repo;\r\n\r\n    @Override\r\n    public Video getVideo(String name) {\r\n        if(!repo.existsByName(name)){ // \ube44\ub514\uc624\uac00 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc73c\uba74\r\n            throw new VideoNotFoundException(); // \ube44\ub514\uc624\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4 \uc608\uc678\r\n        }\r\n        return repo.findByName(name); // \uc774\ub984\uc73c\ub85c \ube44\ub514\uc624 \uc5bb\uae30\r\n    }\r\n\r\n    @Override\r\n    public List<String> getAllVideoNames() {\r\n        return repo.getAllEntryNames(); // \ubaa8\ub4e0 \ube44\ub514\uc624 \uc774\ub984 \uc5bb\uae30\r\n    }\r\n\r\n    @Override\r\n    public void saveVideo(MultipartFile file, String name) throws IOException {\r\n        if(repo.existsByName(name)){ // \ube44\ub514\uc624\uac00 \uc874\uc7ac\ud558\uba74\r\n            throw new VideoAlreadyExistsException(); // \ube44\ub514\uc624\uac00 \uc874\uc7ac\ud569\ub2c8\ub2e4 \uc608\uc678\r\n        }\r\n        Video newVid = new Video(name, file.getBytes()); // *\ube44\ub514\uc624 \uac1d\uccb4 \uc0dd\uc131\r\n        repo.save(newVid); // \ube44\ub514\uc624 \uc800\uc7a5\r\n    }\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"RestController"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@RestController\r\n@RequestMapping("video")\r\n@AllArgsConstructor\r\npublic class VideoController {\r\n    private VideoService videoService;\r\n\r\n    @PostMapping()\r\n    public ResponseEntity<String> saveVideo(@RequestParam("file") MultipartFile file, @RequestParam("name") String name) throws IOException {\r\n        videoService.saveVideo(file, name);\r\n        return ResponseEntity.ok("Video saved successfully.");\r\n    }\r\n\r\n    @GetMapping("{name}")\r\n    public ResponseEntity<Resource> getVideoByName(@PathVariable("name") String name){\r\n        return ResponseEntity\r\n                .ok(new ByteArrayResource(videoService.getVideo(name).getData()));\r\n    }\r\n\r\n    @GetMapping("all")\r\n    public ResponseEntity<List<String>> getAllVideoNames(){\r\n        return ResponseEntity\r\n                .ok(videoService.getAllVideoNames());\r\n    }\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"controller"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@GetMapping("/video")\r\npublic String video(){\r\n\treturn null;\r\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"video.html (view)"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<main>\r\n  \x3c!-- video list --\x3e\r\n  <div id="video-list">\r\n    <header>\r\n      <h3>Your videos</h3>\r\n    </header>\r\n    <ul id="your-videos"></ul>\r\n  </div>\r\n  \x3c!-- video player --\x3e\r\n  <div id="video-player">\r\n    <header>\r\n      <h3 id="now-playing"></h3>\r\n    </header>\r\n    <video\r\n      id="video-screen"\r\n      width="720px"\r\n      height="480px"\r\n      controls></video>\r\n  </div>\r\n  \x3c!-- video input --\x3e\r\n  <form id="video-form">\r\n    <fieldset>\r\n      <legend>Upload a video</legend>\r\n      <label for="file">Video File</label>\r\n      <input\r\n        id="file"\r\n        name="file"\r\n        type="file"\r\n        accept="application/mp4" />\r\n      <label for="name">Video Name</label>\r\n      <input\r\n        id="name"\r\n        name="name"\r\n        type="text" />\r\n      <button type="submit">Save</button>\r\n    </fieldset>\r\n  </form>\r\n</main>\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"js"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const form = document.querySelector("#video-form");\r\nconst videoDiv = document.querySelector("#video-player");\r\nconst videoScreen = document.querySelector("#video-screen");\r\n\r\nconst queryParams = Object.fromEntries(\r\n  new URLSearchParams(window.location.search)\r\n);\r\n/* get videoList */\r\nfetch("http://localhost:8080/video/all")\r\n  .then((result) => result.json())\r\n  .then((result) => {\r\n    const myVids = document.querySelector("#your-videos");\r\n    if (result.length > 0) {\r\n      for (let vid of result) {\r\n        const li = document.createElement("LI");\r\n        const link = document.createElement("A");\r\n        link.innerText = vid;\r\n        link.href =\r\n          window.location.origin + window.location.pathname + "?video=" + vid;\r\n        li.appendChild(link);\r\n        myVids.appendChild(li);\r\n      }\r\n    } else {\r\n      myVids.innerHTML = "No videos found";\r\n    }\r\n  });\r\n/* get videoData */\r\nif (queryParams.video) {\r\n  videoScreen.src = `http://localhost:8080/video/${queryParams.video}`;\r\n  videoDiv.style.display = "block";\r\n  document.querySelector("#now-playing").innerText =\r\n    "Now playing " + queryParams.video;\r\n}\r\n/* save video */\r\nform.addEventListener("submit", (ev) => {\r\n  ev.preventDefault();\r\n  let data = new FormData(form);\r\n  fetch("http://localhost:8080/video", {\r\n    method: "POST",\r\n    body: data,\r\n  })\r\n    .then((result) => result.text())\r\n    .then((_) => {\r\n      window.location.reload();\r\n    });\r\n});\n'})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);