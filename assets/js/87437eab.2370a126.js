"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[358930],{529087:(r,e,n)=>{n.d(e,{R:()=>a,x:()=>l});var s=n(596363);const t={},o=s.createContext(t);function a(r){const e=s.useContext(o);return s.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function l(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(t):r.components||t:a(r.components),s.createElement(o.Provider,{value:e},r.children)}},803034:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"db-postgres/postgres backup pg_rman","title":"postgres pg_rman","description":"rman : Recovery Manager","source":"@site/docs/db-postgres/postgres backup pg_rman.md","sourceDirName":"db-postgres","slug":"/db-postgres/postgres backup pg_rman","permalink":"/docs/db-postgres/postgres backup pg_rman","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"postgres backup pg_backup docker","permalink":"/docs/db-postgres/postgres backup pg_dump docker"},"next":{"title":"postgres recovery psql vs pg_restore","permalink":"/docs/db-postgres/postgres backup psql vs pg_restore"}}');var t=n(447259),o=n(529087);const a={},l="postgres pg_rman",i={},c=[{value:"install",id:"install",level:2},{value:"install error",id:"install-error",level:2},{value:"usage",id:"usage",level:2}];function p(r){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...r.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"postgres-pg_rman",children:"postgres pg_rman"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"rman : Recovery Manager"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"install",children:"install"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"tar -xf pg_rman-1.3.16-pg14.tar.gz\r\ncd pg_rman-1.3.16-pg14\r\nmake\r\nmake install\r\n\r\n# BACKUP_PATH \uc124\uc815\r\nvi ~/.bash_profile\r\n  export BACKUP_PATH=/home/ubuntu/backup\r\n  export PGDATA=/var/lib/pgsql/13/data\r\n  export ARCLOG_PATH=/home/ubuntu/archivedir\r\nsource ~/.bash_profile\r\n\r\n# postgresql.conf \uc124\uc815\r\narchive_mode = on\r\narchive_command = 'test ! -f /home/ubuntu/archivedir/%f && cp %p /home/ubuntu/archivedir/%f'\r\n\r\n# \ubc31\uc5c5 \uce74\ud0c8\ub85c\uadf8 \ucd08\uae30\ud654\r\npg_rman init\n"})}),"\n",(0,t.jsx)(e.h2,{id:"install-error",children:"install error"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"# error\r\npg_rman.h:13:10: fatal error: postgres_fe.h: No such file or directory\r\n   13 | #include \"postgres_fe.h\"\r\n# solution\r\napt install postgresql-server-dev-14\r\n\r\n# error\r\n/usr/bin/ld: cannot find -lselinux: No such file or directory\r\n/usr/bin/ld: cannot find -llz4: No such file or directory\r\n/usr/bin/ld: cannot find -lpam: No such file or directory\r\n/usr/bin/ld: cannot find -lgssapi_krb5: No such file or directory\r\n/usr/bin/ld: cannot find -lreadline: No such file or directory\r\n# solution\r\napt install libselinux1-dev liblz4-dev libpam0g-dev libkrb5-dev libreadline-dev -y\r\n\r\n# error\r\n/bin/mkdir -p '/usr/lib/postgresql/14/bin'\r\n/usr/bin/install -c  pg_rman '/usr/lib/postgresql/14/bin'\r\n/usr/bin/install: cannot create regular file '/usr/lib/postgresql/14/bin/pg_rman': Permission denied\r\n# solution\r\nchmod 755 /usr/lib/postgresql/14/bin\n"})}),"\n",(0,t.jsx)(e.h2,{id:"usage",children:"usage"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"# Full backup -- \uc804\uccb4 \ub370\uc774\ud130\ubca0\uc774\uc2a4 \ud074\ub7ec\uc2a4\ud130\ub97c \ubc31\uc5c5\r\npg_rman backup -b full -d mydb\r\n\r\n# Incremental backup -- \ub3d9\uc77c\ud55c \ud0c0\uc784\ub77c\uc778\uc73c\ub85c \ub9c8\uc9c0\ub9c9 \ud655\uc778\ub41c \ubc31\uc5c5 \uc774\ud6c4\uc5d0 \"\uc218\uc815\ub41c \ud30c\uc77c \ub610\ub294 \ud398\uc774\uc9c0\ub9cc \ubc31\uc5c5\" (\uc99d\ubd84\ubc31\uc5c5)\r\npg_rman backup -b incremental -d mydb\r\n\r\n# Archive WAL backup -- \uc544\uce74\uc774\ube0c WAL \ud30c\uc77c\ub9cc \ubc31\uc5c5\r\npg_rman backup -b archive -d mydb\r\n\r\n# \ubc31\uc5c5 \ud655\uc778\r\npg_rman show\r\n\r\n# \uc720\ud6a8\uc131 \uac80\uc0ac\r\npg_rman validate\r\n\r\n# \uc0ad\uc81c\r\npg_rman delete 2021-08-05 13:37:27\r\npg_rman purge # \uc0ad\uc81c\ub41c \ubc31\uc5c5\uc758 \uce74\ud0c8\ub85c\uadf8 \uc815\ubcf4 \uc0ad\uc81c\r\n\r\n# \ubcf5\uad6c\r\npg_ctl stop\r\n# --hard-copy : \uc544\uce74\uc774\ube0c \ub85c\uadf8 \ubcf5\uc0ac \ud6c4 \ubcf5\uad6c\r\npg_rman restore --hard-copy\r\npg_rman restore --hard-copy --recovery-target-time '2024-05-18 16:55:00' # \uc2dc\uac04\uc73c\ub85c \ubcf5\uad6c\r\npg_rman restore --hard-copy --recovery-target-timeline=4 # \ud0c0\uc784\ub77c\uc778 4\ub85c \ubcf5\uad6c\r\npg_ctl start\n"})})]})}function d(r={}){const{wrapper:e}={...(0,o.R)(),...r.components};return e?(0,t.jsx)(e,{...r,children:(0,t.jsx)(p,{...r})}):p(r)}}}]);