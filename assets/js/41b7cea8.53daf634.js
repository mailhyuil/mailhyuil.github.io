"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["481193"],{947319:function(n,r,e){e.r(r),e.d(r,{frontMatter:()=>t,toc:()=>l,default:()=>u,metadata:()=>s,assets:()=>c,contentTitle:()=>a});var s=JSON.parse('{"id":"angular/angular worker service worker webpush \uC6F9 \uD478\uC2DC - PWA","title":"angular pwa webpush \uC6F9\uD478\uC2DC","description":"web-push\uB97C \uC0AC\uC6A9\uD558\uC5EC pushSubscription\uC744 \uC0DD\uC131\uD558\uACE0 \uC11C\uBC84\uC5D0 \uC800\uC7A5","source":"@site/docs/angular/angular worker service worker webpush \uC6F9 \uD478\uC2DC - PWA.md","sourceDirName":"angular","slug":"/angular/angular worker service worker webpush \uC6F9 \uD478\uC2DC - PWA","permalink":"/docs/angular/angular worker service worker webpush \uC6F9 \uD478\uC2DC - PWA","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"angular PWA","permalink":"/docs/angular/angular worker service worker - PWA"},"next":{"title":"angular web worker","permalink":"/docs/angular/angular worker web worker"}}'),i=e(447259),o=e(255511);let t={},a="angular pwa webpush \uC6F9\uD478\uC2DC",c={},l=[{value:"\uC870\uAC74",id:"\uC870\uAC74",level:2},{value:"install",id:"install",level:2},{value:"worker.js",id:"workerjs",level:2},{value:"angular.json (project.json)",id:"angularjson-projectjson",level:2},{value:"app.config.ts",id:"appconfigts",level:2},{value:"window.service.ts",id:"windowservicets",level:2},{value:"SwPush \uC0AC\uC6A9",id:"swpush-\uC0AC\uC6A9",level:2},{value:"\uC11C\uBC84",id:"\uC11C\uBC84",level:2},{value:"main.ts",id:"maints",level:3},{value:"web-push.controller.ts",id:"web-pushcontrollerts",level:3}];function p(n){let r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"angular-pwa-webpush-\uC6F9\uD478\uC2DC",children:"angular pwa webpush \uC6F9\uD478\uC2DC"})}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"web-push\uB97C \uC0AC\uC6A9\uD558\uC5EC pushSubscription\uC744 \uC0DD\uC131\uD558\uACE0 \uC11C\uBC84\uC5D0 \uC800\uC7A5"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uC54C\uB9BC\uC744 \uBCF4\uB0BC \uB550 web-push\uB97C \uC0AC\uC6A9\uD558\uC5EC \uC800\uC7A5\uB41C pushSubscription\uC744 \uC0AC\uC6A9\uD558\uC5EC \uC54C\uB9BC\uC744 \uBCF4\uB0B8\uB2E4."}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uC54C\uB9BC\uC744 \uB744\uC6B0\uAE30 \uC704\uD574\uC11C\uB294 \uBC31\uADF8\uB77C\uC6B4\uB4DC\uC5D0\uC11C \uB3D9\uC791\uD558\uACE0 \uC788\uB294 \uC11C\uBE44\uC2A4 \uC6CC\uCEE4\uAC00 \uC0AC\uC6A9\uB41C\uB2E4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"\uC870\uAC74",children:"\uC870\uAC74"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uBE0C\uB77C\uC6B0\uC800\uAC00 web push api\uB97C \uC9C0\uC6D0\uD574\uC57C \uD55C\uB2E4."}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uC0AC\uC6A9\uC790\uAC00 \uC6F9 \uC54C\uB9BC \uAD8C\uD55C\uC744 \uD5C8\uC6A9\uD574\uC57C \uD55C\uB2E4."}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uC6F9 \uC6CC\uCEE4\uB97C \uB4F1\uB85D\uD558\uACE0 \uC6F9 \uC6CC\uCEE4 \uD504\uB85C\uC138\uC2A4\uAC00 \uC2E4\uD589\uB418\uC5B4\uC57C \uD55C\uB2E4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"install",children:"install"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sh",children:"ng add @angular/pwa\r\n\r\n# web-push \uC124\uCE58\r\nnpm install -D web-push\r\n# vapid public key, vapid private key \uC0DD\uC131\r\nnpx web-push generate-vapid-keys\n"})}),"\n",(0,i.jsx)(r.h2,{id:"workerjs",children:"worker.js"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uD478\uC2DC\uB97C \uBC1B\uC744 \uB54C \uC54C\uB9BC\uC744 \uB744\uC6B0\uB294 \uB85C\uC9C1 \uAD6C\uD604"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"angular.json(project.json)\uC5D0\uC11C assets\uC5D0 \uC774 \uD30C\uC77C\uC774 \uCD94\uAC00\uB418\uB3C4\uB85D \uC124\uC815"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"ServiceWorkerModule.register('my-worker.js'), // \uC218\uC815"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-js",children:'/// \uC774 \uCF54\uB4DC\uB294 WorkerGlobalScope\uC5D0\uC11C \uB3D9\uC791\uD558\uB294 \uCF54\uB4DC\uC785\uB2C8\uB2E4.\r\nimportScripts("ngsw-worker.js");\r\n\r\nself.addEventListener("push", e => {\r\n  const { title, body, ...data } = e.data.json();\r\n\r\n  if (!title || !body) {\r\n    return;\r\n  }\r\n\r\n  self.registration.showNotification(title, { body, data });\r\n});\r\n\r\nself.addEventListener("notificationclick", e => {\r\n  const url = e.notification?.data?.url;\r\n\r\n  if (!url) {\r\n    return;\r\n  }\r\n\r\n  self.clients.openWindow(url);\r\n});\n'})}),"\n",(0,i.jsx)(r.h2,{id:"angularjson-projectjson",children:"angular.json (project.json)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'assets: [\r\n  "src/worker.js",\r\n  ...\r\n],\n'})}),"\n",(0,i.jsx)(r.h2,{id:"appconfigts",children:"app.config.ts"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:'ServiceWorkerModule.register("worker.js") \uCD94\uAC00'}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'export const appConfig: ApplicationConfig = {\r\n  providers: [importProvidersFrom([ServiceWorkerModule.register("worker.js")])],\r\n};\n'})}),"\n",(0,i.jsx)(r.h2,{id:"windowservicets",children:"window.service.ts"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uBE0C\uB77C\uC6B0\uC800\uAC00 \uC9C0\uC6D0\uD558\uB294\uC9C0 \uD655\uC778"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'import { compare } from "compare-versions";\r\nimport UAParser from "ua-parser-js";\r\n\r\n@Injectable()\r\nexport class WindowService {\r\n  isSupportNotification = false;\r\n\r\n  constructor() {\r\n    const {\r\n      browser: { name, version },\r\n    } = new UAParser().getResult();\r\n\r\n    // \uACF5\uC2DD \uBB38\uC11C \uAE30\uC900\uC73C\uB85C \uD544\uD130\uB9C1\r\n    this.isSupportNotification =\r\n      "Notification" in window &&\r\n      !!version &&\r\n      (name === "Chrome" ||\r\n        compare(version, "52", ">=") ||\r\n        name === "Edge" ||\r\n        compare(version, "17", ">=") ||\r\n        name === "Firefox" ||\r\n        compare(version, "46", ">="));\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"swpush-\uC0AC\uC6A9",children:"SwPush \uC0AC\uC6A9"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'export class NotificationComponent {\r\n  constructor(\r\n    private readonly swPush: SwPush,\r\n    private readonly httpClient: HttpClient,\r\n    protected readonly windowService: WindowService,\r\n  ) {}\r\n\r\n  async onClick() {\r\n    // \uBE0C\uB77C\uC6B0\uC800\uAC00 \uC9C0\uC6D0\uD558\uC9C0 \uC54A\uC73C\uBA74 \uC885\uB8CC\r\n    if (!this.windowService.isSupportNotification) return;\r\n\r\n    // PushSubscription\uAC1D\uCCB4\uB97C \uC11C\uBC84\uB85C \uC804\uC1A1 \uBC0F DB\uC5D0 \uC800\uC7A5\r\n    const pushSubscription = await this.swPush.requestSubscription({ serverPublicKey: environment.VAPIDPublicKey });\r\n    this.httpClient.post("web-push/subscribe", pushSubscription).subscribe();\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"\uC11C\uBC84",children:"\uC11C\uBC84"}),"\n",(0,i.jsx)(r.h3,{id:"maints",children:"main.ts"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'import { NestFactory } from "@nestjs/core";\r\nimport { AppModule } from "./app.module";\r\nimport * as webPush from "web-push";\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n\r\n  webPush.setVapidDetails(\r\n    "mailto:<\uAD00\uB9AC\uC6A9 \uC774\uBA54\uC77C \uC8FC\uC18C \uAE30\uC785>",\r\n    process.env.VAPID_PUBLIC_KEY,\r\n    process.env.VAPID_PRIVATE_KEY,\r\n  );\r\n\r\n  await app.listen(3000);\r\n}\r\nbootstrap();\n'})}),"\n",(0,i.jsx)(r.h3,{id:"web-pushcontrollerts",children:"web-push.controller.ts"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"pushSubscription\uC744 DB\uC5D0 \uC800\uC7A5\uD558\uACE0"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uC54C\uB9BC\uC744 \uBCF4\uB0B4\uC57C \uD560 \uB550 \uC544\uB798\uC640 \uAC19\uC774 \uC800\uC7A5\uD588\uB358 pushSubscription\uC744 sendNotification\uC758 \uC778\uC790\uB85C \uBCF4\uB0B4\uBA74 \uB41C\uB2E4."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ts",children:'import { Controller, Post, Body } from "@nestjs/common";\r\nimport * as webPush from "web-push";\r\n\r\n@Controller("web-push")\r\nexport class WebPushController {\r\n  constructor(private readonly prisma: PrismaService) {}\r\n  @Post("subscribe")\r\n  async subscribe(@Body() body: { subscription: PushSubscription }) {\r\n    console.log("Received subscription:", subscription);\r\n\r\n    // subscription\uC744 DB\uC5D0 \uC800\uC7A5\r\n    await this.prisma.pushSubscription.create({\r\n      data: {\r\n        subscription,\r\n      },\r\n    });\r\n\r\n    return { success: true };\r\n  }\r\n\r\n  @OnEvent("web-push.send")\r\n  async send(notification: { title: string; body: string }) {\r\n    const payload = JSON.stringify(notification);\r\n\r\n    const subscriptions = await this.prisma.pushSubscription.findMany();\r\n\r\n    try {\r\n      for (const { subscription } of subscriptions) {\r\n        await webPush.sendNotification(subscription, payload);\r\n      }\r\n    } catch (err) {\r\n      console.error("Error sending notification, reason: ", err);\r\n    }\r\n  }\r\n}\n'})})]})}function u(n={}){let{wrapper:r}={...(0,o.R)(),...n.components};return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}},255511:function(n,r,e){e.d(r,{R:()=>t,x:()=>a});var s=e(596363);let i={},o=s.createContext(i);function t(n){let r=s.useContext(o);return s.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function a(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),s.createElement(o.Provider,{value:r},n.children)}}}]);