"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[436438],{367987:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"nodejs/nodejs webRTC","title":"nodejs webRTC","description":"web realtime communication","source":"@site/docs/nodejs/nodejs webRTC.md","sourceDirName":"nodejs","slug":"/nodejs/nodejs webRTC","permalink":"/docs/nodejs/nodejs webRTC","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"n","permalink":"/docs/nodejs/nodejs version"},"next":{"title":"nodejs webcontainer","permalink":"/docs/nodejs/nodejs webcontainer"}}');var t=r(447259),i=r(529087);const s={},c="nodejs webRTC",l={},a=[{value:"SDP (Session Description Protocol)",id:"sdp-session-description-protocol",level:2},{value:"ICE (Interactive Connectivity Establishment)",id:"ice-interactive-connectivity-establishment",level:2},{value:"STUN (Session Traversal Utilities for NAT)",id:"stun-session-traversal-utilities-for-nat",level:2},{value:"TURN (Traversal Using Relays around NAT)",id:"turn-traversal-using-relays-around-nat",level:2},{value:"install",id:"install",level:2},{value:"\ubc31\uc5d4\ub4dc",id:"\ubc31\uc5d4\ub4dc",level:2},{value:"\ud504\ub860\ud2b8\uc5d4\ub4dc",id:"\ud504\ub860\ud2b8\uc5d4\ub4dc",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"nodejs-webrtc",children:"nodejs webRTC"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"web realtime communication"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"peer to peer(p2p) \ubc29\uc2dd\uc73c\ub85c \uc2e4\uc2dc\uac04 \ud1b5\uc2e0\uc744 \uac00\ub2a5\ud558\uac8c \ud574\uc8fc\ub294 \uae30\uc220 (\ud074\ub77c\uc774\uc5b8\ud2b8\ub4e4 \ub07c\ub9ac \ud1b5\uc2e0)"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"UDP\ub97c \uae30\ubc18\uc73c\ub85c \uc2e4\uc2dc\uac04 \ud1b5\uc2e0\uc744 \uac00\ub2a5\ud558\uac8c \ud574\uc900\ub2e4."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"nodejs\ub85c\ub294 \ucd08\uae30 \uc815\ubcf4(ice candidate, sdp \ub4f1)\ub97c \uad50\ud658\ud558\ub294 \uc5ed\ud560\uc744 \ud558\ub294 signaling server\ub97c \uad6c\ud604"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"sdp-session-description-protocol",children:"SDP (Session Description Protocol)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"peerConnection.localDescription"}),"\n",(0,t.jsx)(n.li,{children:"\ubbf8\ub514\uc5b4 \uc138\uc158\uc744 \uc124\uba85\ud558\ub294 \ud504\ub85c\ud1a0\ucf5c"}),"\n",(0,t.jsx)(n.li,{children:"\ubbf8\ub514\uc5b4 \uc720\ud615, \ud3ec\ud2b8, \ucf54\ub371, \ud574\uc0c1\ub3c4 \ub4f1\uc758 \uc815\ubcf4\ub97c \ud3ec\ud568"}),"\n",(0,t.jsx)(n.li,{children:"WebRTC\uc5d0\uc11c\ub294 SDP\ub97c \ud1b5\ud574 \ubbf8\ub514\uc5b4 \uc815\ubcf4\ub97c \uad50\ud658"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"ice-interactive-connectivity-establishment",children:"ICE (Interactive Connectivity Establishment)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'"WebRTC \uc5f0\uacb0\uc744 \uc124\uc815\ud558\ub294 \uc804\uccb4 \uacfc\uc815"\uc744 \ub2f4\ub2f9\ud558\ub294 \ud504\ub85c\ud1a0\ucf5c'}),"\n",(0,t.jsx)(n.li,{children:"P2P \uc5f0\uacb0\uc744 \uc704\ud55c \ucd5c\uc801\uc758 \ub124\ud2b8\uc6cc\ud06c \uacbd\ub85c\ub97c \ud0d0\uc0c9"}),"\n",(0,t.jsx)(n.li,{children:"ice-candidate\ub780 \ub124\ud2b8\uc6cc\ud06c \uc815\ubcf4(ip, port)\ub97c \uad50\ud658\ud558\ub294 \uac83 (\uc9c1\uc811\uad50\ud658, STUN\uc744 \ud1b5\ud55c \uad50\ud658, TURN\uc744 \ud1b5\ud55c \uad50\ud658)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"stun-session-traversal-utilities-for-nat",children:"STUN (Session Traversal Utilities for NAT)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"NAT \ub4a4\uc5d0 \uc788\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8\uc758 \uacf5\uc6a9 IP \uc8fc\uc18c\ub97c \ucc3e\uc544\uc11c \ubc18\ud658\ud574\uc8fc\ub294 \uc11c\ubc84"}),"\n",(0,t.jsx)(n.li,{children:"NAT \ud658\uacbd\uc5d0\uc11c \uacf5\uc6a9 IP\ub97c \ucc3e\uc544 P2P \uc5f0\uacb0\uc744 \uac00\ub2a5\ud558\uac8c \ud574\uc90c"}),"\n",(0,t.jsx)(n.li,{children:"[Peer A - \uc0ac\uc124 IP] \u2192 (STUN \uc11c\ubc84) \u2192 [Peer B - \uc0ac\uc124 IP]"}),"\n",(0,t.jsx)(n.li,{children:"\ubb34\ub8cc \uc11c\ube44\uc2a4\uac00 \ub9ce\ub2e4 (\uc9c1\uc811 \uad6c\ucd95\ud560 \uc218\ub3c4 \uc788\uc74c)"}),"\n",(0,t.jsxs)(n.li,{children:["google STUN \uc11c\ubc84: stun",":stun",".l.google.com:19302"]}),"\n",(0,t.jsxs)(n.li,{children:["twilio STUN \uc11c\ubc84: stun",":global",".stun.twilio.com"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"turn-traversal-using-relays-around-nat",children:"TURN (Traversal Using Relays around NAT)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\ubc29\ud654\ubcbd\uc73c\ub85c \uc778\ud574 P2P \uc5f0\uacb0\uc774 \ubd88\uac00\ub2a5\ud560 \ub54c \uc0ac\uc6a9\ud558\ub294 \uc11c\ubc84"}),"\n",(0,t.jsx)(n.li,{children:"P2P \uc5f0\uacb0\uc774 \ubd88\uac00\ub2a5\ud560 \ub54c, TURN \uc11c\ubc84\ub97c \ud1b5\ud574 \ub370\uc774\ud130\ub97c \uc804\ub2ec"}),"\n",(0,t.jsx)(n.li,{children:"[Peer A] \u2192 (TURN \uc11c\ubc84 \uc911\uacc4) \u2192 [Peer B]"}),"\n",(0,t.jsx)(n.li,{children:"twilio, xirsys \ub4f1\uc744 \uc0ac\uc6a9 (\ub300\ubd80\ubd84 \uc720\ub8cc)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"install",children:"install"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"# \ud504\ub860\ud2b8\uc5d4\ub4dc \uc11c\ubc84\r\nnpm i socket.io-client\r\n# \ubc31\uc5d4\ub4dc \uc11c\ubc84\r\nnpm i socket.io\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\ubc31\uc5d4\ub4dc",children:"\ubc31\uc5d4\ub4dc"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Signaling Server"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"WebRTC \ud53c\uc5b4 \uac04 \uc9c1\uc811 \uc5f0\uacb0\ud558\uae30 \uc704\ud574 \ud544\uc694\ud55c \uc815\ubcf4\ub97c \uad50\ud658\ud558\ub294 \uc11c\ubc84"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\uc0c1\ub300 \ube0c\ub77c\uc6b0\uc800\uc758 ip, port, \ubc29\ud654\ubcbd, \ub77c\uc6b0\ud130 \ub4f1\ub4f1\uc758 \uc815\ubcf4\ub97c \uc54c\ub824\uc8fc\ub294 \uc11c\ubc84"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const express = require("express");\r\nconst http = require("http");\r\nconst socketIo = require("socket.io");\r\n\r\nconst app = express();\r\nconst server = http.createServer(app);\r\nconst io = socketIo(server);\r\n\r\nio.on("connection", socket => {\r\n  console.log("\uc0ac\uc6a9\uc790 \uc5f0\uacb0\ub428:", socket.id);\r\n\r\n  // \ud2b9\uc815 \ubc29 \ucc38\uac00\r\n  socket.on("join", roomId => {\r\n    socket.join(roomId);\r\n    console.log(`\uc0ac\uc6a9\uc790 ${socket.id}\uac00 \ubc29 ${roomId}\uc5d0 \ucc38\uac00`);\r\n\r\n    // \ubc29\uc5d0 \ub450 \uba85\uc774 \uc788\uc73c\uba74 \ud1b5\uc2e0 \uc2dc\uc791\r\n    const clients = io.sockets.adapter.rooms.get(roomId);\r\n    if (clients.size === 2) {\r\n      io.to(roomId).emit("ready");\r\n    }\r\n  });\r\n\r\n  // offer(\ucd08\uae30 \uc5f0\uacb0 \uc694\uccad) \uc804\ub2ec\r\n  socket.on("offer", (offer, roomId) => {\r\n    socket.to(roomId).emit("offer", offer);\r\n  });\r\n\r\n  // answer(\uc751\ub2f5) \uc804\ub2ec\r\n  socket.on("answer", (answer, roomId) => {\r\n    socket.to(roomId).emit("answer", answer);\r\n  });\r\n\r\n  // ICE candidate \uc804\ub2ec\r\n  socket.on("ice-candidate", (candidate, roomId) => {\r\n    socket.to(roomId).emit("ice-candidate", candidate);\r\n  });\r\n\r\n  socket.on("disconnect", () => {\r\n    console.log("\uc0ac\uc6a9\uc790 \uc5f0\uacb0 \ud574\uc81c:", socket.id);\r\n  });\r\n});\r\n\r\nserver.listen(3000, () => {\r\n  console.log("Signaling Server\uac00 3000\ubc88 \ud3ec\ud2b8\uc5d0\uc11c \uc2e4\ud589 \uc911...");\r\n});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\ud504\ub860\ud2b8\uc5d4\ub4dc",children:"\ud504\ub860\ud2b8\uc5d4\ub4dc"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"mediaDevices API \uc0ac\uc6a9"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\r\n<html lang="ko">\r\n  <head>\r\n    <meta charset="UTF-8" />\r\n    <meta name="viewport" content="width=device-width, initial-scale=1.0" />\r\n    <title>WebRTC P2P Video</title>\r\n  </head>\r\n  <body>\r\n    <h1>WebRTC P2P Video Chat</h1>\r\n    <video id="localVideo" autoplay playsinline></video>\r\n    <video id="remoteVideo" autoplay playsinline></video>\r\n\r\n    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"><\/script>\r\n    <script>\r\n      const socket = io("http://localhost:3000");\r\n      const roomId = "testRoom";\r\n      let localStream, peerConnection;\r\n\r\n      // STUN \uc11c\ubc84 \uc124\uc815 (\uacf5\uc6a9 STUN \uc0ac\uc6a9)\r\n      const iceServers = {\r\n        iceServers: [{ urls: "stun:stun.l.google.com:19302" }],\r\n      };\r\n\r\n      async function startVideoChat() {\r\n        // \uce74\uba54\ub77c \ubc0f \ub9c8\uc774\ud06c \uc2a4\ud2b8\ub9bc \uac00\uc838\uc624\uae30\r\n        localStream = await navigator.mediaDevices.getUserMedia({\r\n          video: true,\r\n          audio: true,\r\n        });\r\n        document.getElementById("localVideo").srcObject = localStream;\r\n\r\n        // \ubc29\uc5d0 \ucc38\uac00\r\n        socket.emit("join", roomId);\r\n      }\r\n\r\n      // WebRTC \uc5f0\uacb0 \uc0dd\uc131\r\n      function createPeerConnection() {\r\n        peerConnection = new RTCPeerConnection(iceServers);\r\n\r\n        // \ub85c\uceec \uc2a4\ud2b8\ub9bc\uc744 P2P \uc5f0\uacb0\uc5d0 \ucd94\uac00\r\n        localStream.getTracks().forEach(track => {\r\n          peerConnection.addTrack(track, localStream);\r\n        });\r\n\r\n        // ICE candidate \uc774\ubca4\ud2b8 \uc218\uc2e0\r\n        peerConnection.onicecandidate = event => {\r\n          if (event.candidate) {\r\n            socket.emit("ice-candidate", event.candidate, roomId);\r\n          }\r\n        };\r\n\r\n        // \uc6d0\uaca9 \uc2a4\ud2b8\ub9bc \uc218\uc2e0\r\n        peerConnection.ontrack = event => {\r\n          document.getElementById("remoteVideo").srcObject = event.streams[0];\r\n        };\r\n      }\r\n\r\n      // \uc0c1\ub300\ubc29\uacfc \uc5f0\uacb0 \uc900\ube44 \uc644\ub8cc \uc2dc\r\n      socket.on("ready", async () => {\r\n        createPeerConnection();\r\n\r\n        const offer = await peerConnection.createOffer();\r\n        await peerConnection.setLocalDescription(offer);\r\n        socket.emit("offer", offer, roomId);\r\n      });\r\n\r\n      // \uc0c1\ub300\ubc29\uc758 offer \uc218\uc2e0\r\n      socket.on("offer", async offer => {\r\n        createPeerConnection();\r\n\r\n        await peerConnection.setRemoteDescription(offer);\r\n        const answer = await peerConnection.createAnswer();\r\n        await peerConnection.setLocalDescription(answer);\r\n        socket.emit("answer", answer, roomId);\r\n      });\r\n\r\n      // \uc0c1\ub300\ubc29\uc758 answer \uc218\uc2e0\r\n      socket.on("answer", async answer => {\r\n        await peerConnection.setRemoteDescription(answer);\r\n      });\r\n\r\n      // ICE candidate \uc218\uc2e0\r\n      socket.on("ice-candidate", async candidate => {\r\n        await peerConnection.addIceCandidate(new RTCIceCandidate(candidate));\r\n      });\r\n\r\n      startVideoChat();\r\n    <\/script>\r\n  </body>\r\n</html>\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},529087:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>c});var o=r(596363);const t={},i=o.createContext(t);function s(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);