"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[546974],{529087:(n,r,o)=>{o.d(r,{R:()=>t,x:()=>l});var a=o(596363);const i={},e=a.createContext(i);function t(n){const r=a.useContext(e);return a.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function l(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),a.createElement(e.Provider,{value:r},n.children)}},750105:(n,r,o)=>{o.r(r),o.d(r,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>g});const a=JSON.parse('{"id":"logging & monitoring & profiling & tracing/grafana + loki + promtail","title":"grafana + loki + promtail","description":"docker-compose.yml","source":"@site/docs/logging & monitoring & profiling & tracing/grafana + loki + promtail.md","sourceDirName":"logging & monitoring & profiling & tracing","slug":"/logging & monitoring & profiling & tracing/grafana + loki + promtail","permalink":"/docs/logging & monitoring & profiling & tracing/grafana + loki + promtail","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"grafana + loki + fluent-bit","permalink":"/docs/logging & monitoring & profiling & tracing/grafana + loki + fluent-bit"},"next":{"title":"grafana alerting","permalink":"/docs/logging & monitoring & profiling & tracing/grafana alerting"}}');var i=o(447259),e=o(529087);const t={},l="grafana + loki + promtail",s={},g=[{value:"docker-compose.yml",id:"docker-composeyml",level:2},{value:"/promtail/config.yml",id:"promtailconfigyml",level:2}];function c(n){const r={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,e.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"grafana--loki--promtail",children:"grafana + loki + promtail"})}),"\n",(0,i.jsx)(r.h2,{id:"docker-composeyml",children:"docker-compose.yml"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'services:\r\n  loki:\r\n    image: grafana/loki:latest\r\n    ports:\r\n      - "3100:3100"\r\n    command: -config.file=/etc/loki/local-config.yaml\r\n    networks:\r\n      - loki\r\n\r\n  promtail:\r\n    image: grafana/promtail:latest\r\n    volumes:\r\n      - /var/log:/var/log\r\n      - ./promtail:/etc/promtail\r\n    command: -config.file=/etc/promtail/config.yml\r\n    networks:\r\n      - loki\r\n\r\n  grafana:\r\n    environment:\r\n      - GF_PATHS_PROVISIONING=/etc/grafana/provisioning\r\n      - GF_FEATURE_TOGGLES_ENABLE=alertingSimplifiedRouting,alertingQueryAndExpressionsStepMode\r\n    entrypoint:\r\n      - sh\r\n      - -euc\r\n      - |\r\n        mkdir -p /etc/grafana/provisioning/datasources\r\n        cat <<EOF > /etc/grafana/provisioning/datasources/ds.yaml\r\n        apiVersion: 1\r\n        datasources:\r\n        - name: Loki\r\n          type: loki\r\n          access: proxy \r\n          orgId: 1\r\n          url: http://loki:3100\r\n          basicAuth: false\r\n          isDefault: true\r\n          version: 1\r\n          editable: false\r\n        EOF\r\n        /run.sh\r\n    image: grafana/grafana:latest\r\n    ports:\r\n      - "3000:3000"\r\n    networks:\r\n      - loki\r\nnetworks:\r\n  loki:\n'})}),"\n",(0,i.jsx)(r.h2,{id:"promtailconfigyml",children:"/promtail/config.yml"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"server:\r\n  http_listen_port: 9080\r\n  grpc_listen_port: 0\r\n\r\npositions:\r\n  filename: /tmp/positions.yaml\r\n\r\nclients:\r\n  - url: http://loki:3100/loki/api/v1/push\r\n\r\nscrape_configs:\r\n  - job_name: myapp\r\n    static_configs:\r\n      - targets:\r\n          - localhost\r\n        labels:\r\n          job: myapp-info\r\n          __path__: /var/log/myapp/info/*log\r\n      - targets:\r\n          - localhost\r\n        labels:\r\n          job: myapp-error\r\n          __path__: /var/log/myapp/error/*log\r\n      - targets:\r\n          - localhost\r\n        labels:\r\n          job: myapp-warn\r\n          __path__: /var/log/myapp/warn/*log\n"})})]})}function p(n={}){const{wrapper:r}={...(0,e.R)(),...n.components};return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(c,{...n})}):c(n)}}}]);