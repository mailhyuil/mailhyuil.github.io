"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[769669],{201713:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"how to implement/\uc790\ub3d9 \ub85c\uadf8\uc778 \uc138\uc158 \uad6c\ud604","title":"\uc790\ub3d9 \ub85c\uadf8\uc778 \uc138\uc158 \uad6c\ud604","description":"\uc790\ub3d9 \ub85c\uadf8\uc778 \uccb4\ud06c\ubc15\uc2a4\ub97c \uccb4\ud06c \uc5ec\ubd80\ub97c boolean\uc73c\ub85c \ubc1b\uc74c","source":"@site/docs/how to implement/\uc790\ub3d9 \ub85c\uadf8\uc778 \uc138\uc158 \uad6c\ud604.md","sourceDirName":"how to implement","slug":"/how to implement/\uc790\ub3d9 \ub85c\uadf8\uc778 \uc138\uc158 \uad6c\ud604","permalink":"/docs/how to implement/\uc790\ub3d9 \ub85c\uadf8\uc778 \uc138\uc158 \uad6c\ud604","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\uc784\uc2dc \uc800\uc7a5","permalink":"/docs/how to implement/\uc784\uc2dc \uc800\uc7a5"},"next":{"title":"\uc870\ud68c\uc218","permalink":"/docs/how to implement/\uc870\ud68c\uc218"}}');var s=r(447259),i=r(529087);const o={},a="\uc790\ub3d9 \ub85c\uadf8\uc778 \uc138\uc158 \uad6c\ud604",c={},d=[{value:"prisma",id:"prisma",level:2},{value:"AuthService",id:"authservice",level:2},{value:"AuthGuard",id:"authguard",level:2}];function l(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\uc790\ub3d9-\ub85c\uadf8\uc778-\uc138\uc158-\uad6c\ud604",children:"\uc790\ub3d9 \ub85c\uadf8\uc778 \uc138\uc158 \uad6c\ud604"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uc790\ub3d9 \ub85c\uadf8\uc778 \uccb4\ud06c\ubc15\uc2a4\ub97c \uccb4\ud06c \uc5ec\ubd80\ub97c boolean\uc73c\ub85c \ubc1b\uc74c"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uc0ac\uc6a9\uc790 \ub85c\uadf8\uc778\uc774 \uc131\uacf5\ud558\uba74 \uc790\ub3d9 \ub85c\uadf8\uc778 \uccb4\ud06c \uc5ec\ubd80\ub97c \ud655\uc778\ud558\uc5ec \uc138\uc158\uc5d0 \uc0ac\uc6a9\uc790 \uc815\ubcf4\ub97c \uc800\uc7a5"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uc138\uc158\uac12, \ucfe0\ud0a4 \ub9cc\ub8cc\uc2dc\uac04\uc744 \ucfe0\ud0a4\uc5d0 \ub2f4\uc544\uc11c \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 \uc804\ub2ec \ubc0f DB\uc5d0 \uc800\uc7a5"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\ud074\ub77c\uc774\uc5b8\ud2b8\ub294 \ucfe0\ud0a4\ub97c \ub85c\uceec\uc5d0 \uc800\uc7a5"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uc0ac\uc6a9\uc790\uac00 \ub2e4\uc74c\uc5d0 \ud398\uc774\uc9c0\uc5d0 \uc811\uc18d\ud558\uba74, \ub85c\uceec\uc5d0 \uc800\uc7a5\ub41c \ucfe0\ud0a4\ub97c \uc11c\ubc84\uc5d0 \uc804\ub2ec"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uc11c\ubc84\uc5d0\uc11c \uc138\uc158\uac12\uc73c\ub85c \uc720\uc800\ub97c \uc870\ud68c\ud558\uc5ec \uc874\uc7ac\ud558\uba74 \ub85c\uadf8\uc778 \ucc98\ub9ac"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prisma",children:"prisma"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prisma",children:"model User {\r\n    id String @id @default(uuid())\r\n    email String @unique\r\n    password String\r\n    name String\r\n\r\n    sessionId String? @unique\r\n\r\n    createdAt DateTime @default(now())\r\n    updatedAt DateTime @updatedAt\r\n    deletedAt DateTime?\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"authservice",children:"AuthService"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"export class AuthService {\r\n  constructor(private readonly prisma: PrismaService) {}\r\n  login(data: LoginDto, session: Record<string, any>) {\r\n    const user = this.findByUsername(data.username);\r\n\r\n    /// \uc790\ub3d9 \ub85c\uadf8\uc778 \uc124\uc815\r\n    if (data.autoLogin) {\r\n      session.user = user; // \uc138\uc158\uc5d0 \uc0ac\uc6a9\uc790 \uc815\ubcf4 \uc800\uc7a5\r\n      session.cookie.maxAge = 604800000; // \ucfe0\ud0a4 \ub9cc\ub8cc \uc2dc\uac04 \uc124\uc815 (\uc608: 7\uc77c)\r\n      // DB\uc5d0 \uc138\uc158 \uc815\ubcf4 \uc800\uc7a5\r\n      this.prisma.user.update({\r\n        where: { id: user.id },\r\n        data: { sessionId: session.id },\r\n      });\r\n    }\r\n\r\n    return user;\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"authguard",children:"AuthGuard"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'@Injectable()\r\nexport class AuthGuard implements CanActivate {\r\n  constructor(private readonly authService: AuthService, private readonly jwtService: JwtService) {}\r\n  async canActivate(context: ExecutionContext) {\r\n    const request = context.switchToHttp().getRequest();\r\n    const sessionId = request.cookies["SESSIONID"];\r\n    if (sessionId) {\r\n      const user = await this.authService.findBySessionId(sessionId);\r\n      if (user) {\r\n        request.user = user;\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},529087:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(596363);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);