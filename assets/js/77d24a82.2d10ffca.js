"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["139393"],{424290:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>c,toc:()=>l,default:()=>d,metadata:()=>t,assets:()=>i,contentTitle:()=>a});var t=JSON.parse('{"id":"javascript/js deadlock - \uAD50\uCC29\uC0C1\uD0DC","title":"js deadlock","description":"\uB450\uAC1C \uC774\uC0C1\uC758 \uACF5\uC720\uC790\uC6D0\uC774 \uC788\uC744 \uB54C \uB450\uAC1C \uC774\uC0C1\uC758 task\uAC00 \uAC01 \uC790\uC6D0\uC744 \uC120\uC810\uD558\uACE0 \uC11C\uB85C\uC758 \uACF5\uC720\uC790\uC6D0\uC744 \uC0AC\uC6A9\uD558\uB824\uACE0 \uB04A\uC784\uC5C6\uC774 \uAE30\uB2E4\uB9AC\uB294 \uC0C1\uD0DC","source":"@site/docs/javascript/js deadlock - \uAD50\uCC29\uC0C1\uD0DC.md","sourceDirName":"javascript","slug":"/javascript/js deadlock - \uAD50\uCC29\uC0C1\uD0DC","permalink":"/docs/javascript/js deadlock - \uAD50\uCC29\uC0C1\uD0DC","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"js currying","permalink":"/docs/javascript/js currying"},"next":{"title":"decorator stage 3","permalink":"/docs/javascript/js decorator stage 3"}}'),s=r(447259),o=r(255511);let c={},a="js deadlock",i={},l=[];function u(e){let n={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"js-deadlock",children:"js deadlock"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uB450\uAC1C \uC774\uC0C1\uC758 \uACF5\uC720\uC790\uC6D0\uC774 \uC788\uC744 \uB54C \uB450\uAC1C \uC774\uC0C1\uC758 task\uAC00 \uAC01 \uC790\uC6D0\uC744 \uC120\uC810\uD558\uACE0 \uC11C\uB85C\uC758 \uACF5\uC720\uC790\uC6D0\uC744 \uC0AC\uC6A9\uD558\uB824\uACE0 \uB04A\uC784\uC5C6\uC774 \uAE30\uB2E4\uB9AC\uB294 \uC0C1\uD0DC"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'function makeFuture() {\r\n  let resolve;\r\n  let reject;\r\n  let promise = new Promise((d, e) => {\r\n    resolve = d;\r\n    reject = e;\r\n  });\r\n  return [promise, resolve, reject];\r\n}\r\n\r\nclass Lock {\r\n  constructor() {\r\n    this.q = [];\r\n    this.running = false;\r\n  }\r\n  async runQueue() {\r\n    if (this.running) return;\r\n    this.running = true;\r\n    while (this.q.length > 0) {\r\n      const { asyncFunction, resolve, reject } = this.q.shift();\r\n      try {\r\n        let result = await asyncFunction();\r\n        resolve(await asyncFunction());\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    }\r\n    this.running = false;\r\n  }\r\n  runTask(asyncFunction) {\r\n    const [promise, resolve, reject] = makeFuture();\r\n    this.q.push({ asyncFunction, resolve, reject });\r\n    this.runQueue();\r\n    return promise;\r\n  }\r\n}\r\n\r\nconst dbLock = new Lock();\r\n\r\nlet taskResultPromise = dbLock.runTask(async () => {\r\n  console.log("about to deadlock");\r\n  let value = await dbLock.runTask(async () => {\r\n    return "value";\r\n  });\r\n  value; //?\r\n  console.log("did not deadlock");\r\n  return value;\r\n});\n'})})]})}function d(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},255511:function(e,n,r){r.d(n,{R:()=>c,x:()=>a});var t=r(596363);let s={},o=t.createContext(s);function c(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);