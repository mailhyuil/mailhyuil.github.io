"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["607492"],{800614:function(n,e,r){r.r(e),r.d(e,{frontMatter:()=>i,toc:()=>c,default:()=>g,metadata:()=>t,assets:()=>a,contentTitle:()=>l});var t=JSON.parse('{"id":"nestjs/nest logging winston","title":"nest logging winston","description":"log\uB97C \uB85C\uADF8 \uD30C\uC77C\uC5D0 \uC800\uC7A5\uD558\uAE30 \uC704\uD574 \uC0AC\uC6A9","source":"@site/docs/nestjs/nest logging winston.md","sourceDirName":"nestjs","slug":"/nestjs/nest logging winston","permalink":"/docs/nestjs/nest logging winston","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest logging pino","permalink":"/docs/nestjs/nest logging pino"},"next":{"title":"nest mapped type","permalink":"/docs/nestjs/nest mapped type"}}'),o=r(447259),s=r(255511);let i={},l="nest logging winston",a={},c=[{value:"install",id:"install",level:2},{value:"winston.config.ts",id:"winstonconfigts",level:2},{value:"main.ts",id:"maints",level:2},{value:"pm2 log \uB044\uAE30",id:"pm2-log-\uB044\uAE30",level:2}];function m(n){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"nest-logging-winston",children:"nest logging winston"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"log\uB97C \uB85C\uADF8 \uD30C\uC77C\uC5D0 \uC800\uC7A5\uD558\uAE30 \uC704\uD574 \uC0AC\uC6A9"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"pm2 \uB97C \uC0AC\uC6A9\uD55C\uB2E4\uBA74 logs\uB85C \uC77D\uC744 \uD30C\uC77C \uC704\uCE58 \uBCC0\uACBD\uD574\uC8FC\uAE30"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"winston\uB9CC \uC0AC\uC6A9\uD55C\uB2E4\uBA74 \uBBF8\uB4E4\uC6E8\uC5B4\uB098 \uC778\uD130\uC149\uD130\uB97C \uB9CC\uB4E4\uC5B4\uC8FC\uACE0"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"morgan\uC744 \uAC19\uC774 \uC0AC\uC6A9\uD55C\uB2E4\uBA74 morgan middleware\uC5D0\uC11C \uB098\uC624\uB294 stream\uC744 winston\uC5D0 \uB123\uC5B4\uC8FC\uAE30"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"install",children:"install"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-sh",children:"npm i winston\r\nnpm i nest-winston\r\n\r\n# \uB85C\uAE45\uD55C \uC815\uBCF4\uB4E4\uC744 \uB0A0\uC9DC \uBCC4\uB85C \uB85C\uADF8 \uD30C\uC77C\uC744 \uC0DD\uC131\uD574\uC8FC\uACE0 \uC77C\uC815 \uC2DC\uAC04\uC774 \uC9C0\uB098\uBA74 \uC0AD\uC81C \uBC0F \uC555\uCD95\uC744 \uD574\uC8FC\uB294 \uAE30\uB2A5\r\nnpm i winston-daily-rotate-file\r\n\r\nnpm i winston nest-winston winston-daily-rotate-file\n"})}),"\n",(0,o.jsx)(e.h2,{id:"winstonconfigts",children:"winston.config.ts"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:'import { utilities, WinstonModule } from "nest-winston";\r\nimport process from "process";\r\nimport winston from "winston";\r\nimport winstonDaily from "winston-daily-rotate-file";\r\nconst { combine, timestamp, printf } = winston.format;\r\n\r\nconst logDir = "logs"; // logs \uB514\uB809\uD1A0\uB9AC \uD558\uC704\uC5D0 \uB85C\uADF8 \uD30C\uC77C \uC800\uC7A5\r\n\r\nconst logFormat = printf(info => {\r\n  return `${info.timestamp} ${info.level}: ${info.message}`;\r\n});\r\n\r\nconst productionTransports = () => [\r\n  // info \uB808\uBCA8 \uB85C\uADF8\uB97C \uC800\uC7A5\uD560 \uD30C\uC77C \uC124\uC815\r\n  new winstonDaily({\r\n    level: "info",\r\n    datePattern: "YYYY-MM-DD",\r\n    dirname: logDir,\r\n    filename: `%DATE%.info.log`,\r\n    maxFiles: 30,\r\n    zippedArchive: true,\r\n  }),\r\n  // warn \uB808\uBCA8 \uB85C\uADF8\uB97C \uC800\uC7A5\uD560 \uD30C\uC77C \uC124\uC815\r\n  new winstonDaily({\r\n    level: "warn",\r\n    datePattern: "YYYY-MM-DD",\r\n    dirname: logDir,\r\n    filename: `%DATE%.warn.log`,\r\n    maxFiles: 30,\r\n    zippedArchive: true,\r\n  }),\r\n  // error \uB808\uBCA8 \uB85C\uADF8\uB97C \uC800\uC7A5\uD560 \uD30C\uC77C \uC124\uC815\r\n  new winstonDaily({\r\n    level: "error",\r\n    datePattern: "YYYY-MM-DD",\r\n    dirname: logDir,\r\n    filename: `%DATE%.error.log`,\r\n    maxFiles: 30,\r\n    zippedArchive: true,\r\n  }),\r\n];\r\n\r\nconst localTransports = () => [\r\n  new winston.transports.Console({\r\n    level: "silly", // \uBAA8\uB4E0 \uB2E8\uACC4\uB97C \uB85C\uADF8\r\n    format: winston.format.combine(\r\n      winston.format.timestamp(),\r\n      utilities.format.nestLike("APP", {\r\n        prettyPrint: true, // nest\uC5D0\uC11C \uC81C\uACF5\uD558\uB294 \uC635\uC158. \uB85C\uADF8 \uAC00\uB3C5\uC131\uC744 \uB192\uC5EC\uC90C\r\n        colors: true, // \uB85C\uADF8\uC5D0 \uC0C9\uAE54\uC744 \uB123\uC5B4\uC11C \uCD9C\uB825\r\n      }),\r\n    ),\r\n  }),\r\n];\r\n\r\n/*\r\n * Log Level\r\n * error: 0, warn: 1, info: 2, http: 3, verbose: 4, debug: 5, silly: 6\r\n */\r\nconst winstonLogger = WinstonModule.createLogger({\r\n  format: combine(\r\n    timestamp({\r\n      format: "YYYY-MM-DD HH:mm:ss",\r\n    }),\r\n    logFormat,\r\n  ),\r\n  transports: process.env["NODE_ENV"] === "production" ? productionTransports() : localTransports(),\r\n});\r\n\r\n// morgan winston \uC124\uC815\r\nconst stream = {\r\n  write: message => {\r\n    winstonLogger.log(message);\r\n  },\r\n};\r\n\r\nexport { stream, winstonLogger };\n'})}),"\n",(0,o.jsx)(e.h2,{id:"maints",children:"main.ts"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:'import { winstonLogger, stream } from "./winston.config";\r\n\r\nconst app = await NestFactory.create(AppModule, {\r\n  logger: winstonLogger,\r\n});\r\napp.use(morgan("combined", { stream }));\n'})}),"\n",(0,o.jsx)(e.h2,{id:"pm2-log-\uB044\uAE30",children:"pm2 log \uB044\uAE30"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'module.exports = {\r\n  apps: [\r\n    {\r\n      out_file: "/dev/null",\r\n      error_file: "/dev/null",\r\n    },\r\n  ],\r\n};\n'})})]})}function g(n={}){let{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(m,{...n})}):m(n)}},255511:function(n,e,r){r.d(e,{R:()=>i,x:()=>l});var t=r(596363);let o={},s=t.createContext(o);function i(n){let e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),t.createElement(s.Provider,{value:e},n.children)}}}]);