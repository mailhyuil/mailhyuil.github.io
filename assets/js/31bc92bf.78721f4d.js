"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[342771],{529087:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>a});var t=n(596363);const r={},o=t.createContext(r);function i(e){const s=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:s},e.children)}},740432:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"nestjs/nest auth session","title":"nest session","description":"session \uc778\uc99d \ubc29\uc2dd","source":"@site/docs/nestjs/nest auth session.md","sourceDirName":"nestjs","slug":"/nestjs/nest auth session","permalink":"/docs/nestjs/nest auth session","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest session sticky session","permalink":"/docs/nestjs/nest auth session sticky session"},"next":{"title":"nest DiscoveryModule ExplorerService","permalink":"/docs/nestjs/nest base DiscoveryModule ExplorerService - DiscoveryService"}}');var r=n(447259),o=n(529087);const i={},a="nest session",l={},c=[{value:"install",id:"install",level:2},{value:"main.ts",id:"maints",level:2},{value:"usage",id:"usage",level:2}];function d(e){const s={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"nest-session",children:"nest session"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"session \uc778\uc99d \ubc29\uc2dd"}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"\uc720\uc800\uc758 \uc778\uc99d state\ub97c \uc11c\ubc84\uc758 \uba54\ubaa8\ub9ac\uc5d0 \uc800\uc7a5\ud55c\ub2e4."}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"jwt\uc5d0 \ube44\ud574 state\uac00 \ud56d\uc0c1 \uc11c\ubc84\uc5d0 \uc800\uc7a5\ub418\uc5b4 \uc788\uae30 \ub54c\ubb38\uc5d0 \ubcf4\uc548\uc131\uc774 \ub192\uc74c"}),"\n",(0,r.jsx)(s.p,{children:"\uc11c\ubc84\uc5d0 \uc778\uc99d \ud398\uc774\ub85c\ub4dc\ub97c \ubcf4\ub0b4\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 jwt\uc5d0 \ube44\ud574 \ud2b8\ub798\ud53d\uc774 \uc801\uc74c"}),"\n",(0,r.jsx)(s.p,{children:"\ud558\uc9c0\ub9cc \uc774\ub85c \uc778\ud574 \uc11c\ubc84\uc758 \ubd80\ud558\uc640 \ud655\uc7a5\uc131(sticky session) \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud55c\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"install",children:"install"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sh",children:"npm i express-session\r\nnpm i -D @types/express-session\n"})}),"\n",(0,r.jsx)(s.h2,{id:"maints",children:"main.ts"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:'import * as session from "express-session";\r\n\r\n// somewhere in your initialization file\r\napp.use(\r\n  session({\r\n    secret: process.env["SESSION_SECRET"],\r\n    resave: false,\r\n    saveUninitialized: false,\r\n    cookie: {\r\n      secure: process.env["NODE_ENV"] !== "none",\r\n      httpOnly: true,\r\n      maxAge: 1000 * 60 * 60 * 24 * 7, // 1 week\r\n    },\r\n  }),\r\n);\n'})}),"\n",(0,r.jsx)(s.h2,{id:"usage",children:"usage"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"export type Session = Record<string, any>;\r\n\r\n@Post()\r\nlogin(@Session() session: Session) {\r\n  // login logic..\r\n  const user = await this.prisma.user.findUnique({\r\n    where: { username, password },\r\n  })\r\n  session.user = user;\r\n  return ;\r\n}\r\n\r\n@Get()\r\nme(@Session() session: Session) {\r\n  return session.user;\r\n}\r\n\n"})}),"\n",(0,r.jsx)(s.p,{children:"Session.regenerate(callback)\r\nTo regenerate the session simply invoke the method. Once complete, a new SID and Session instance will be initialized at req.session and the callback will be invoked."}),"\n",(0,r.jsxs)(s.p,{children:["req.session.regenerate(function(err) ",")\r\nSession.destroy(callback)\r\nDestroys the session and will unset the req.session property. Once complete, the callback will be invoked."]}),"\n",(0,r.jsxs)(s.p,{children:["req.session.destroy(function(err) ",")\r\nSession.reload(callback)\r\nReloads the session data from the store and re-populates the req.session object. Once complete, the callback will be invoked."]}),"\n",(0,r.jsxs)(s.p,{children:["req.session.reload(function(err) ",")\r\nSession.save(callback)\r\nSave the session back to the store, replacing the contents on the store with the contents in memory (though a store may do something else--consult the store's documentation for exact behavior)."]}),"\n",(0,r.jsx)(s.p,{children:"This method is automatically called at the end of the HTTP response if the session data has been altered (though this behavior can be altered with various options in the middleware constructor). Because of this, typically this method does not need to be called."}),"\n",(0,r.jsx)(s.p,{children:"There are some cases where it is useful to call this method, for example, redirects, long-lived requests or in WebSockets."}),"\n",(0,r.jsxs)(s.p,{children:["req.session.save(function(err) ",")"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);