"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["190959"],{982:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>c,toc:()=>d,default:()=>u,metadata:()=>s,assets:()=>i,contentTitle:()=>l});var s=JSON.parse('{"id":"nestjs/nest csrf","title":"nest csrf","description":"samesite=strict \uC635\uC158\uC73C\uB85C \uB9C9\uC744 \uC218 \uC788\uC9C0\uB9CC \uAD6C\uC2DD \uBE0C\uB77C\uC6B0\uC800\uC5D0\uC11C\uB294 \uB3D9\uC791\uD558\uC9C0 \uC54A\uB294\uB2E4","source":"@site/docs/nestjs/nest csrf.md","sourceDirName":"nestjs","slug":"/nestjs/nest csrf","permalink":"/docs/nestjs/nest csrf","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest cookie","permalink":"/docs/nestjs/nest cookie"},"next":{"title":"deletedAt, blockedAt","permalink":"/docs/nestjs/nest deletedAt, blockedAt"}}'),t=r(447259),o=r(255511);let c={},l="nest csrf",i={},d=[{value:"\uD1A0\uD070 \uBCF4\uB0B4\uB294 \uBC29\uC2DD",id:"\uD1A0\uD070-\uBCF4\uB0B4\uB294-\uBC29\uC2DD",level:2},{value:"csurf library",id:"csurf-library",level:2},{value:"install",id:"install",level:2},{value:"app.module.ts",id:"appmodulets",level:2},{value:"CsrfMiddleware",id:"csrfmiddleware",level:2},{value:"angular interceptor",id:"angular-interceptor",level:2}];function a(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"nest-csrf",children:"nest csrf"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"samesite=strict \uC635\uC158\uC73C\uB85C \uB9C9\uC744 \uC218 \uC788\uC9C0\uB9CC \uAD6C\uC2DD \uBE0C\uB77C\uC6B0\uC800\uC5D0\uC11C\uB294 \uB3D9\uC791\uD558\uC9C0 \uC54A\uB294\uB2E4"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\uD06C\uB85C\uC2A4 \uC0AC\uC774\uD2B8 \uB9AC\uD018\uC2A4\uD2B8 \uBCC0\uC870(cross site request forgery, CSRF)"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\uD53C\uD574\uC790\uC758 \uAD8C\uD55C\uC73C\uB85C \uD53C\uD574\uC790 \uBAA8\uB974\uAC8C \uD574\uCEE4\uAC00 \uC694\uCCAD\uC744 \uC218\uD589 \uD558\uB3C4\uB85D \uB9CC\uB4DC\uB294 \uAC83\uC744 \uC758\uBBF8"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:'\uD2B9\uD788 "\uACB0\uC7AC"\uC640 \uAD00\uB828\uB41C \uC6F9 \uC5B4\uD50C\uB9AC\uCF00\uC774\uC158\uC5D0\uC11C\uB294 \uD544\uC218\uC774\uBA70 \uAC00\uC7A5 \uAC15\uB825\uD55C \uC218\uC900\uC758 \uC870\uCE58\uAC00 \uC694\uAD6C \uB429\uB2C8\uB2E4.'}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"post, put, delete \uB4F1\uC758 \uC694\uCCAD\uC744 \uBCF4\uB0BC \uB54C\uB294 csrf \uD1A0\uD070\uC744 \uD568\uAED8 \uBCF4\uB0B4\uC57C \uD569\uB2C8\uB2E4."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\uD1A0\uD070-\uBCF4\uB0B4\uB294-\uBC29\uC2DD",children:"\uD1A0\uD070 \uBCF4\uB0B4\uB294 \uBC29\uC2DD"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Important: Request must be sent with withCredentials set to true to allow cookies to be sent from the frontend or credentials set to include in fetch API."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:'"\uC11C\uBC84"\uC640 "\uD074\uB77C\uC774\uC5B8\uD2B8" \uB458\uB2E4 credential\uC744 true\uB85C \uD5C8\uC6A9\uD574\uC918\uC57C \uD504\uB860\uD2B8 \uC5D4\uB4DC\uC5D0\uC11C \uCFE0\uD0A4\uC5D0 \uC778\uC99D \uD1A0\uD070\uC744 \uB2F4\uC544 \uBCF4\uB0BC \uC218 \uC788\uB2E4.\r\nCORS origin\uC744 \uC815\uD655\uD788 \uC124\uC815\uD574\uC8FC\uC5B4\uC57C \uD55C\uB2E4.'}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"# headers\r\ncsrf-token\r\nxsrf-token\r\nx-csrf-token\r\nx-xsrf-token\r\n\r\n# query\r\n?_csrf=token;\r\n\r\n# body\r\n{\r\n  _csrf: token;\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"csurf-library",children:"csurf library"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\uCFE0\uD0A4\uC5D0 _csrf \uC2DC\uD06C\uB9BF\uC744 \uB2F4\uC544\uC11C \uD074\uB77C\uC774\uC5B8\uD2B8\uB85C \uBCF4\uB0C4"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"req.csrfToken()\uB85C \uADF8 \uC2DC\uD06C\uB9BF\uC5D0 \uB300\uD55C \uD1A0\uD070\uC744 \uC0DD\uC131\uD560 \uC218 \uC788\uAC8C \uD574\uC90C"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\uD1A0\uD070\uC744 \uD074\uB77C\uC774\uC5B8\uD2B8\uC5D0 \uBCF4\uB0B4\uACE0 POST \uC694\uCCAD\uD560 \uC2DC \uB2E4\uC2DC X-XSRF-TOKEN \uD5E4\uB354\uC5D0 \uB2F4\uC544\uC11C \uBCF4\uB0B4\uAE30"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"install",children:"install"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"# server\r\nnpm i cookie-parser\r\nnpm i csurf\r\n\r\n# client\r\nnpm i ngx-cookie\n"})}),"\n",(0,t.jsx)(n.h2,{id:"appmodulets",children:"app.module.ts"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'export class AppModule implements NestModule {\r\n  configure(consumer: MiddlewareConsumer) {\r\n    consumer.apply(csurf({ cookie: true }), CsrfMiddleware).forRoutes("*");\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"csrfmiddleware",children:"CsrfMiddleware"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { Injectable, NestMiddleware } from "@nestjs/common";\r\nimport { Request, Response } from "express";\r\n\r\n@Injectable()\r\nexport class CsrfMiddleware implements NestMiddleware {\r\n  use(req: Request, res: Response, next: Function) {\r\n    res.cookie("XSRF-TOKEN", req["csrfToken"]());\r\n    next();\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"angular-interceptor",children:"angular interceptor"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { HttpHandlerFn, HttpRequest } from "@angular/common/http";\r\nimport { inject } from "@angular/core";\r\nimport { CookieService } from "ngx-cookie";\r\n\r\nexport function CsrfInterceptorFn(req: HttpRequest<unknown>, next: HttpHandlerFn) {\r\n  const cookieService = inject(CookieService);\r\n  const csrfToken = cookieService.get("XSRF-TOKEN");\r\n  if (!csrfToken) return next(req).pipe();\r\n\r\n  const clonedRequest = req.clone({\r\n    setHeaders: {\r\n      "X-XSRF-TOKEN": csrfToken!,\r\n    },\r\n    withCredentials: true,\r\n  });\r\n  return next(clonedRequest).pipe();\r\n}\n'})})]})}function u(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},255511:function(e,n,r){r.d(n,{R:()=>c,x:()=>l});var s=r(596363);let t={},o=s.createContext(t);function c(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);