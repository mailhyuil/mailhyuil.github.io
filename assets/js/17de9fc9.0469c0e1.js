"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[811615],{118857:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>c,metadata:()=>l,toc:()=>p});const l=JSON.parse('{"id":"linux/linux shellscript deploy with rollback","title":"shellscript deploy with rollback","description":"","source":"@site/docs/linux/linux shellscript deploy with rollback.md","sourceDirName":"linux","slug":"/linux/linux shellscript deploy with rollback","permalink":"/docs/linux/linux shellscript deploy with rollback","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"linux shellscript $() & ${}","permalink":"/docs/linux/linux shellscript ${} vs $"},"next":{"title":"linux shell script exit","permalink":"/docs/linux/linux shellscript exit & return"}}');var t=n(447259),s=n(529087);const c={},o="shellscript deploy with rollback",i={},p=[];function a(e){const r={code:"code",h1:"h1",header:"header",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"shellscript-deploy-with-rollback",children:"shellscript deploy with rollback"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh",children:'#!/bin/bash\r\n\r\nBACKUP_DIR=/app/backup\r\nSERVER_DIR=/app/server\r\n\r\nrollback() {\r\n  echo "Deploy failed, Start rollback..."\r\n\r\n  # \ub864\ubc31 \uc791\uc5c5 \uc218\ud589\r\n  rm -rf $SERVER_DIR\r\n  cp -r $BACKUP_DIR $SERVER_DIR\r\n\r\n  echo "Rollback completed."\r\n  exit 1\r\n}\r\n\r\ntrap rollback EXIT\r\n\r\n# backup\r\ncp -r $SERVER_DIR $BACKUP_DIR\r\n\r\n# build\r\nnx build server\r\necho "Build completed."\r\n\r\n# file copy\r\nrm -rf $SERVER_DIR\r\ncp -r dist/apps/server $SERVER_DIR\r\ncp -r prisma $SERVER_DIR/prisma\r\ncp apps/server/.env.production $SERVER_DIR/.env\r\ncp ecosystem.config.js $SERVER_DIR/ecosystem.config.js\r\ncd $SERVER_DIR\r\necho "File copy completed."\r\n\r\n# deploy\r\nnpm install\r\nnpx prisma migrate deploy\r\npm2 reload ecosystem.config.js --update-env\r\n\r\n# \uc131\uacf5 \uc2dc\uc5d0\ub294 \ub864\ubc31 \ud568\uc218 \ub4f1\ub85d \ud574\uc81c\r\ntrap - EXIT\r\necho "Deployment completed successfully."\r\nexit 0\n'})})]})}function d(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},529087:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>o});var l=n(596363);const t={},s=l.createContext(t);function c(e){const r=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),l.createElement(s.Provider,{value:r},e.children)}}}]);