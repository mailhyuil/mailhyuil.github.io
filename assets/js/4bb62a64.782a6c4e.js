"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["988433"],{494313:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>a,toc:()=>d,default:()=>p,metadata:()=>i,assets:()=>s,contentTitle:()=>o});var i=JSON.parse('{"id":"spring/spring File upload - \uC11C\uBC84\uC5D0 \uD30C\uC77C \uC5C5\uB85C\uB4DC","title":"File upload (\uC11C\uBC84\uC5D0 \uD30C\uC77C \uC5C5\uB85C\uB4DC)","description":"1. pom.xml","source":"@site/docs/spring/spring File upload - \uC11C\uBC84\uC5D0 \uD30C\uC77C \uC5C5\uB85C\uB4DC.md","sourceDirName":"spring","slug":"/spring/spring File upload - \uC11C\uBC84\uC5D0 \uD30C\uC77C \uC5C5\uB85C\uB4DC","permalink":"/docs/spring/spring File upload - \uC11C\uBC84\uC5D0 \uD30C\uC77C \uC5C5\uB85C\uB4DC","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Exception (\uC608\uC678 \uCC98\uB9AC)","permalink":"/docs/spring/spring Exception - \uC608\uC678 \uCC98\uB9AC"},"next":{"title":"Gradle (\uADF8\uB808\uB4E4)","permalink":"/docs/spring/spring Gradle - \uADF8\uB808\uB4E4"}}'),t=r(447259),l=r(255511);let a={},o="File upload (\uC11C\uBC84\uC5D0 \uD30C\uC77C \uC5C5\uB85C\uB4DC)",s={},d=[{value:"\uD574\uD0B9\uBC29\uC9C0",id:"\uD574\uD0B9\uBC29\uC9C0",level:3},{value:"MultipartHttpServletRequest \uC5EC\uB7EC\uAC1C\uC758 \uD30C\uC77C\uC744 \uB3D9\uC2DC\uC5D0 \uC5C5\uB85C\uB4DC \uD560\uB54C",id:"multiparthttpservletrequest-\uC5EC\uB7EC\uAC1C\uC758-\uD30C\uC77C\uC744-\uB3D9\uC2DC\uC5D0-\uC5C5\uB85C\uB4DC-\uD560\uB54C",level:3},{value:"\uD30C\uC77C \uC9C0\uC6B0\uAE30 (file delete)",id:"\uD30C\uC77C-\uC9C0\uC6B0\uAE30-file-delete",level:3},{value:"\uBE44\uB514\uC624 \uC601\uC0C1 \uC5C5\uB85C\uB4DC(video upload)",id:"\uBE44\uB514\uC624-\uC601\uC0C1-\uC5C5\uB85C\uB4DCvideo-upload",level:3}];function c(e){let n={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"file-upload-\uC11C\uBC84\uC5D0-\uD30C\uC77C-\uC5C5\uB85C\uB4DC",children:"File upload (\uC11C\uBC84\uC5D0 \uD30C\uC77C \uC5C5\uB85C\uB4DC)"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"pom.xml"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"\x3c!-- commons-io --\x3e\r\n<dependency>\r\n	<groupId>commons-io</groupId>\r\n	<artifactId>commons-io</artifactId>\r\n	<version>2.11.0</version>\r\n</dependency>\r\n\r\n\x3c!-- commons-fileupload --\x3e\r\n<dependency>\r\n	<groupId>commons-fileupload</groupId>\r\n	<artifactId>commons-fileupload</artifactId>\r\n	<version>1.4</version>\r\n</dependency>\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"root-context"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">\r\n	<property name="maxUploadSizePerFile" value="2000000"/>\r\n	<property name="maxUploadSize" value="20000000"/>\r\n</bean>\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"application.yml"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yml",children:"spring:\r\n  servlet:\r\n    multipart:\r\n      file-size-threshold: 1MB\r\n      location: C:/Temp/upload\r\n      max-file-size: 100MB\r\n      max-request-size: 100MB\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"jsp"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsp",children:'<form method="POST" class="bbs_write" enctype="multipart/form-data">\r\n	<h2>\uAC8C\uC2DC\uD310 \uAE00\uC4F0\uAE30</h2>\r\n	<input name="b_date" type="date" value="${BBS.b_date}"\r\n						hidden="hidden">\r\n	<input name="b_time" type="time" value="${BBS.b_time}"\r\n						hidden="hidden">\r\n\r\n	<input name="b_writer" placeholder="\uC791\uC131\uC790"\r\n				value="${BBS.b_writer}" readonly="readonly">\r\n\r\n	<input name="b_subject" placeholder="\uC81C\uBAA9">\r\n\r\n	<textarea rows="5" cols="20" name="b_content" placeholder="\uB0B4\uC6A9"></textarea>\r\n\r\n	<input type="file" name="up_file" accept="image/*">\r\n\r\n	<button>\uC800\uC7A5</button>\r\n</form>\r\n<%/*\r\nfile input box \uC5D0 \uC120\uD0DD\uD558\uB294 \uD30C\uC77C \uC81C\uD55C\uD558\uAE30\r\naccept=".hwp" : \uD655\uC7A5\uC790\uAC00 hwp \uC778 \uD30C\uC77C\uB9CC \uC120\uD0DD\uD560 \uC218 \uC788\uAED8\r\naccept=".jpg", accept=".png", accept=".gif" : \uC774\uBBF8\uC9C0 \uD30C\uC77C\uB4E4\uC911\uC5D0\uC11C\r\n		jpg, png, gif \uD655\uC7A5\uC790\uB97C \uAC16\uB294 \uD30C\uC77C\uB9CC\r\n\r\naccept="image/*" : \uBAA8\uB4E0 \uC774\uBBF8\uC9C0 \uD30C\uC77C\r\naccept="video/*" : \uBAA8\uB4E0 \uB3D9\uC601\uC0C1 \uD30C\uC77C\r\naccept="audio/*" : \uBAA8\uB4E0 \uC74C\uC131(\uC74C\uC545) \uD30C\uC77C\r\naccept="image/*, video/*, audio/*" : \uC774\uBBF8\uC9C0, \uB3D9\uC601\uC0C1, \uC74C\uC131 \uD30C\uC77C\r\n*/%>\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"\uD30C\uC77C \uC5C5\uB85C\uB4DC"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'// Spring \uC5D0\uC11C Server \uC758 \uD2B9\uC815\uD55C \uD3F4\uB354\uC5D0 \uC811\uADFC\uD558\uAE30 \uC704\uD55C \uC911\uAC04 \uB3C4\uAD6C\r\nprivate final ServletContext context;\r\nprivate final ResourceLoader resLoader;\r\n\r\npublic FileServiceImplV1(ServletContext context, ResourceLoader resLoader) {\r\n	this.context = context;\r\n	this.resLoader = resLoader;\r\n}\r\n// \uB9AC\uC18C\uC2A4 \uC815\uBCF4 \uC218\uC9D1\r\nString upLoadPath = resLoader.getResource("").getURI().getPath();\r\n\r\n // \uB514\uB809\uD1A0\uB9AC\uAC00 \uC5C6\uC744\uC2DC \uC0DD\uC131\r\nFile dir = new File(upLoadPath);\r\nif(!dir.exists()){\r\n	dir.mkdirs();\r\n}\r\n// \uD30C\uC77C \uC5C5\uB85C\uB4DC \uC815\uBCF4 \uC0DD\uC131\r\nFile upLoadFile = new File(upLoadPath, fileName);\r\n// \uD30C\uC77C \uC5C5\uB85C\uB4DC\r\nfile.transferTo(upLoadFile);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\uD574\uD0B9\uBC29\uC9C0",children:"\uD574\uD0B9\uBC29\uC9C0"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'String strUUID = UUID.randomUUID().toString();\r\n\r\nfileName = String.format("%s-%s",strUUID, fileName);\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'MultipartFile // enctype="multipart/form-data"\uB85C \uC804\uC1A1\uC2DC'}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@RequestMapping(value="/write",method=RequestMethod.POST)\r\npublic String write(@ModelAttribute("bbsVO") BBsVO bbsVO, @RequestParam("up_file") MultipartFile file, Model model) {\r\n\r\n	String imageFile = bbsService.insertBbsAndFile(bbsVO, file);\r\n	model.addAttribute("IMAGE",imageFile);\r\n\r\n	return "redirect:/";\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"multiparthttpservletrequest-\uC5EC\uB7EC\uAC1C\uC758-\uD30C\uC77C\uC744-\uB3D9\uC2DC\uC5D0-\uC5C5\uB85C\uB4DC-\uD560\uB54C",children:"MultipartHttpServletRequest \uC5EC\uB7EC\uAC1C\uC758 \uD30C\uC77C\uC744 \uB3D9\uC2DC\uC5D0 \uC5C5\uB85C\uB4DC \uD560\uB54C"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsp",children:'<form:form modelAttribute="bbsVO" enctype="multipart/form-data">\r\n	<form:input path="b_subject" />\r\n	<form:textarea path="b_content"/>\r\n	<input type="file" name="mFile" multiple="multiple" accept="images/*"/>\r\n	<button>\uC791\uC131\uC644\uB8CC</button>\r\n</form:form>\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@RequestMapping(value="/fileups",method=RequestMethod.POST)\r\npublic String upFiles(@ModelAttribute("bbsVO") BBsVO bbsVO,	MultipartHttpServletRequest mFiles,	Model model) {\r\n\r\n	bbsService.insertBbsAndFiles(bbsVO, mFiles);\r\n\r\n	return null;\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\uD30C\uC77C-\uC9C0\uC6B0\uAE30-file-delete",children:"\uD30C\uC77C \uC9C0\uC6B0\uAE30 (file delete)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public void fileDelete(String fileName) {\r\n\r\n	if(fileName == null) {\r\n		return;\r\n	}\r\n\r\n	// \uC5C5\uB85C\uB4DC \uD3F4\uB354\uC640 \uD30C\uC77C\uC774\uB984\uBB36\uC5B4 \uD30C\uC77C \uAC1D\uCCB4 \uC0DD\uC131\r\n	File file = new File(\uD30C\uC77C\uC758 \uACBD\uB85C, fileName);\r\n\r\n	// \uC2E4\uC81C \uD30C\uC77C\uC774 \uC874\uC7AC\uD558\uB294 \uD655\uC778\uD558\uACE0\r\n	if(file.exists()) {\r\n		// \uC874\uC7AC\uD558\uBA74 \uD30C\uC77C\uC744 \uC0AD\uC81C\r\n		file.delete();\r\n	}\r\n\r\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\uBE44\uB514\uC624-\uC601\uC0C1-\uC5C5\uB85C\uB4DCvideo-upload",children:"\uBE44\uB514\uC624 \uC601\uC0C1 \uC5C5\uB85C\uB4DC(video upload)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"domain"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"@Data\r\n@NoArgsConstructor\r\n@Entity\r\npublic class Video{\r\n    @Id\r\n    @GeneratedValue(strategy = GenerationType.AUTO)\r\n    private Long id;\r\n\r\n    @Column(unique = true)\r\n    private String name; // \uBE44\uB514\uC624 \uC774\uB984\r\n\r\n    @Lob\r\n    private byte[] data; // \uBE44\uB514\uC624 \uBC14\uC774\uD2B8 \uBC30\uC5F4\uD615 \uB370\uC774\uD130\r\n\r\n    public Video(String name, byte[] data) {\r\n        this.name = name;\r\n        this.data = data;\r\n    }\r\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"repository"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'public interface VideoRepository extends JpaRepository<Video, Long> {\r\n    Video findByName(String name); // \uC774\uB984\uC744 \uCC3E\uAE30\r\n\r\n    boolean existsByName(String name); // \uC774\uB984\uC73C\uB85C \uC874\uC7AC\uD558\uB294\uC9C0 \uAC80\uC0C9\r\n\r\n    @Query(nativeQuery = true, value="SELECT name FROM video") // \uBAA8\uB4E0 \uBE44\uB514\uC624 \uC774\uB984 \uAC80\uC0C9\r\n    List<String> getAllEntryNames();\r\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"service"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public interface VideoService {\r\n    Video getVideo(String name); // \uBE44\uB514\uC624 \uC5BB\uAE30\r\n\r\n    void saveVideo(MultipartFile file, String name) throws IOException; // \uBE44\uB514\uC624 \uC800\uC7A5\r\n\r\n    List<String> getAllVideoNames(); // \uBAA8\uB4E0 \uBE44\uB514\uC624 \uC774\uB984 \uC5BB\uAE30\r\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"serviceImpl"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"@Service\r\n@AllArgsConstructor\r\npublic class VideoServiceImpl implements VideoService {\r\n    private VideoRepository repo;\r\n\r\n    @Override\r\n    public Video getVideo(String name) {\r\n        if(!repo.existsByName(name)){ // \uBE44\uB514\uC624\uAC00 \uC874\uC7AC\uD558\uC9C0 \uC54A\uC73C\uBA74\r\n            throw new VideoNotFoundException(); // \uBE44\uB514\uC624\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4 \uC608\uC678\r\n        }\r\n        return repo.findByName(name); // \uC774\uB984\uC73C\uB85C \uBE44\uB514\uC624 \uC5BB\uAE30\r\n    }\r\n\r\n    @Override\r\n    public List<String> getAllVideoNames() {\r\n        return repo.getAllEntryNames(); // \uBAA8\uB4E0 \uBE44\uB514\uC624 \uC774\uB984 \uC5BB\uAE30\r\n    }\r\n\r\n    @Override\r\n    public void saveVideo(MultipartFile file, String name) throws IOException {\r\n        if(repo.existsByName(name)){ // \uBE44\uB514\uC624\uAC00 \uC874\uC7AC\uD558\uBA74\r\n            throw new VideoAlreadyExistsException(); // \uBE44\uB514\uC624\uAC00 \uC874\uC7AC\uD569\uB2C8\uB2E4 \uC608\uC678\r\n        }\r\n        Video newVid = new Video(name, file.getBytes()); // *\uBE44\uB514\uC624 \uAC1D\uCCB4 \uC0DD\uC131\r\n        repo.save(newVid); // \uBE44\uB514\uC624 \uC800\uC7A5\r\n    }\r\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"RestController"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@RestController\r\n@RequestMapping("video")\r\n@AllArgsConstructor\r\npublic class VideoController {\r\n    private VideoService videoService;\r\n\r\n    @PostMapping()\r\n    public ResponseEntity<String> saveVideo(@RequestParam("file") MultipartFile file, @RequestParam("name") String name) throws IOException {\r\n        videoService.saveVideo(file, name);\r\n        return ResponseEntity.ok("Video saved successfully.");\r\n    }\r\n\r\n    @GetMapping("{name}")\r\n    public ResponseEntity<Resource> getVideoByName(@PathVariable("name") String name){\r\n        return ResponseEntity\r\n                .ok(new ByteArrayResource(videoService.getVideo(name).getData()));\r\n    }\r\n\r\n    @GetMapping("all")\r\n    public ResponseEntity<List<String>> getAllVideoNames(){\r\n        return ResponseEntity\r\n                .ok(videoService.getAllVideoNames());\r\n    }\r\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"controller"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@GetMapping("/video")\r\npublic String video(){\r\n	return null;\r\n}\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"video.html (view)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<main>\r\n  \x3c!-- video list --\x3e\r\n  <div id="video-list">\r\n    <header>\r\n      <h3>Your videos</h3>\r\n    </header>\r\n    <ul id="your-videos"></ul>\r\n  </div>\r\n  \x3c!-- video player --\x3e\r\n  <div id="video-player">\r\n    <header>\r\n      <h3 id="now-playing"></h3>\r\n    </header>\r\n    <video\r\n      id="video-screen"\r\n      width="720px"\r\n      height="480px"\r\n      controls></video>\r\n  </div>\r\n  \x3c!-- video input --\x3e\r\n  <form id="video-form">\r\n    <fieldset>\r\n      <legend>Upload a video</legend>\r\n      <label for="file">Video File</label>\r\n      <input\r\n        id="file"\r\n        name="file"\r\n        type="file"\r\n        accept="application/mp4" />\r\n      <label for="name">Video Name</label>\r\n      <input\r\n        id="name"\r\n        name="name"\r\n        type="text" />\r\n      <button type="submit">Save</button>\r\n    </fieldset>\r\n  </form>\r\n</main>\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"js"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const form = document.querySelector("#video-form");\r\nconst videoDiv = document.querySelector("#video-player");\r\nconst videoScreen = document.querySelector("#video-screen");\r\n\r\nconst queryParams = Object.fromEntries(\r\n  new URLSearchParams(window.location.search)\r\n);\r\n/* get videoList */\r\nfetch("http://localhost:8080/video/all")\r\n  .then((result) => result.json())\r\n  .then((result) => {\r\n    const myVids = document.querySelector("#your-videos");\r\n    if (result.length > 0) {\r\n      for (let vid of result) {\r\n        const li = document.createElement("LI");\r\n        const link = document.createElement("A");\r\n        link.innerText = vid;\r\n        link.href =\r\n          window.location.origin + window.location.pathname + "?video=" + vid;\r\n        li.appendChild(link);\r\n        myVids.appendChild(li);\r\n      }\r\n    } else {\r\n      myVids.innerHTML = "No videos found";\r\n    }\r\n  });\r\n/* get videoData */\r\nif (queryParams.video) {\r\n  videoScreen.src = `http://localhost:8080/video/${queryParams.video}`;\r\n  videoDiv.style.display = "block";\r\n  document.querySelector("#now-playing").innerText =\r\n    "Now playing " + queryParams.video;\r\n}\r\n/* save video */\r\nform.addEventListener("submit", (ev) => {\r\n  ev.preventDefault();\r\n  let data = new FormData(form);\r\n  fetch("http://localhost:8080/video", {\r\n    method: "POST",\r\n    body: data,\r\n  })\r\n    .then((result) => result.text())\r\n    .then((_) => {\r\n      window.location.reload();\r\n    });\r\n});\n'})})]})}function p(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},255511:function(e,n,r){r.d(n,{R:()=>a,x:()=>o});var i=r(596363);let t={},l=i.createContext(t);function a(e){let n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);