"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[186733],{529087:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>a});var r=t(596363);const s={},o=r.createContext(s);function c(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(o.Provider,{value:n},e.children)}},631706:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"how to implement/\uba71\ub4f1\ud0a4","title":"\uba71\ub4f1\ud0a4","description":"client\uc5d0\uc11c POST \uc694\uccad \uc2dc Header\uc5d0 Idempotency-Key\ub97c \ub123\uc5b4\uc11c \ubcf4\ub0b4\uae30","source":"@site/docs/how to implement/\uba71\ub4f1\ud0a4.md","sourceDirName":"how to implement","slug":"/how to implement/\uba71\ub4f1\ud0a4","permalink":"/docs/how to implement/\uba71\ub4f1\ud0a4","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\ub7ad\ud0b9\uc11c\ubc84","permalink":"/docs/how to implement/\ub7ad\ud0b9\uc11c\ubc84"},"next":{"title":"\ubb38\uc790 \uc778\uc99d","permalink":"/docs/how to implement/\ubb38\uc790 \uc778\uc99d - SMS \uc778\uc99d"}}');var s=t(447259),o=t(529087);const c={},a="\uba71\ub4f1\ud0a4",i={},l=[{value:"Idempotency Database",id:"idempotency-database",level:2},{value:"angular",id:"angular",level:2},{value:"nestjs",id:"nestjs",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\uba71\ub4f1\ud0a4",children:"\uba71\ub4f1\ud0a4"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"client\uc5d0\uc11c POST \uc694\uccad \uc2dc Header\uc5d0 Idempotency-Key\ub97c \ub123\uc5b4\uc11c \ubcf4\ub0b4\uae30"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uc11c\ubc84\uc5d0\uc11c\ub294 \uba71\ub4f1\ud0a4\ub97c db\uc5d0 \uba71\ub4f1\ud0a4:\uc751\ub2f5 \ud615\uc2dd\uc73c\ub85c \uc800\uc7a5 (Idempotency-Key : Response)"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uc774\uc804 \uc694\uccad\uacfc \ub3d9\uc77c\ud55c \uba71\ub4f1\ud0a4\ub97c \uac00\uc9c4 \uc694\uccad\uc744 \ubc1b\uc73c\uba74 \uc11c\ubc84\uc5d0\uc11c \uc774 \uc694\uccad\uc744 \uc911\ubcf5\uc73c\ub85c \ud310\ub2e8\ud55c \ub4a4 \uc2e4\uc81c\ub85c \ucc98\ub9ac\ud558\uc9c0 \uc54a\uace0 \uccab \uc694\uccad\uacfc \uac19\uc740 \uc751\ub2f5\uc744 \ubc18\ud658\ud558\ub294 \ubc29\uc2dd"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"# HTTP HEADER\r\nIdempotency-Key: {IDEMPOTENCY_KEY}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"idempotency-database",children:"Idempotency Database"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\uba71\ub4f1\ud0a4\ub97c \uc800\uc7a5\ud558\ub294 db"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\uba71\ub4f1\ud0a4\uc640 \uc751\ub2f5\uc744 key",":value","\ub85c \uc800\uc7a5"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prisma",children:"model Idempotency {\r\n  key String @id\r\n  response        String\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"angular",children:"angular"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'@Component({\r\n  selector: "app-some",\r\n  templateUrl: "./some.component.html",\r\n  styleUrls: ["./some.component.scss"],\r\n})\r\nexport class SomeComponent {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  post() {\r\n    const body = this.formGroup.value;\r\n    // \uba71\ub4f1\ud0a4 \uc0dd\uc131\r\n    const idempotencyKey = uuidv4();\r\n    // \uba71\ub4f1\ud0a4 header\uc5d0 \ucd94\uac00\r\n    const headers = new HttpHeaders().set("Idempotency-Key", idempotencyKey);\r\n\r\n    this.http.post("some-url", body, { headers }).subscribe((res) => {\r\n      console.log(res);\r\n    });\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"nestjs",children:"nestjs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"@Injectable()\r\nexport class SomeService {\r\n  constructor(private readonly prisma: PrismaService) {}\r\n\r\n  async post(body: any, idempotencyKey: string) {\r\n    const isExist = await this.prisma.idempotency.findUnique({\r\n      where: {\r\n        key: idempotencyKey,\r\n      },\r\n    });\r\n    if (isExist) {\r\n      const exist = JSON.parse(isExist.response);\r\n      return plainToClass(SomeDto, exist);\r\n    }\r\n\r\n    const created = await this.prisma.$transaction(async (tx) => {\r\n      const created = await tx.some.create({\r\n        data: body,\r\n      });\r\n      // \uba71\ub4f1\ud0a4 \uc800\uc7a5\r\n      await tx.idempotency.create({\r\n        data: {\r\n          key: idempotencyKey,\r\n          response: JSON.stringify(created),\r\n        },\r\n      });\r\n    });\r\n    return plainToClass(SomeDto, created);\r\n  }\r\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);