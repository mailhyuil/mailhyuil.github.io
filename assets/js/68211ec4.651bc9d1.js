"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["773990"],{984517:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>s,toc:()=>l,default:()=>m,metadata:()=>t,assets:()=>c,contentTitle:()=>a});var t=JSON.parse('{"id":"db-prisma/prisma lock \uB099\uAD00\uC801 \uB77D","title":"prisma optimistic lock (\uB099\uAD00\uC801 \uB77D)","description":"\uC560\uD50C\uB9AC\uCF00\uC774\uC158 \uB808\uBCA8\uC5D0\uC11C \uAD6C\uD604","source":"@site/docs/db-prisma/prisma lock \uB099\uAD00\uC801 \uB77D.md","sourceDirName":"db-prisma","slug":"/db-prisma/prisma lock \uB099\uAD00\uC801 \uB77D","permalink":"/docs/db-prisma/prisma lock \uB099\uAD00\uC801 \uB77D","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"prisma optimistic lock (\uB099\uAD00\uC801 \uB77D) testing","permalink":"/docs/db-prisma/prisma lock \uB099\uAD00\uC801 \uB77D testing"},"next":{"title":"prisma lock exclusive lock","permalink":"/docs/db-prisma/prisma lock \uBE44\uAD00\uC801 \uB77D row lock exclusive lock"}}'),i=r(447259),o=r(255511);let s={},a="prisma optimistic lock (\uB099\uAD00\uC801 \uB77D)",c={},l=[];function d(e){let n={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"prisma-optimistic-lock-\uB099\uAD00\uC801-\uB77D",children:"prisma optimistic lock (\uB099\uAD00\uC801 \uB77D)"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\uC560\uD50C\uB9AC\uCF00\uC774\uC158 \uB808\uBCA8\uC5D0\uC11C \uAD6C\uD604"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"FOR SHARE \uC218\uC900\uC758 lock\uC5D0 \uAC00\uAE5D\uB2E4."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'const userEmail = "alice@prisma.io";\r\nconst movieName = "Hidden Figures";\r\n\r\nconst found = await client.seat.findFirst({\r\n  where: {\r\n    Movie: {\r\n      name: movieName,\r\n    },\r\n    claimedBy: null,\r\n  },\r\n});\r\n\r\nif (!found) {\r\n  throw new Error(`Oh no! ${movieName} is all booked.`);\r\n}\r\n\r\nconst seats = await client.seat.updateMany({\r\n  data: {\r\n    claimedBy: userEmail,\r\n    version: {\r\n      // \uBC84\uC804 \uC62C\uB9AC\uAE30\r\n      increment: 1,\r\n    },\r\n  },\r\n  where: {\r\n    id: found.id,\r\n    version: found.version, // \uBC84\uC804 \uBE44\uAD50\r\n  },\r\n});\r\n\r\nif (seats.count === 0) {\r\n  throw new Error(`That seat is already booked! Please try again.`);\r\n}\n'})})]})}function m(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},255511:function(e,n,r){r.d(n,{R:()=>s,x:()=>a});var t=r(596363);let i={},o=t.createContext(i);function s(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);