"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[603936],{448730:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"angular/angular base ErrorHandler HttpErrorHandler","title":"angular ErrorHandler HttpErrorHandler","description":"httpClient\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 \uc5d0\ub7ec\ub97c \uc7a1\uc544\uc11c \ucc98\ub9ac\ud558\ub294 \ud578\ub4e4\ub7ec","source":"@site/docs/angular/angular base ErrorHandler HttpErrorHandler.md","sourceDirName":"angular","slug":"/angular/angular base ErrorHandler HttpErrorHandler","permalink":"/docs/angular/angular base ErrorHandler HttpErrorHandler","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"angular ErrorHandler GlobalErrorHandler","permalink":"/docs/angular/angular base ErrorHandler GlobalErrorHandler"},"next":{"title":"angular Renderer2","permalink":"/docs/angular/angular base Renderer2"}}');var o=n(447259),s=n(529087);const a={},i="angular ErrorHandler HttpErrorHandler",l={},c=[{value:"http-error.interceptor.ts",id:"http-errorinterceptorts",level:2},{value:"http-error.handler.ts",id:"http-errorhandlerts",level:2},{value:"error-message.ts",id:"error-messagets",level:2}];function p(r){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"angular-errorhandler-httperrorhandler",children:"angular ErrorHandler HttpErrorHandler"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"httpClient\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 \uc5d0\ub7ec\ub97c \uc7a1\uc544\uc11c \ucc98\ub9ac\ud558\ub294 \ud578\ub4e4\ub7ec"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"http-errorinterceptorts",children:"http-error.interceptor.ts"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"HttpErrorResponse\ub294 \uc575\uade4\ub7ec\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \uc5d0\ub7ec \uac1d\uccb4\uc774\ub2e4. (Error\ub97c \uc0c1\uc18d\ud558\uc9c0 \uc54a\ub294\ub2e4.)"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"return next(apiReq).pipe(\r\n  catchError(error => {\r\n    if (error instanceof HttpErrorResponse) {\r\n      httpErrorHandler.handleError(error);\r\n    }\r\n    throw error;\r\n  }),\r\n);\n"})}),"\n",(0,o.jsx)(e.h2,{id:"http-errorhandlerts",children:"http-error.handler.ts"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:'import { ErrorMessage, ToastService } from "@/common";\r\nimport { HttpErrorResponse } from "@angular/common/http";\r\nimport { ErrorHandler, Injectable, inject } from "@angular/core";\r\nimport { Router } from "@angular/router";\r\nimport { CookieService } from "ngx-cookie-service";\r\nimport { switchMap } from "rxjs";\r\nimport { AuthApiService } from "../services/auth-api.service";\r\nimport { UserApiService } from "../services/user-api.service";\r\nimport { AuthStore } from "../stores/auth.store";\r\nimport { UserFriendlyError } from "./user-friendly.error";\r\n\r\nfunction isJsonString(str: string) {\r\n  try {\r\n    JSON.parse(str);\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: "root",\r\n})\r\nexport class HttpErrorHandler implements ErrorHandler {\r\n  authStore = inject(AuthStore);\r\n  toastService = inject(ToastService);\r\n  router = inject(Router);\r\n  cookieService = inject(CookieService);\r\n  authApi = inject(AuthApiService);\r\n  userApi = inject(UserApiService);\r\n\r\n  handleError(httpError: HttpErrorResponse) {\r\n    const status: number = httpError.status;\r\n    const error: any = httpError.error;\r\n    const response = isJsonString(error) ? JSON.parse(error) : error;\r\n\r\n    if (status === 0) {\r\n      this.toastService.openDanger("\uc11c\ubc84\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");\r\n      return;\r\n    }\r\n\r\n    if (status === 401) {\r\n      this.handleUnauthorized();\r\n      return;\r\n    }\r\n\r\n    if (status === 498) {\r\n      this.handleInvalidToken();\r\n      return;\r\n    }\r\n\r\n    throw new UserFriendlyError(\r\n      ErrorMessage[response.error.code] ||\r\n        response.error.message ||\r\n        response.message ||\r\n        "\uc54c \uc218 \uc5c6\ub294 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.",\r\n    );\r\n  }\r\n\r\n  private async handleInvalidToken() {\r\n    this.authStore.clearAuth();\r\n    this.authApi\r\n      .getAccessTokenByRefreshToken()\r\n      .pipe(switchMap(() => this.userApi.me()))\r\n      .subscribe(user => {\r\n        if (user) {\r\n          this.authStore.setAuth(user);\r\n        }\r\n      });\r\n  }\r\n\r\n  private async handleUnauthorized(): Promise<void> {\r\n    this.authStore.clearAuth();\r\n    this.toastService.openDanger("\uc0ac\uc6a9 \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \ub85c\uadf8\uc778\ud574\uc8fc\uc138\uc694.");\r\n    this.router.navigateByUrl("/login");\r\n  }\r\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"error-messagets",children:"error-message.ts"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:'export const ErrorMessage: Record<number, string> = {\r\n  1001: "\uc720\uc800\uc758 \uc815\ubcf4\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",\r\n  1002: "\uc774\ubbf8 \uc874\uc7ac\ud558\ub294 \uc720\uc800\uc785\ub2c8\ub2e4.",\r\n  1003: "\uacf5\uc9c0\uc0ac\ud56d\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",\r\n  1004: "\uacf5\uc9c0\uc0ac\ud56d \uc0dd\uc131\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",\r\n  1005: "\uacf5\uc9c0\uc0ac\ud56d \uc218\uc815\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",\r\n  1006: "\ubc30\ub108\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",\r\n  1007: "\ubc30\ub108 \uc0dd\uc131\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",\r\n  1008: "\ubc30\ub108 \uc218\uc815\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",\r\n  1009: "\ubc30\ub108\uc758 \uc21c\uc11c\ub97c \ubcc0\uacbd\ud558\ub294\ub370 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.",\r\n  // PrismaException\uc73c\ub85c \uc7a1\uc9c0 \ubabb\ud55c \uc5d0\ub7ec \ucc98\ub9ac\r\n  9998: "\ub370\uc774\ud130\ubca0\uc774\uc2a4 \uc791\uc5c5 \uc911 \uc608\uae30\uce58 \uc54a\uc740 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4. \ubb38\uc81c\uac00 \uc9c0\uc18d\ub418\uba74 \uac1c\ubc1c\uc790\uc5d0\uac8c \ubb38\uc758\ud558\uc138\uc694.",\r\n};\n'})})]})}function u(r={}){const{wrapper:e}={...(0,s.R)(),...r.components};return e?(0,o.jsx)(e,{...r,children:(0,o.jsx)(p,{...r})}):p(r)}},529087:(r,e,n)=>{n.d(e,{R:()=>a,x:()=>i});var t=n(596363);const o={},s=t.createContext(o);function a(r){const e=t.useContext(s);return t.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function i(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(o):r.components||o:a(r.components),t.createElement(s.Provider,{value:e},r.children)}}}]);