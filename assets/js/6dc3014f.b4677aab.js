"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["76741"],{8284:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>i,toc:()=>g,default:()=>u,metadata:()=>t,assets:()=>a,contentTitle:()=>l});var t=JSON.parse('{"id":"nestjs/nest logging morgan","title":"nest logging morgan","description":"HTTP request logger middleware","source":"@site/docs/nestjs/nest logging morgan.md","sourceDirName":"nestjs","slug":"/nestjs/nest logging morgan","permalink":"/docs/nestjs/nest logging morgan","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest logging custom","permalink":"/docs/nestjs/nest logging custom"},"next":{"title":"nest logging pino","permalink":"/docs/nestjs/nest logging pino"}}'),s=r(447259),o=r(255511);let i={},l="nest logging morgan",a={},g=[{value:"install",id:"install",level:2},{value:"main.ts",id:"maints",level:2}];function c(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"nest-logging-morgan",children:"nest logging morgan"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"HTTP request logger middleware"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"HTTP \uB97C \uB85C\uAE45\uD574\uC8FC\uB294 \uBBF8\uB4E4\uC6E8\uC5B4"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"install",children:"install"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"npm i morgan\n"})}),"\n",(0,s.jsx)(n.h2,{id:"maints",children:"main.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// combined - IP, method, url, status, response time, user-agent \uB97C \uB85C\uAE45\uD574\uC90C (\uC6B4\uC601\uC6A9)\r\n// dev - method, url, status, response time \uB97C \uB85C\uAE45\uD574\uC90C (\uAC1C\uBC1C\uC6A9)\r\napp.use(morgan("dev"));\r\n\r\napp.use(\r\n  morgan("dev", {\r\n    stream: function (message) {\r\n      winstonLogger.log(message);\r\n    },\r\n    // 400 \uC5D0\uB7EC \uC774\uC0C1\uB9CC \uB85C\uAE45\r\n    skip: function (req, res) {\r\n      return res.statusCode < 400;\r\n    },\r\n  }),\r\n);\r\n\r\n// custom\r\nmorgan(\r\n  function (tokens, req, res) {\r\n    return JSON.stringify({\r\n      method: tokens.method(req, res),\r\n      url: tokens.url(req, res),\r\n      status: Number.parseFloat(tokens.status(req, res)),\r\n      content_length: tokens.res(req, res, "content-length"),\r\n      response_time: Number.parseFloat(tokens["response-time"](req, res)),\r\n    });\r\n  },\r\n  {\r\n    stream: {\r\n      // Configure Morgan to use our custom logger with the http severity\r\n      write: message => {\r\n        const data = JSON.parse(message);\r\n        logger.http(`incoming-request`, data);\r\n      },\r\n    },\r\n  },\r\n);\n'})})]})}function u(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},255511:function(e,n,r){r.d(n,{R:()=>i,x:()=>l});var t=r(596363);let s={},o=t.createContext(s);function i(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);