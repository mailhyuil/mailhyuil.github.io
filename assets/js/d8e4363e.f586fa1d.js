"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[41071],{300937:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>a,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"nestjs/nest logging winston","title":"nest logging winston","description":"log\ub97c \ub85c\uadf8 \ud30c\uc77c\uc5d0 \uc800\uc7a5\ud558\uae30 \uc704\ud574 \uc0ac\uc6a9","source":"@site/docs/nestjs/nest logging winston.md","sourceDirName":"nestjs","slug":"/nestjs/nest logging winston","permalink":"/docs/nestjs/nest logging winston","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest logging pino","permalink":"/docs/nestjs/nest logging pino"},"next":{"title":"nest mapped type","permalink":"/docs/nestjs/nest mapped type"}}');var o=e(447259),s=e(529087);const i={},l="nest logging winston",a={},c=[{value:"install",id:"install",level:2},{value:"winston.config.ts",id:"winstonconfigts",level:2},{value:"main.ts",id:"maints",level:2},{value:"pm2 log \ub044\uae30",id:"pm2-log-\ub044\uae30",level:2}];function g(n){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"nest-logging-winston",children:"nest logging winston"})}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"log\ub97c \ub85c\uadf8 \ud30c\uc77c\uc5d0 \uc800\uc7a5\ud558\uae30 \uc704\ud574 \uc0ac\uc6a9"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"pm2 \ub97c \uc0ac\uc6a9\ud55c\ub2e4\uba74 logs\ub85c \uc77d\uc744 \ud30c\uc77c \uc704\uce58 \ubcc0\uacbd\ud574\uc8fc\uae30"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"winston\ub9cc \uc0ac\uc6a9\ud55c\ub2e4\uba74 \ubbf8\ub4e4\uc6e8\uc5b4\ub098 \uc778\ud130\uc149\ud130\ub97c \ub9cc\ub4e4\uc5b4\uc8fc\uace0"}),"\n",(0,o.jsxs)(r.blockquote,{children:["\n",(0,o.jsx)(r.p,{children:"morgan\uc744 \uac19\uc774 \uc0ac\uc6a9\ud55c\ub2e4\uba74 morgan middleware\uc5d0\uc11c \ub098\uc624\ub294 stream\uc744 winston\uc5d0 \ub123\uc5b4\uc8fc\uae30"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"install",children:"install"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-sh",children:"npm i winston\r\nnpm i nest-winston\r\n\r\n# \ub85c\uae45\ud55c \uc815\ubcf4\ub4e4\uc744 \ub0a0\uc9dc \ubcc4\ub85c \ub85c\uadf8 \ud30c\uc77c\uc744 \uc0dd\uc131\ud574\uc8fc\uace0 \uc77c\uc815 \uc2dc\uac04\uc774 \uc9c0\ub098\uba74 \uc0ad\uc81c \ubc0f \uc555\ucd95\uc744 \ud574\uc8fc\ub294 \uae30\ub2a5\r\nnpm i winston-daily-rotate-file\r\n\r\nnpm i winston nest-winston winston-daily-rotate-file\n"})}),"\n",(0,o.jsx)(r.h2,{id:"winstonconfigts",children:"winston.config.ts"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-ts",children:'import { utilities, WinstonModule } from "nest-winston";\r\nimport process from "process";\r\nimport winston from "winston";\r\nimport winstonDaily from "winston-daily-rotate-file";\r\nconst { combine, timestamp, printf } = winston.format;\r\n\r\nconst logDir = "logs"; // logs \ub514\ub809\ud1a0\ub9ac \ud558\uc704\uc5d0 \ub85c\uadf8 \ud30c\uc77c \uc800\uc7a5\r\n\r\nconst logFormat = printf(info => {\r\n  return `${info.timestamp} ${info.level}: ${info.message}`;\r\n});\r\n\r\nconst productionTransports = () => [\r\n  // info \ub808\ubca8 \ub85c\uadf8\ub97c \uc800\uc7a5\ud560 \ud30c\uc77c \uc124\uc815\r\n  new winstonDaily({\r\n    level: "info",\r\n    datePattern: "YYYY-MM-DD",\r\n    dirname: logDir,\r\n    filename: `%DATE%.info.log`,\r\n    maxFiles: 30,\r\n    zippedArchive: true,\r\n  }),\r\n  // warn \ub808\ubca8 \ub85c\uadf8\ub97c \uc800\uc7a5\ud560 \ud30c\uc77c \uc124\uc815\r\n  new winstonDaily({\r\n    level: "warn",\r\n    datePattern: "YYYY-MM-DD",\r\n    dirname: logDir,\r\n    filename: `%DATE%.warn.log`,\r\n    maxFiles: 30,\r\n    zippedArchive: true,\r\n  }),\r\n  // error \ub808\ubca8 \ub85c\uadf8\ub97c \uc800\uc7a5\ud560 \ud30c\uc77c \uc124\uc815\r\n  new winstonDaily({\r\n    level: "error",\r\n    datePattern: "YYYY-MM-DD",\r\n    dirname: logDir,\r\n    filename: `%DATE%.error.log`,\r\n    maxFiles: 30,\r\n    zippedArchive: true,\r\n  }),\r\n];\r\n\r\nconst localTransports = () => [\r\n  new winston.transports.Console({\r\n    level: "silly", // \ubaa8\ub4e0 \ub2e8\uacc4\ub97c \ub85c\uadf8\r\n    format: winston.format.combine(\r\n      winston.format.timestamp(),\r\n      utilities.format.nestLike("APP", {\r\n        prettyPrint: true, // nest\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \uc635\uc158. \ub85c\uadf8 \uac00\ub3c5\uc131\uc744 \ub192\uc5ec\uc90c\r\n        colors: true, // \ub85c\uadf8\uc5d0 \uc0c9\uae54\uc744 \ub123\uc5b4\uc11c \ucd9c\ub825\r\n      }),\r\n    ),\r\n  }),\r\n];\r\n\r\n/*\r\n * Log Level\r\n * error: 0, warn: 1, info: 2, http: 3, verbose: 4, debug: 5, silly: 6\r\n */\r\nconst winstonLogger = WinstonModule.createLogger({\r\n  format: combine(\r\n    timestamp({\r\n      format: "YYYY-MM-DD HH:mm:ss",\r\n    }),\r\n    logFormat,\r\n  ),\r\n  transports: process.env["NODE_ENV"] === "production" ? productionTransports() : localTransports(),\r\n});\r\n\r\n// morgan winston \uc124\uc815\r\nconst stream = {\r\n  write: message => {\r\n    winstonLogger.log(message);\r\n  },\r\n};\r\n\r\nexport { stream, winstonLogger };\n'})}),"\n",(0,o.jsx)(r.h2,{id:"maints",children:"main.ts"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-ts",children:'import { winstonLogger, stream } from "./winston.config";\r\n\r\nconst app = await NestFactory.create(AppModule, {\r\n  logger: winstonLogger,\r\n});\r\napp.use(morgan("combined", { stream }));\n'})}),"\n",(0,o.jsx)(r.h2,{id:"pm2-log-\ub044\uae30",children:"pm2 log \ub044\uae30"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-js",children:'module.exports = {\r\n  apps: [\r\n    {\r\n      out_file: "/dev/null",\r\n      error_file: "/dev/null",\r\n    },\r\n  ],\r\n};\n'})})]})}function m(n={}){const{wrapper:r}={...(0,s.R)(),...n.components};return r?(0,o.jsx)(r,{...n,children:(0,o.jsx)(g,{...n})}):g(n)}},529087:(n,r,e)=>{e.d(r,{R:()=>i,x:()=>l});var t=e(596363);const o={},s=t.createContext(o);function i(n){const r=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function l(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),t.createElement(s.Provider,{value:r},n.children)}}}]);