"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["703665"],{21016:function(e,r,n){n.r(r),n.d(r,{frontMatter:()=>a,toc:()=>o,default:()=>i,metadata:()=>s,assets:()=>p,contentTitle:()=>d});var s=JSON.parse('{"id":"db-postgres/postgres setting \uC138\uD305","title":"postgres \uC138\uD305","description":"pg_basebackup \uBB34\uC870\uAC74 \uD55C\uBC88 \uD574\uB450\uAE30","source":"@site/docs/db-postgres/postgres setting \uC138\uD305.md","sourceDirName":"db-postgres","slug":"/db-postgres/postgres setting \uC138\uD305","permalink":"/docs/db-postgres/postgres setting \uC138\uD305","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"postgres schema pg_catalog","permalink":"/docs/db-postgres/postgres schema pg_catalog"},"next":{"title":"Stored Procedure","permalink":"/docs/db-postgres/postgres stored procedure"}}'),t=n(447259),c=n(255511);let a={},d="postgres \uC138\uD305",p={},o=[{value:"/var/lib/postgresql/data/postgresql.conf",id:"varlibpostgresqldatapostgresqlconf",level:2},{value:"\uBC31\uC5C5",id:"\uBC31\uC5C5",level:2},{value:"pg_dump script",id:"pg_dump-script",level:3},{value:"pg_basebackup script",id:"pg_basebackup-script",level:3},{value:"3\uC911 \uBC31\uC5C5 script",id:"3\uC911-\uBC31\uC5C5-script",level:3},{value:"CRONJOB",id:"cronjob",level:3}];function l(e){let r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"postgres-\uC138\uD305",children:"postgres \uC138\uD305"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"pg_basebackup \uBB34\uC870\uAC74 \uD55C\uBC88 \uD574\uB450\uAE30"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"path"}),"\n",(0,t.jsx)(r.p,{children:"/var/lib/postgresql/data"}),"\n",(0,t.jsx)(r.p,{children:"/var/lib/postgresql/data/postgresql.conf"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"varlibpostgresqldatapostgresqlconf",children:"/var/lib/postgresql/data/postgresql.conf"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"/mnt/server/archivedir \uC0DD\uC131 (postgres \uC0AC\uC6A9\uC790 \uAD8C\uD55C)"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"/mnt/server/backupdir \uC0DD\uC131 (postgres \uC0AC\uC6A9\uC790 \uAD8C\uD55C)"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-conf",children:"## ARCHIVE BACKUP\r\narchive_mode                    = on\r\narchive_command                 = 'test ! -f /mnt/server/archivedir/%f && cp %p /mnt/server/archivedir/%f'\r\n                                # %p: WAL \uD3F4\uB354, %f: WAL \uD30C\uC77C\uC774\uB984\r\n                                # aws s3\uB85C \uBCF4\uB0B4\uB294 \uACBD\uC6B0: 'aws s3 cp %p s3://bucket-name/%f'\r\narchive_timeout                 = 1 # 1\uCD08\uB9C8\uB2E4 \uAC15\uC81C\uB85C WAL \uD30C\uC77C\uC744 archive_command\uB85C \uBCF4\uB0C4 (0\uC774\uBA74 16MB \uCC44\uC6CC\uC9C0\uBA74 \uBCF4\uB0C4)\r\n\r\n## Archive Recovery \uC2DC \uC0AC\uC6A9\r\nrestore_command                 = 'cp /mnt/server/archivedir/%f %p'\r\nrecovery_target_time            = '2024-01-31 09:07:00 UTC'\n"})}),"\n",(0,t.jsx)(r.h2,{id:"\uBC31\uC5C5",children:"\uBC31\uC5C5"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"pg_dump, pg_basebackup\uC744 \uC8FC\uAE30\uC801\uC73C\uB85C \uD574\uC8FC\uB294 \uC2A4\uD06C\uB9BD\uD2B8\uB97C \uC2E4\uD589"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\uBC31\uC5C5 \uB370\uC774\uD130\uB294 s3, nas, \uB2E4\uB978 \uC11C\uBC84\uB85C \uBCF4\uB0B4\uAE30"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"pg_dump-script",children:"pg_dump script"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh",children:'#!/bin/bash\r\nDEL_FILE=$(date -d \'30 day ago\' +\'%Y-%m-%d_\')"*.dump"\r\nFILENAME=$(date +"%Y-%m-%d_%H%M").dump\r\nBACKUP_DIR=/mnt/server/backupdir/dumps\r\nUSERNAME=user_name\r\nDB_NAME=DB_name\r\nPASSWORD=password\r\n\r\ncd $BACKUP_DIR\r\n\r\n#----- DUMP BACKUP_FILE -----\r\necho "DB backup start time : " $(date +"%Y-%m-%d %H:%M:%S")\r\nPGPASSWORD=$PASSWORD pg_dump -U $USERNAME $DB_NAME -Fc -v > "${BACKUP_DIR}/${DB_NAME}_${FILENAME}"\r\necho "Successful db backup ( ${BACKUP_DIR}/${DB_NAME}_${FILENAME} )"\r\n\r\n#----- DELETE AFTER 30 DAYS -----\r\necho "Delete old file ${DB_NAME}_${DEL_FILE}"\r\nrm "${BACKUP_DIR}/${DB_NAME}_${DEL_FILE}"\r\necho "BACKUP - End time : " $(date +"%Y-%m-%d %H:%M:%S")\n'})}),"\n",(0,t.jsx)(r.h3,{id:"pg_basebackup-script",children:"pg_basebackup script"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"pg_basebackup\uC744 \uD55C \uB4A4 WAL\uC744 \uADF8 \uC804 wal\uC744 \uC9C0\uC6B0\uAC70\uB098 \uB2E4\uB978 \uC11C\uBC84\uB85C \uBCF4\uB0B4\uB294 \uC2A4\uD06C\uB9BD\uD2B8"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh",children:'#!/bin/bash\r\nDEL_FILE=$(date -d \'30 day ago\' +\'%Y-%m-%d_\')"*.dump"\r\nFILENAME=$(date +"%Y-%m-%d_%H%M").dump\r\nBACKUP_DIR=/mnt/server/backupdir/bases\r\nUSERNAME=user_name\r\nDB_NAME=DB_name\r\nPASSWORD=password\r\n\r\ncd $BACKUP_DIR\r\n\r\n#----- DUMP BACKUP_FILE -----\r\necho "DB backup start time : " $(date +"%Y-%m-%d %H:%M:%S")\r\npg_basebackup -D $BACKUP_DIR -c fast -X none\r\necho "Successful db backup ( ${BACKUP_DIR}/${DB_NAME}_${FILENAME} )"\r\n\r\n#----- DELETE AFTER 30 DAYS -----\r\necho "Delete old file ${DB_NAME}_${DEL_FILE}"\r\nrm "${BACKUP_DIR}/${DB_NAME}_${DEL_FILE}"\r\necho "BACKUP - End time : " $(date +"%Y-%m-%d %H:%M:%S")\n'})}),"\n",(0,t.jsx)(r.h3,{id:"3\uC911-\uBC31\uC5C5-script",children:"3\uC911 \uBC31\uC5C5 script"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"dump, basebackup, wal\uC744 \uB450\uAC1C\uC758 \uC6D0\uACA9 \uC11C\uBC84\uB85C \uBCF4\uB0B4\uB294 \uC2A4\uD06C\uB9BD\uD2B8"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh"})}),"\n",(0,t.jsx)(r.h3,{id:"cronjob",children:"CRONJOB"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"crontab -e"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh",children:"# pg_basebackup + wal (\uB9E4\uC77C 00\uC2DC 00\uBD84)\r\n0 0 * * * /bin/bash pg_basebackup.sh\r\n\r\n# pg_dump (\uD55C\uC2DC\uAC04\uB9C8\uB2E4)\r\n0 * * * * /bin/bash pg_dump.sh\r\n\r\n# 3\uC911 \uBC31\uC5C5 (\uD55C\uC2DC\uAC04\uB9C8\uB2E4)\r\n0 * * * * /bin/bash remote_backup.sh\n"})})]})}function i(e={}){let{wrapper:r}={...(0,c.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},255511:function(e,r,n){n.d(r,{R:()=>a,x:()=>d});var s=n(596363);let t={},c=s.createContext(t);function a(e){let r=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(c.Provider,{value:r},e.children)}}}]);