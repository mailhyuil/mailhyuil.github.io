"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["959091"],{192654:function(r,e,n){n.r(e),n.d(e,{frontMatter:()=>a,toc:()=>l,default:()=>u,metadata:()=>s,assets:()=>i,contentTitle:()=>c});var s=JSON.parse('{"id":"nodejs/nodejs module multicore worker_threads in child_process - \uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uC5D0\uC11C \uBA40\uD2F0 \uC2A4\uB808\uB529","title":"node worker_threads in child_process (\uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uC5D0\uC11C \uBA40\uD2F0 \uC2A4\uB808\uB529)","description":"\uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uB97C \uC0DD\uC131\uD558\uACE0 \uADF8 \uC548\uC5D0\uC11C worker_threads\uB97C \uC0AC\uC6A9\uD558\uC5EC \uBA40\uD2F0 \uC2A4\uB808\uB529\uC744 \uAD6C\uD604\uD558\uB294 \uBC29\uBC95","source":"@site/docs/nodejs/nodejs module multicore worker_threads in child_process - \uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uC5D0\uC11C \uBA40\uD2F0 \uC2A4\uB808\uB529.md","sourceDirName":"nodejs","slug":"/nodejs/nodejs module multicore worker_threads in child_process - \uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uC5D0\uC11C \uBA40\uD2F0 \uC2A4\uB808\uB529","permalink":"/docs/nodejs/nodejs module multicore worker_threads in child_process - \uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uC5D0\uC11C \uBA40\uD2F0 \uC2A4\uB808\uB529","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"node worker_threads SharedArrayBuffer & Atomics","permalink":"/docs/nodejs/nodejs module multicore worker_threads SharedArrayBuffer & Atomics"},"next":{"title":"piscina","permalink":"/docs/nodejs/nodejs module multicore worker_threads piscina"}}'),o=n(447259),t=n(255511);let a={},c="node worker_threads in child_process (\uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uC5D0\uC11C \uBA40\uD2F0 \uC2A4\uB808\uB529)",i={},l=[{value:"main.js",id:"mainjs",level:2},{value:"child.js",id:"childjs",level:2},{value:"single worker",id:"single-worker",level:3},{value:"multi workers",id:"multi-workers",level:3},{value:"worker.js",id:"workerjs",level:2}];function d(r){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.R)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"node-worker_threads-in-child_process-\uC790\uC2DD-\uD504\uB85C\uC138\uC2A4\uC5D0\uC11C-\uBA40\uD2F0-\uC2A4\uB808\uB529",children:"node worker_threads in child_process (\uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uC5D0\uC11C \uBA40\uD2F0 \uC2A4\uB808\uB529)"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"\uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uB97C \uC0DD\uC131\uD558\uACE0 \uADF8 \uC548\uC5D0\uC11C worker_threads\uB97C \uC0AC\uC6A9\uD558\uC5EC \uBA40\uD2F0 \uC2A4\uB808\uB529\uC744 \uAD6C\uD604\uD558\uB294 \uBC29\uBC95"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"main process\uC640 \uACA9\uB9AC\uC2DC\uD0B4\uACFC \uB3D9\uC2DC\uC5D0 cpu-intensive\uD55C \uC791\uC5C5\uC744 \uBCD1\uB82C\uB85C \uCC98\uB9AC\uD560 \uC218 \uC788\uC74C"}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"mainjs",children:"main.js"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'const { fork } = require("child_process");\r\n\r\n// \uC790\uC2DD \uD504\uB85C\uC138\uC2A4 \uC2E4\uD589\r\nconst child = fork("./child.js");\r\n\r\nchild.on("message", message => {\r\n  console.log("main got message:", message);\r\n});\r\n\r\n// \uC790\uC2DD \uD504\uB85C\uC138\uC2A4\uC5D0 \uC791\uC5C5 \uC694\uCCAD\r\nchild.send({ num: 100 });\n'})}),"\n",(0,o.jsx)(e.h2,{id:"childjs",children:"child.js"}),"\n",(0,o.jsx)(e.h3,{id:"single-worker",children:"single worker"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'const { Worker } = require("worker_threads");\r\n\r\n// \uBD80\uBAA8 \uD504\uB85C\uC138\uC2A4\uB85C\uBD80\uD130 \uBA54\uC2DC\uC9C0 \uBC1B\uAE30\r\nprocess.on("message", message => {\r\n  const { num } = message;\r\n  if (num) {\r\n    // \uC6CC\uCEE4 \uC2A4\uB808\uB4DC \uC2E4\uD589\r\n    const worker = new Worker(`./worker.js`, {\r\n      workerData: {\r\n        num,\r\n      },\r\n    });\r\n\r\n    worker.on("message", data => {\r\n      console.log("child got data:", data);\r\n      process.send(data); // \uBD80\uBAA8 \uD504\uB85C\uC138\uC2A4\uB85C \uACB0\uACFC \uC804\uC1A1\r\n    });\r\n  }\r\n  process.exit(0);\r\n});\n'})}),"\n",(0,o.jsx)(e.h3,{id:"multi-workers",children:"multi workers"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'const { Worker } = require("worker_threads");\r\n\r\n// \uBD80\uBAA8 \uD504\uB85C\uC138\uC2A4\uB85C\uBD80\uD130 \uBA54\uC2DC\uC9C0 \uBC1B\uAE30\r\nprocess.on("message", async message => {\r\n  const { num } = message;\r\n  if (num) {\r\n    const worker1Promise = calculate("./worker.js", 0, num / 2);\r\n    const worker2Promise = calculate("./worker.js", num / 2, num);\r\n    const result = await Promise.all([worker1Promise, worker2Promise]);\r\n    const sum = result.reduce((acc, cur) => acc + cur.result, 0);\r\n    process.send(sum);\r\n  }\r\n  process.exit(0);\r\n});\r\n\r\nfunction calculate(workerPath, start, end) {\r\n  return new Promise((resolve, reject) => {\r\n    const worker = new Worker(workerPath, {\r\n      workerData: {\r\n        start,\r\n        end,\r\n      },\r\n    });\r\n    const handleError = error => {\r\n      console.error(error);\r\n      reject(error);\r\n    };\r\n    worker.addListener("error", handleError);\r\n    const handlerMessage = data => {\r\n      resolve(data); // \uBD80\uBAA8 \uD504\uB85C\uC138\uC2A4\uB85C \uACB0\uACFC \uC804\uC1A1\r\n      worker.removeListener("message", handlerMessage);\r\n      worker.removeListener("error", handleError);\r\n    };\r\n    // message \uC774\uBCA4\uD2B8 \uC0AC\uC6A9 \uC2DC \uAC12\uC744 \uBCF5\uC0AC\uD558\uC5EC \uC804\uB2EC (SharedArrayBuffer\uB97C \uC0AC\uC6A9\uD558\uC5EC \uC131\uB2A5\uC744 \uD5A5\uC0C1\uC2DC\uD0AC \uC218 \uC788\uC74C)\r\n    worker.addListener("message", handlerMessage);\r\n  });\r\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"workerjs",children:"worker.js"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-js",children:'const { isMainThread, parentPort, workerData } = require("worker_threads");\r\n\r\nif (isMainThread) {\r\n  console.log("\uC774 \uD30C\uC77C\uC740 \uC9C1\uC811 \uC2E4\uD589\uD558\uB294 \uAC8C \uC544\uB2C8\uB77C child_process\uC5D0\uC11C \uC2E4\uD589\uD574\uC57C \uD568.");\r\n  process.exit(1);\r\n}\r\n\r\nconst { num } = workerData;\r\nconsole.log("worker got data:", num);\r\nif (num) {\r\n  console.log("worker start");\r\n  let sum = 0;\r\n  // CPU \uC9D1\uC911 \uC5F0\uC0B0\r\n  for (let i = 0; i < num; i++) {\r\n    sum += i;\r\n  }\r\n  console.log("worker end");\r\n  parentPort.postMessage({ result: sum });\r\n}\n'})})]})}function u(r={}){let{wrapper:e}={...(0,t.R)(),...r.components};return e?(0,o.jsx)(e,{...r,children:(0,o.jsx)(d,{...r})}):d(r)}},255511:function(r,e,n){n.d(e,{R:()=>a,x:()=>c});var s=n(596363);let o={},t=s.createContext(o);function a(r){let e=s.useContext(t);return s.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function c(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(o):r.components||o:a(r.components),s.createElement(t.Provider,{value:e},r.children)}}}]);