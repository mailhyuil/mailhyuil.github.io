"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[106752],{529087:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var t=s(596363);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}},826031:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"nestjs/nest google analytics Data API","title":"nestjs google analytics Data API","description":"document","source":"@site/docs/nestjs/nest google analytics Data API.md","sourceDirName":"nestjs","slug":"/nestjs/nest google analytics Data API","permalink":"/docs/nestjs/nest google analytics Data API","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest file upload","permalink":"/docs/nestjs/nest file upload"},"next":{"title":"nest graceful shutdown forceCloseConnection","permalink":"/docs/nestjs/nest graceful shutdown forceCloseConnection"}}');var r=s(447259),a=s(529087);const o={},l="nestjs google analytics Data API",i={},c=[{value:"install",id:"install",level:2},{value:"main.js",id:"mainjs",level:2},{value:"service",id:"service",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"nestjs-google-analytics-data-api",children:"nestjs google analytics Data API"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://developers.google.com/analytics/devguides/reporting/data/v1/rest/v1beta/properties/runReport?hl=ko",children:"document"})}),"\n",(0,r.jsx)(n.h2,{id:"install",children:"install"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"npm install @google-analytics/data\n"})}),"\n",(0,r.jsx)(n.h2,{id:"mainjs",children:"main.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'process.env.GOOGLE_APPLICATION_CREDENTIALS = join(__dirname, "assets", "ga.json");\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create<NestExpressApplication>(AppModule);\r\n\r\n  /** Static Assets */\r\n  app.useStaticAssets(join(__dirname, "assets"));\r\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"service",children:"service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import { BetaAnalyticsDataClient } from "@google-analytics/data";\r\nimport { Injectable, NotFoundException } from "@nestjs/common";\r\nimport { GoogleAnalyticsDTO } from "./google-analytics.dto";\r\nconst propertyId = process.env.GA_PROPERTY_ID;\r\n\r\n@Injectable()\r\nexport class GoogleAnalyticsService {\r\n  client = new BetaAnalyticsDataClient();\r\n  async getReport() {\r\n    const [res] = await this.client.runReport(\r\n      {\r\n        property: `properties/${propertyId}`,\r\n        dateRanges: [\r\n          {\r\n            startDate: "2024-05-01",\r\n            endDate: "today",\r\n          },\r\n        ],\r\n        dimensions: [\r\n          {\r\n            name: "date", // \ub0a0\uc9dc\r\n          },\r\n        ],\r\n        metrics: [\r\n          {\r\n            name: "totalUsers", // \uc804\uccb4 \uc0ac\uc6a9\uc790 \uc218\r\n          },\r\n          {\r\n            name: "newUsers", // \uc2e0\uaddc \uc0ac\uc6a9\uc790 \uc218\r\n          },\r\n          { name: "screenPageViews" }, // \ud398\uc774\uc9c0 \uc870\ud68c \uc218\r\n        ],\r\n      },\r\n      {}\r\n    );\r\n\r\n    if (!res.rows) {\r\n      throw new NotFoundException("Google Analytics data\uc744 \ucc3e\uc744 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");\r\n    }\r\n\r\n    const dimensionValues = res.rows[0]?.dimensionValues;\r\n    // [ { value: \'20240508\', oneValue: \'value\' } ] // date\r\n\r\n    const metricValues = res.rows[0]?.metricValues;\r\n    // [\r\n    //   { value: \'3\', oneValue: \'value\' }, // totalUsers\r\n    //   { value: \'2\', oneValue: \'value\' }, // newUsers\r\n    //   { value: \'24\', oneValue: \'value\' } // screenPageViews\r\n    // ]\r\n\r\n    const totalUsers = metricValues?.[0]?.value || 0;\r\n    const newUsers = metricValues?.[1]?.value || 0;\r\n    const screenPageViews = metricValues?.[2]?.value || 0;\r\n\r\n    return {\r\n      totalUsers,\r\n      newUsers,\r\n      screenPageViews,\r\n    } as GoogleAnalyticsDTO;\r\n  }\r\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);