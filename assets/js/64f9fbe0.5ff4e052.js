"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["131186"],{675844:function(n,r,e){e.r(r),e.d(r,{frontMatter:()=>o,toc:()=>c,default:()=>d,metadata:()=>t,assets:()=>a,contentTitle:()=>s});var t=JSON.parse('{"id":"nginx/nginx \uC138\uD305","title":"nginx","description":"install","source":"@site/docs/nginx/nginx \uC138\uD305.md","sourceDirName":"nginx","slug":"/nginx/nginx \uC138\uD305","permalink":"/docs/nginx/nginx \uC138\uD305","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nginx \uBCC0\uC218","permalink":"/docs/nginx/nginx \uBCC0\uC218"},"next":{"title":"nginx config \uC704\uCE58","permalink":"/docs/nginx/nginx \uD30C\uC77C \uC704\uCE58 file path"}}'),i=e(447259),l=e(255511);let o={},s="nginx",a={},c=[{value:"install",id:"install",level:2},{value:"\uC2DC\uC2A4\uD15C \uD655\uC778",id:"\uC2DC\uC2A4\uD15C-\uD655\uC778",level:2},{value:"default.conf",id:"defaultconf",level:2}];function p(n){let r={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,l.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"nginx",children:"nginx"})}),"\n",(0,i.jsx)(r.h2,{id:"install",children:"install"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sh",children:"docker run --name nginx -d -p 80:80 -v $(pwd)/nginx:/etc/nginx nginx\r\n\r\n# module \uD655\uC778\r\nnginx -V 2>&1 | grep brotli\r\nnginx -V 2>&1 | grep --with-http_v2_module\r\nnginx -V 2>&1 | grep --with-http_v3_module\r\n...\n"})}),"\n",(0,i.jsx)(r.h2,{id:"\uC2DC\uC2A4\uD15C-\uD655\uC778",children:"\uC2DC\uC2A4\uD15C \uD655\uC778"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sh",children:"# core \uC218 \uD655\uC778\r\nnproc\r\n# or\r\ngrep -c ^processor /proc/cpuinfo\r\n\r\n# worker_processes \uC124\uC815\r\nworker_processes auto;  # CPU \uCF54\uC5B4 \uAC1C\uC218\uB9CC\uD07C \uC790\uB3D9 \uC124\uC815\r\nworker_processes 4;  # 4\uAC1C\uC758 worker process \uC0DD\uC131\r\n# \uC11C\uBC84\uC5D0 \uB744\uC6B4 \uD504\uB85C\uC138\uC2A4\uC758 \uC218\uC5D0 \uB9DE\uCDB0\uC11C \uC870\uC808\r\n# (e.g. nestjs 1, postgres 1 \uAC00 \uD55C \uC11C\uBC84\uC5D0 \uC788\uB2E4\uBA74 2\uB85C \uC124\uC815)\n"})}),"\n",(0,i.jsx)(r.h2,{id:"defaultconf",children:"default.conf"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-conf",children:'client_max_body_size 500M;\r\n\r\n# gzip\r\ngzip on;\r\ngzip_disable "MSIE [1-6]\\.(?!.*SV1)";  # IE6 \uC774\uD558 \uBE44\uD65C\uC131\uD654\r\ngzip_vary on;  # \uCE90\uC2F1 \uCD5C\uC801\uD654 (Vary: Accept-Encoding)\r\ngzip_comp_level 5;  # \uC555\uCD95\uB960\uACFC \uC18D\uB3C4\uC758 \uADE0\uD615\r\ngzip_proxied expired no-cache no-store private auth;  # \uD504\uB85D\uC2DC \uC694\uCCAD \uC870\uAC74\uBD80 \uD5C8\uC6A9\r\ngzip_types text/plain text/css text/javascript application/javascript application/json application/xml application/xml+rss image/svg+xml;\r\n\r\n# brotli\r\n# brotli_static on;\r\n\r\n# rate limiting: \uCD08\uB2F9 10\uAC1C\uC758 \uC694\uCCAD\uB9CC \uD5C8\uC6A9\r\nlimit_req_zone $binary_remote_addr zone=req_limit_per_ip:10m rate=10r/s;\r\n# slow rate limiting: \uCD08\uB2F9 5\uAC1C\uC758 \uC694\uCCAD\uB9CC \uD5C8\uC6A9\r\nlimit_req_zone $binary_remote_addr zone=req_limit_api_slow:10m rate=5r/s;\r\n\r\nserver {\r\n    server_name example.com;\r\n\r\n    listen 80;\r\n    listen [::]:80;\r\n\r\n    location /.well-known/acme-challenge/ {\r\n        allow all;\r\n        root /var/www/certbot;\r\n    }\r\n\r\n    return 301 https://$host$request_uri;\r\n}\r\n\r\nserver {\r\n    server_name example.com;\r\n    # http2 \uD65C\uC131\uD654\r\n    http2 on;\r\n    listen 443 ssl;\r\n\r\n    # http3 \uD65C\uC131\uD654\r\n    http3 on; # http3 \uC9C0\uC6D0\uC744 \uD65C\uC131\uD654\r\n    listen 443 quic reuseport;  # UDP listener for QUIC+HTTP/3\r\n    quic_gso on; # GSO\uB97C \uD65C\uC131\uD654\uD569\uB2C8\uB2E4\r\n    quic_retry on; # \uC8FC\uC18C \uD655\uC778 \uD5C8\uC6A9\r\n    # QUIC\uC744 \uC0AC\uC6A9\uD560 \uC218 \uC788\uB3C4\uB85D \uBE0C\uB77C\uC6B0\uC800\uC5D0 \uC54C\uB9BC (\uC791\uB3D9\uD558\uC9C0 \uC54A\uC73C\uBA74 http \uBE14\uB85D\uC774\uB098 location \uBE14\uB85D\uC5D0 \uCD94\uAC00)\r\n    add_header Alt-Svc \'h3=":443"; ma=86400\';\r\n\r\n    ssl_protocols TLSv1.2 TLSv1.3;\r\n    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;\r\n    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;\r\n\r\n    # (optional) enable OCSP stapling\r\n    ssl_trusted_certificate /etc/letsencrypt/live/example.com/chain.pem;\r\n    ssl_stapling on;\r\n    ssl_stapling_verify on;\r\n    resolver 8.8.8.8 1.1.1.1; # \uB124\uC784\uC11C\uBC84\uC758 \uC8FC\uC18C (\uD638\uC2A4\uD305 \uC5C5\uCCB4\uC758)\r\n\r\n    location = / {\r\n        try_files \'\' @ssr;\r\n    }\r\n\r\n    location / {\r\n        # rate limiting\r\n        limit_req zone=req_limit_per_ip burst=20 nodelay;\r\n\r\n        root /app/client/browser;\r\n        index index.html index.htm;\r\n        try_files $uri $uri/ @ssr;\r\n    }\r\n\r\n    location /admin {\r\n        # rate limiting\r\n        limit_req zone=req_limit_per_ip burst=20 nodelay;\r\n\r\n        alias /app/admin;\r\n        index index.html index.htm;\r\n        try_files $uri $uri/ /admin/index.html =404;\r\n    }\r\n\r\n    location /api/v1/ {\r\n        # slow rate limiting\r\n        limit_req zone=req_limit_api_slow burst=10 nodelay;\r\n\r\n        proxy_pass http://server:3000;\r\n    }\r\n\r\n    location /api/v1/sse/ {\r\n        proxy_set_header  X-Forwarded-For $remote_addr;\r\n\r\n        proxy_set_header Connection "";\r\n        proxy_http_version 1.1;\r\n        chunked_transfer_encoding off;\r\n\r\n        proxy_buffering off;\r\n        proxy_cache off;\r\n        proxy_pass http://server:3000;\r\n    }\r\n\r\n    location @ssr {\r\n        internal;\r\n        proxy_pass http://localhost:4000;\r\n        error_page 500 502 503 504 = @fallback;\r\n    }\r\n\r\n    location @fallback {\r\n        internal;\r\n        index index.csr.html index.html;\r\n        try_files $uri $uri/ /index.csr.html =404;\r\n    }\r\n}\n'})})]})}function d(n={}){let{wrapper:r}={...(0,l.R)(),...n.components};return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(p,{...n})}):p(n)}},255511:function(n,r,e){e.d(r,{R:()=>o,x:()=>s});var t=e(596363);let i={},l=t.createContext(i);function o(n){let r=t.useContext(l);return t.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function s(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),t.createElement(l.Provider,{value:r},n.children)}}}]);