"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[575978],{529087:(n,e,r)=>{r.d(e,{R:()=>s,x:()=>d});var i=r(596363);const t={},o=i.createContext(t);function s(n){const e=i.useContext(o);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),i.createElement(o.Provider,{value:e},n.children)}},972634:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>a,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"x algorithm/algorithm \ud22c\ud3ec\uc778\ud130 Window","title":"Window","description":"Fixed Window Counter","source":"@site/docs/x algorithm/algorithm \ud22c\ud3ec\uc778\ud130 Window.md","sourceDirName":"x algorithm","slug":"/x algorithm/algorithm \ud22c\ud3ec\uc778\ud130 Window","permalink":"/docs/x algorithm/algorithm \ud22c\ud3ec\uc778\ud130 Window","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\uc9c0\uc5f0\ud3c9\uac00","permalink":"/docs/x algorithm/algorithm \uc9c0\uc5f0\ud3c9\uac00"},"next":{"title":"\ud22c \ud3ec\uc778\ud130","permalink":"/docs/x algorithm/algorithm \ud22c\ud3ec\uc778\ud130"}}');var t=r(447259),o=r(529087);const s={},d="Window",c={},l=[{value:"Fixed Window Counter",id:"fixed-window-counter",level:2},{value:"Sliding Window Log",id:"sliding-window-log",level:2},{value:"Sliding Window Counter",id:"sliding-window-counter",level:2}];function w(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"window",children:"Window"})}),"\n",(0,t.jsx)(e.h2,{id:"fixed-window-counter",children:"Fixed Window Counter"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"express-rate-limit"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'class FixedWindowCounter {\r\n  constructor(maxRequestPerSec, windowSizeInMs) {\r\n    this.windows = new Map();\r\n    this.maxRequestPerSec = maxRequestPerSec;\r\n    this.windowSizeInMs = windowSizeInMs;\r\n  }\r\n\r\n  allow() {\r\n    const windowKey = Math.floor(Date.now() / this.windowSizeInMs);\r\n    if (!this.windows.has(windowKey)) {\r\n      this.windows.set(windowKey, new AtomicInteger(0));\r\n    }\r\n    return this.windows.get(windowKey).incrementAndGet() <= this.maxRequestPerSec;\r\n  }\r\n\r\n  toString() {\r\n    let sb = "";\r\n    for (const [windowKey, atomicInteger] of this.windows.entries()) {\r\n      sb += windowKey + " --\x3e " + atomicInteger + "\\n";\r\n    }\r\n    return sb;\r\n  }\r\n}\r\n\r\nclass AtomicInteger {\r\n  constructor(value) {\r\n    this.value = value || 0;\r\n  }\r\n\r\n  incrementAndGet() {\r\n    return ++this.value;\r\n  }\r\n\r\n  toString() {\r\n    return this.value.toString();\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"sliding-window-log",children:"Sliding Window Log"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"[1,[2,3,4],5,6] // [2,3,4] \uac00 \uc708\ub3c4\uc6b0"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"1\ucd08\ub9c8\ub2e4 \uc708\ub3c4\uc6b0\ub97c \uc774\ub3d9\uc2dc\ud0a4\uba74\uc11c \uc708\ub3c4\uc6b0\uc5d0 \ud3ec\ud568\ub41c \uc694\uc18c\uc758 \uac1c\uc218\ub97c \uc138\ub294 \ubc29\uc2dd"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\ud22c\ud3ec\uc778\ud130 \uc0ac\uc6a9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"class SlidingWindowLog {\r\n  constructor(maxRequestPerSec) {\r\n    this.windowLog = [];\r\n    this.maxRequestPerSec = maxRequestPerSec;\r\n  }\r\n\r\n  allow() {\r\n    const now = Date.now();\r\n    const boundary = now - 1000;\r\n    while (this.windowLog.length > 0 && this.windowLog[0] <= boundary) {\r\n      this.windowLog.shift();\r\n    }\r\n    this.windowLog.push(now);\r\n    console.log(`current time=${now}, log size=${this.windowLog.length}`);\r\n    return this.windowLog.length <= this.maxRequestPerSec;\r\n  }\r\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"sliding-window-counter",children:"Sliding Window Counter"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"function slidingWindow(n, arr) {\r\n  let res = 0;\r\n  let sum = 0;\r\n\r\n  // \uc55e\uc758 n\uac1c \ub354\ud558\uae30\r\n  for (let i = 0; i < n; i++) {\r\n    sum += arr[i];\r\n  }\r\n\r\n  res = sum;\r\n\r\n  // \uc2ac\ub77c\uc774\ub529 \uc708\ub3c4\r\n  for (let i = n; i < arr.length; i++) {\r\n    sum += arr[i] - arr[i - n];\r\n    res = Math.max(res, sum);\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nconsole.log(slidingWindow(2, [7, 6, 5, 4, 3, 2, 1]));\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"class SlidingWindow {\r\n  constructor(maxRequestPerSec, windowSizeInMs) {\r\n    this.windows = new Map();\r\n    this.maxRequestPerSec = maxRequestPerSec;\r\n    this.windowSizeInMs = windowSizeInMs;\r\n  }\r\n\r\n  allow() {\r\n    const now = Date.now();\r\n    const curWindowKey = Math.floor(now / this.windowSizeInMs);\r\n    if (!this.windows.has(curWindowKey)) {\r\n      this.windows.set(curWindowKey, new AtomicInteger(0));\r\n    }\r\n    const preWindowKey = curWindowKey - 1000;\r\n    const preCount = this.windows.get(preWindowKey);\r\n    if (preCount === undefined) {\r\n      return this.windows.get(curWindowKey).incrementAndGet() <= this.maxRequestPerSec;\r\n    }\r\n    const preWeight = 1 - (now - curWindowKey * this.windowSizeInMs) / 1000.0;\r\n    const count = Math.floor(preCount.get() * preWeight + this.windows.get(curWindowKey).incrementAndGet());\r\n    return count <= this.maxRequestPerSec;\r\n  }\r\n}\r\n\r\nclass AtomicInteger {\r\n  constructor(value) {\r\n    this.value = value || 0;\r\n  }\r\n\r\n  incrementAndGet() {\r\n    return ++this.value;\r\n  }\r\n\r\n  get() {\r\n    return this.value;\r\n  }\r\n}\n"})})]})}function a(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(w,{...n})}):w(n)}}}]);