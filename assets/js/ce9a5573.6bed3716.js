"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["178274"],{24167:function(e,r,n){n.r(r),n.d(r,{frontMatter:()=>i,toc:()=>p,default:()=>R,metadata:()=>s,assets:()=>a,contentTitle:()=>c});var s=JSON.parse('{"id":"nestjs/nest error handling","title":"nestjs error handling","description":"error.ts","source":"@site/docs/nestjs/nest error handling.md","sourceDirName":"nestjs","slug":"/nestjs/nest error handling","permalink":"/docs/nestjs/nest error handling","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest mailer nestmailer","permalink":"/docs/nestjs/nest email nestmailer"},"next":{"title":"nest eventEmitter","permalink":"/docs/nestjs/nest event-emitter"}}'),t=n(447259),o=n(255511);let i={},c="nestjs error handling",a={},p=[{value:"error.ts",id:"errorts",level:2},{value:"business-exception.ts",id:"business-exceptionts",level:2},{value:"BusinessException",id:"businessexception",level:2},{value:"\uC7A1\uC9C0 \uBABB\uD55C HttpException",id:"\uC7A1\uC9C0-\uBABB\uD55C-httpexception",level:2},{value:"ValidationException",id:"validationexception",level:2}];function l(e){let r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"nestjs-error-handling",children:"nestjs error handling"})}),"\n",(0,t.jsx)(r.h2,{id:"errorts",children:"error.ts"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'export type ERROR = {\r\n  code: string;\r\n  message: string;\r\n  data?: any;\r\n};\r\n\r\nexport namespace ERROR {\r\n  export const USER_NOT_FOUND: ERROR = {\r\n    code: "0100",\r\n    message: `\uC720\uC800\uB97C \uCC3E\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4.`,\r\n  };\r\n  export const USER_ALREADY_EXISTS: ERROR = {\r\n    code: "0101",\r\n    message: `\r\n\uC720\uC800\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD569\uB2C8\uB2E4.\r\n\uC544\uC774\uB514\uB97C \uB2E4\uC2DC \uD655\uC778\uD558\uACE0 \uAC00\uC785\uD558\uB824\uB294 \uC544\uC774\uB514\uAC00 \uC774\uBBF8 \uC874\uC7AC\uD558\uB294\uC9C0 \uD655\uC778\uD558\uC2ED\uC2DC\uC624.\r\n`,\r\n  };\r\n  export const USER_CREATE_FAILED: ERROR = {\r\n    code: "0102",\r\n    message: "\uC720\uC800 \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  };\r\n  export const USER_UPDATE_FAILED: ERROR = {\r\n    code: "0103",\r\n    message: "\uC720\uC800 \uC218\uC815\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  };\r\n  export const NOTICE_NOT_FOUND: ERROR = {\r\n    code: "0200",\r\n    message: "\uACF5\uC9C0\uC0AC\uD56D\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",\r\n  };\r\n  export const NOTICE_CREATE_FAILED: ERROR = {\r\n    code: "0201",\r\n    message: "\uACF5\uC9C0\uC0AC\uD56D \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  };\r\n  export const NOTICE_UPDATE_FAILED: ERROR = {\r\n    code: "0202",\r\n    message: "\uACF5\uC9C0\uC0AC\uD56D \uC218\uC815\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  };\r\n}\r\n\r\nexport const createError = (error: ERROR, data?: any): ERROR => ({\r\n  ...error,\r\n  data,\r\n});\n'})}),"\n",(0,t.jsx)(r.h2,{id:"business-exceptionts",children:"business-exception.ts"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { HttpException, HttpStatus } from "@nestjs/common";\r\nimport { createError, ERROR } from "./error";\r\n\r\nexport class BusinessException extends HttpException {\r\n  constructor(error: ERROR, status: HttpStatus, cause?: any) {\r\n    super(error, status, cause);\r\n  }\r\n}\r\n\r\nexport class UserNotFoundException extends BusinessException {\r\n  constructor(data?: any, cause?: any) {\r\n    const response = createError(ERROR.USER_NOT_FOUND, data);\r\n    super(response, HttpStatus.NOT_FOUND, cause);\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"businessexception",children:"BusinessException"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\uAE30\uBCF8\uC73C\uB85C \uBC1C\uC0DD\uD560 \uC218 \uC788\uB294 \uC5D0\uB7EC\uB4E4\uC740 catch\uD574\uC11C BusinessException\uC73C\uB85C \uBCF4\uB0B4\uC8FC\uAE30"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"BusinessException\uC740 ERROR \uAC1D\uCCB4\uB97C \uBCF4\uB0B8\uB2E4"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { ArgumentsHost, Catch, ExceptionFilter, Logger } from "@nestjs/common";\r\nimport { Prisma } from "@prisma/client";\r\nimport { Request, Response } from "express";\r\nimport { PrismaError } from "prisma-error-enum";\r\nimport { ERROR } from "../error";\r\nimport { BusinessException } from "../exception";\r\n\r\n@Catch(BusinessException)\r\nexport class BusinessExceptionFilter implements ExceptionFilter {\r\n  private readonly logger = new Logger(BusinessExceptionFilter.name);\r\n  catch(error: BusinessException, host: ArgumentsHost) {\r\n    const ctx = host.switchToHttp();\r\n    const res = ctx.getResponse<Response>();\r\n    const req = ctx.getRequest<Request>();\r\n    const errorStatusCode = error.getStatus();\r\n    const errorMessage = error.message;\r\n    const errorStack = error.stack;\r\n\r\n    const { code, message, cause } = error.getResponse() as ERROR;\r\n\r\n    const clientError = { code, message };\r\n\r\n    const clientErrorResponse = {\r\n      statusCode: errorStatusCode,\r\n      path: req.url,\r\n      timestamp: new Date().toISOString(),\r\n      message: errorMessage,\r\n      error: {\r\n        ...ERROR.BUSINESS_ERROR,\r\n        ...clientError,\r\n      },\r\n    };\r\n\r\n    if (cause instanceof Prisma.PrismaClientKnownRequestError) {\r\n      if (cause.code === PrismaError.UniqueConstraintViolation) {\r\n        clientErrorResponse.message = `\uC911\uBCF5\uB41C \uB370\uC774\uD130\uAC00 \uC874\uC7AC\uD569\uB2C8\uB2E4. [${cause.meta.target}]`;\r\n      }\r\n    }\r\n\r\n    res.status(errorStatusCode).json(clientErrorResponse);\r\n\r\n    this.logger.error(`\r\nMESSAGE: ${clientErrorResponse.message}\r\nTIMESTAMP: ${clientErrorResponse.timestamp}\r\nMETHOD: ${req.method}\r\nPATH: ${clientErrorResponse.path}\r\nERROR: ${JSON.stringify(clientErrorResponse.error)}\r\nERROR STACK: ${errorStack}\r\nCAUSE: ${JSON.stringify(cause)}\r\nCAUSE STACK: ${cause}\r\n`);\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"\uC7A1\uC9C0-\uBABB\uD55C-httpexception",children:"\uC7A1\uC9C0 \uBABB\uD55C HttpException"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"BusinessException\uC73C\uB85C \uC815\uC758\uB418\uC9C0 \uC54A\uC740 \uC5D0\uB7EC\uB4E4"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"response\uC5D0 ERROR \uAC1D\uCCB4\uAC00 \uC544\uB2CC string\uC774 \uB4E4\uC5B4\uC788\uB2E4."}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:'code: "-1"'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { ArgumentsHost, Catch, ExceptionFilter, HttpException, Logger } from "@nestjs/common";\r\nimport { Request, Response } from "express";\r\nimport { ERROR } from "../error";\r\n\r\n@Catch(HttpException)\r\nexport class HttpExceptionFilter implements ExceptionFilter {\r\n  private readonly logger = new Logger(HttpExceptionFilter.name);\r\n  catch(error: HttpException, host: ArgumentsHost) {\r\n    const ctx = host.switchToHttp();\r\n    const res = ctx.getResponse<Response>();\r\n    const req = ctx.getRequest<Request>();\r\n    const statusCode = error.getStatus();\r\n\r\n    const response = error.getResponse() as string;\r\n    const message = error.message;\r\n    const cause = error.cause;\r\n    const stack = error.stack;\r\n\r\n    const clientErrorResponse = {\r\n      statusCode,\r\n      message,\r\n      path: req.url,\r\n      timestamp: new Date().toISOString(),\r\n      error: {\r\n        ...ERROR.HTTP_ERROR,\r\n        message: response,\r\n      } as ERROR,\r\n    };\r\n\r\n    res.status(statusCode).json(clientErrorResponse);\r\n\r\n    this.logger.error(`\r\nMESSAGE: ${clientErrorResponse.message}\r\nTIMESTAMP: ${clientErrorResponse.timestamp}\r\nMETHOD: ${req.method}\r\nPATH: ${clientErrorResponse.path}\r\nERROR: ${JSON.stringify(clientErrorResponse.error)}\r\nSTACK: ${stack}\r\nCAUSE: ${cause}\r\n`);\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(r.h2,{id:"validationexception",children:"ValidationException"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\uC720\uD6A8\uC131 \uAC80\uC0AC\uC5D0\uC11C \uC2E4\uD328\uD55C \uC5D0\uB7EC"}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:'code: "-3"'}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:'import { ValidationException } from "@/server/pipes/global-validation.pipe";\r\nimport { ArgumentsHost, Catch, ExceptionFilter, Logger } from "@nestjs/common";\r\nimport { Request, Response } from "express";\r\nimport { ERROR } from "../error";\r\n\r\n@Catch(ValidationException)\r\nexport class ValidationExceptionFilter implements ExceptionFilter {\r\n  private readonly logger = new Logger(ValidationExceptionFilter.name);\r\n  catch(error: ValidationException, host: ArgumentsHost) {\r\n    const ctx = host.switchToHttp();\r\n    const res = ctx.getResponse<Response>();\r\n    const req = ctx.getRequest<Request>();\r\n    const statusCode = error.getStatus();\r\n    const response = error.getResponse() as ERROR;\r\n    const message = error.message;\r\n    const cause = error.cause;\r\n    const stack = error.stack;\r\n\r\n    const clientErrorResponse = {\r\n      statusCode,\r\n      message,\r\n      path: req.url,\r\n      timestamp: new Date().toISOString(),\r\n      error: response,\r\n    };\r\n\r\n    res.status(statusCode).json(clientErrorResponse);\r\n\r\n    this.logger.error(`\r\nMESSAGE: ${clientErrorResponse.message}\r\nTIMESTAMP: ${clientErrorResponse.timestamp}\r\nMETHOD: ${req.method}\r\nPATH: ${clientErrorResponse.path}\r\nERROR: ${JSON.stringify(clientErrorResponse.error)}\r\nSTACK: ${stack}\r\nCAUSE: ${cause}\r\n`);\r\n  }\r\n}\n'})})]})}function R(e={}){let{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},255511:function(e,r,n){n.d(r,{R:()=>i,x:()=>c});var s=n(596363);let t={},o=s.createContext(t);function i(e){let r=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);