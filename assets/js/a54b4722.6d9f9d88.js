"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["727769"],{107248:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>o,toc:()=>c,default:()=>u,metadata:()=>s,assets:()=>i,contentTitle:()=>l});var s=JSON.parse('{"id":"nestjs/nest google analytics Data API","title":"nestjs google analytics Data API","description":"document","source":"@site/docs/nestjs/nest google analytics Data API.md","sourceDirName":"nestjs","slug":"/nestjs/nest google analytics Data API","permalink":"/docs/nestjs/nest google analytics Data API","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest file upload","permalink":"/docs/nestjs/nest file upload"},"next":{"title":"nest graceful shutdown forceCloseConnection","permalink":"/docs/nestjs/nest graceful shutdown forceCloseConnection"}}'),r=t(447259),a=t(255511);let o={},l="nestjs google analytics Data API",i={},c=[{value:"install",id:"install",level:2},{value:"main.js",id:"mainjs",level:2},{value:"service",id:"service",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"nestjs-google-analytics-data-api",children:"nestjs google analytics Data API"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://developers.google.com/analytics/devguides/reporting/data/v1/rest/v1beta/properties/runReport?hl=ko",children:"document"})}),"\n",(0,r.jsx)(n.h2,{id:"install",children:"install"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"npm install @google-analytics/data\n"})}),"\n",(0,r.jsx)(n.h2,{id:"mainjs",children:"main.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'process.env.GOOGLE_APPLICATION_CREDENTIALS = join(__dirname, "assets", "ga.json");\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create<NestExpressApplication>(AppModule);\r\n\r\n  /** Static Assets */\r\n  app.useStaticAssets(join(__dirname, "assets"));\r\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"service",children:"service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'import { BetaAnalyticsDataClient } from "@google-analytics/data";\r\nimport { Injectable, NotFoundException } from "@nestjs/common";\r\nimport { GoogleAnalyticsDTO } from "./google-analytics.dto";\r\nconst propertyId = process.env.GA_PROPERTY_ID;\r\n\r\n@Injectable()\r\nexport class GoogleAnalyticsService {\r\n  client = new BetaAnalyticsDataClient();\r\n  async getReport() {\r\n    const [res] = await this.client.runReport(\r\n      {\r\n        property: `properties/${propertyId}`,\r\n        dateRanges: [\r\n          {\r\n            startDate: "2024-05-01",\r\n            endDate: "today",\r\n          },\r\n        ],\r\n        dimensions: [\r\n          {\r\n            name: "date", // \uB0A0\uC9DC\r\n          },\r\n        ],\r\n        metrics: [\r\n          {\r\n            name: "totalUsers", // \uC804\uCCB4 \uC0AC\uC6A9\uC790 \uC218\r\n          },\r\n          {\r\n            name: "newUsers", // \uC2E0\uADDC \uC0AC\uC6A9\uC790 \uC218\r\n          },\r\n          { name: "screenPageViews" }, // \uD398\uC774\uC9C0 \uC870\uD68C \uC218\r\n        ],\r\n      },\r\n      {}\r\n    );\r\n\r\n    if (!res.rows) {\r\n      throw new NotFoundException("Google Analytics data\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");\r\n    }\r\n\r\n    const dimensionValues = res.rows[0]?.dimensionValues;\r\n    // [ { value: \'20240508\', oneValue: \'value\' } ] // date\r\n\r\n    const metricValues = res.rows[0]?.metricValues;\r\n    // [\r\n    //   { value: \'3\', oneValue: \'value\' }, // totalUsers\r\n    //   { value: \'2\', oneValue: \'value\' }, // newUsers\r\n    //   { value: \'24\', oneValue: \'value\' } // screenPageViews\r\n    // ]\r\n\r\n    const totalUsers = metricValues?.[0]?.value || 0;\r\n    const newUsers = metricValues?.[1]?.value || 0;\r\n    const screenPageViews = metricValues?.[2]?.value || 0;\r\n\r\n    return {\r\n      totalUsers,\r\n      newUsers,\r\n      screenPageViews,\r\n    } as GoogleAnalyticsDTO;\r\n  }\r\n}\n'})})]})}function u(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},255511:function(e,n,t){t.d(n,{R:()=>o,x:()=>l});var s=t(596363);let r={},a=s.createContext(r);function o(e){let n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);