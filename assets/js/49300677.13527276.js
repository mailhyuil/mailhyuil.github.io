"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[737195],{211564:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>u,contentTitle:()=>a,default:()=>i,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"nestjs/nest advanced message queue bullMQ concurrency","title":"nest advanced message queue","description":"concurrency: \ub3d9\uc2dc\uc5d0 \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 job\uc758 \uac1c\uc218 (\ub3d9\uc2dc\ucc98\ub9ac)","source":"@site/docs/nestjs/nest advanced message queue bullMQ concurrency.md","sourceDirName":"nestjs","slug":"/nestjs/nest advanced message queue bullMQ concurrency","permalink":"/docs/nestjs/nest advanced message queue bullMQ concurrency","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest bullMQ Queue & Worker","permalink":"/docs/nestjs/nest advanced message queue bullMQ Queue & Worker"},"next":{"title":"nest advanced message queue","permalink":"/docs/nestjs/nest advanced message queue bullMQ"}}');var t=r(447259),o=r(529087);const c={},a="nest advanced message queue",u={},l=[{value:"batch.controller.ts",id:"batchcontrollerts",level:2},{value:"batch.processor.ts",id:"batchprocessorts",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"nest-advanced-message-queue",children:"nest advanced message queue"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"concurrency: \ub3d9\uc2dc\uc5d0 \ucc98\ub9ac\ud560 \uc218 \uc788\ub294 job\uc758 \uac1c\uc218 (\ub3d9\uc2dc\ucc98\ub9ac)"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"concurrency\uac00 1\uc774\uba74 transcode job\uc740 \ud55c\ubc88\uc5d0 \ud558\ub098\ub9cc \ucc98\ub9ac\ud55c\ub2e4."}),"\n",(0,t.jsx)(n.p,{children:"concurrency\uac00 n\uac1c\uc77c \uacbd\uc6b0 n\uac1c\uc758 job\uc744 \ub3d9\uc2dc\uc5d0 \ucc98\ub9ac\ud55c\ub2e4. (io bound \uc791\uc5c5\uc5d0\uc11c \uc720\uc6a9)"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\ubcd1\ub82c\ucc98\ub9ac\ub97c \ud558\uae30 \uc704\ud574\uc11c\ub294 worker_threads\ub97c \uc0ac\uc6a9\ud558\uac70\ub098 cluster\ub97c \ud1b5\ud574\uc11c \uc571\uc744 \uc5ec\ub7ec\uac1c \ub744\uc6cc\uc57c \ud55c\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"batchcontrollerts",children:"batch.controller.ts"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"multi worker\ub85c \ube60\ub974\uac8c \ucc98\ub9ac\ud558\uace0 \uc2f6\ub2e4\uba74 data\ub97c \ub098\ub220\uc11c \uc5ec\ub7ec\uac1c\uc758 add\ub97c \uc0ac\uc6a9 process\uc758 concurrency\ub3c4 \ub192\uc5ec\uc57c \ud55c\ub2e4."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { InjectQueue } from "@nestjs/bull";\r\nimport { Controller, Post } from "@nestjs/common";\r\nimport { Queue } from "bull";\r\n\r\n@Controller("batch")\r\nexport class BatchController {\r\n  constructor(@InjectQueue("batch") private readonly batchQueue: Queue) {}\r\n\r\n  @Post("process")\r\n  async process() {\r\n    await this.batchQueue.add({ data: 1000 });\r\n    await this.batchQueue.add({ data: 1000 });\r\n    await this.batchQueue.add({ data: 1000 });\r\n    /// 3\uac1c\uc758 job\uc744 \ud050\uc5d0 \ucd94\uac00\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"batchprocessorts",children:"batch.processor.ts"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'import { Process, Processor } from "@nestjs/bull";\r\nimport { Logger } from "@nestjs/common";\r\nimport { Job } from "bull";\r\nimport CPU_CORES from "CPU_CORES";\r\n\r\n@Processor("batch")\r\nexport class BatchProcessor {\r\n  private readonly logger = new Logger(BatchProcessor.name);\r\n  @Process({\r\n    concurrency: 2, // \ub3d9\uc2dc\uc5d0 2\uac1c\uc758 job\uc744 \ud050\uc5d0\uc11c \uac00\uc838\uc640\uc11c \ucc98\ub9ac\ud560 \uc218 \uc788\ub2e4. (\ubcd1\ub82c\ucc98\ub9ac\uac00 \uc544\ub2c8\ub2e4!)\r\n  })\r\n  process(job: Job) {\r\n    const data = job.data;\r\n    this.logger.debug("start processing...");\r\n    this.logger.debug(data);\r\n    this.logger.debug("processing completed");\r\n  }\r\n}\n'})})]})}function i(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},529087:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>a});var s=r(596363);const t={},o=s.createContext(t);function c(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);