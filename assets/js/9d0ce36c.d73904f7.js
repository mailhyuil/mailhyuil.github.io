"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["596279"],{232779:function(n,e,r){r.r(e),r.d(e,{frontMatter:()=>s,toc:()=>c,default:()=>a,metadata:()=>i,assets:()=>l,contentTitle:()=>d});var i=JSON.parse('{"id":"x algorithm/algorithm \uD22C\uD3EC\uC778\uD130 Window","title":"Window","description":"Fixed Window Counter","source":"@site/docs/x algorithm/algorithm \uD22C\uD3EC\uC778\uD130 Window.md","sourceDirName":"x algorithm","slug":"/x algorithm/algorithm \uD22C\uD3EC\uC778\uD130 Window","permalink":"/docs/x algorithm/algorithm \uD22C\uD3EC\uC778\uD130 Window","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\uC9C0\uC5F0\uD3C9\uAC00","permalink":"/docs/x algorithm/algorithm \uC9C0\uC5F0\uD3C9\uAC00"},"next":{"title":"\uD22C \uD3EC\uC778\uD130","permalink":"/docs/x algorithm/algorithm \uD22C\uD3EC\uC778\uD130"}}'),t=r(447259),o=r(255511);let s={},d="Window",l={},c=[{value:"Fixed Window Counter",id:"fixed-window-counter",level:2},{value:"Sliding Window Log",id:"sliding-window-log",level:2},{value:"Sliding Window Counter",id:"sliding-window-counter",level:2}];function w(n){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"window",children:"Window"})}),"\n",(0,t.jsx)(e.h2,{id:"fixed-window-counter",children:"Fixed Window Counter"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"express-rate-limit"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'class FixedWindowCounter {\r\n  constructor(maxRequestPerSec, windowSizeInMs) {\r\n    this.windows = new Map();\r\n    this.maxRequestPerSec = maxRequestPerSec;\r\n    this.windowSizeInMs = windowSizeInMs;\r\n  }\r\n\r\n  allow() {\r\n    const windowKey = Math.floor(Date.now() / this.windowSizeInMs);\r\n    if (!this.windows.has(windowKey)) {\r\n      this.windows.set(windowKey, new AtomicInteger(0));\r\n    }\r\n    return this.windows.get(windowKey).incrementAndGet() <= this.maxRequestPerSec;\r\n  }\r\n\r\n  toString() {\r\n    let sb = "";\r\n    for (const [windowKey, atomicInteger] of this.windows.entries()) {\r\n      sb += windowKey + " --\x3e " + atomicInteger + "\\n";\r\n    }\r\n    return sb;\r\n  }\r\n}\r\n\r\nclass AtomicInteger {\r\n  constructor(value) {\r\n    this.value = value || 0;\r\n  }\r\n\r\n  incrementAndGet() {\r\n    return ++this.value;\r\n  }\r\n\r\n  toString() {\r\n    return this.value.toString();\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"sliding-window-log",children:"Sliding Window Log"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"[1,[2,3,4],5,6] // [2,3,4] \uAC00 \uC708\uB3C4\uC6B0"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"1\uCD08\uB9C8\uB2E4 \uC708\uB3C4\uC6B0\uB97C \uC774\uB3D9\uC2DC\uD0A4\uBA74\uC11C \uC708\uB3C4\uC6B0\uC5D0 \uD3EC\uD568\uB41C \uC694\uC18C\uC758 \uAC1C\uC218\uB97C \uC138\uB294 \uBC29\uC2DD"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\uD22C\uD3EC\uC778\uD130 \uC0AC\uC6A9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"class SlidingWindowLog {\r\n  constructor(maxRequestPerSec) {\r\n    this.windowLog = [];\r\n    this.maxRequestPerSec = maxRequestPerSec;\r\n  }\r\n\r\n  allow() {\r\n    const now = Date.now();\r\n    const boundary = now - 1000;\r\n    while (this.windowLog.length > 0 && this.windowLog[0] <= boundary) {\r\n      this.windowLog.shift();\r\n    }\r\n    this.windowLog.push(now);\r\n    console.log(`current time=${now}, log size=${this.windowLog.length}`);\r\n    return this.windowLog.length <= this.maxRequestPerSec;\r\n  }\r\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"sliding-window-counter",children:"Sliding Window Counter"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"function slidingWindow(n, arr) {\r\n  let res = 0;\r\n  let sum = 0;\r\n\r\n  // \uC55E\uC758 n\uAC1C \uB354\uD558\uAE30\r\n  for (let i = 0; i < n; i++) {\r\n    sum += arr[i];\r\n  }\r\n\r\n  res = sum;\r\n\r\n  // \uC2AC\uB77C\uC774\uB529 \uC708\uB3C4\r\n  for (let i = n; i < arr.length; i++) {\r\n    sum += arr[i] - arr[i - n];\r\n    res = Math.max(res, sum);\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nconsole.log(slidingWindow(2, [7, 6, 5, 4, 3, 2, 1]));\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"class SlidingWindow {\r\n  constructor(maxRequestPerSec, windowSizeInMs) {\r\n    this.windows = new Map();\r\n    this.maxRequestPerSec = maxRequestPerSec;\r\n    this.windowSizeInMs = windowSizeInMs;\r\n  }\r\n\r\n  allow() {\r\n    const now = Date.now();\r\n    const curWindowKey = Math.floor(now / this.windowSizeInMs);\r\n    if (!this.windows.has(curWindowKey)) {\r\n      this.windows.set(curWindowKey, new AtomicInteger(0));\r\n    }\r\n    const preWindowKey = curWindowKey - 1000;\r\n    const preCount = this.windows.get(preWindowKey);\r\n    if (preCount === undefined) {\r\n      return this.windows.get(curWindowKey).incrementAndGet() <= this.maxRequestPerSec;\r\n    }\r\n    const preWeight = 1 - (now - curWindowKey * this.windowSizeInMs) / 1000.0;\r\n    const count = Math.floor(preCount.get() * preWeight + this.windows.get(curWindowKey).incrementAndGet());\r\n    return count <= this.maxRequestPerSec;\r\n  }\r\n}\r\n\r\nclass AtomicInteger {\r\n  constructor(value) {\r\n    this.value = value || 0;\r\n  }\r\n\r\n  incrementAndGet() {\r\n    return ++this.value;\r\n  }\r\n\r\n  get() {\r\n    return this.value;\r\n  }\r\n}\n"})})]})}function a(n={}){let{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(w,{...n})}):w(n)}},255511:function(n,e,r){r.d(e,{R:()=>s,x:()=>d});var i=r(596363);let t={},o=i.createContext(t);function s(n){let e=i.useContext(o);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),i.createElement(o.Provider,{value:e},n.children)}}}]);