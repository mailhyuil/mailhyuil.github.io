"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[806473],{118253:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>a,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"nginx/nginx \uc138\ud305","title":"nginx","description":"install","source":"@site/docs/nginx/nginx \uc138\ud305.md","sourceDirName":"nginx","slug":"/nginx/nginx \uc138\ud305","permalink":"/docs/nginx/nginx \uc138\ud305","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nginx \ubcc0\uc218","permalink":"/docs/nginx/nginx \ubcc0\uc218"},"next":{"title":"nginx config \uc704\uce58","permalink":"/docs/nginx/nginx \ud30c\uc77c \uc704\uce58 file path"}}');var t=e(447259),o=e(529087);const l={},s="nginx",a={},c=[{value:"install",id:"install",level:2},{value:"\uc2dc\uc2a4\ud15c \ud655\uc778",id:"\uc2dc\uc2a4\ud15c-\ud655\uc778",level:2},{value:"default.conf",id:"defaultconf",level:2}];function p(n){const r={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,o.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"nginx",children:"nginx"})}),"\n",(0,t.jsx)(r.h2,{id:"install",children:"install"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh",children:"docker run --name nginx -d -p 80:80 -v $(pwd)/nginx:/etc/nginx nginx\r\n\r\n# module \ud655\uc778\r\nnginx -V 2>&1 | grep brotli\r\nnginx -V 2>&1 | grep --with-http_v2_module\r\nnginx -V 2>&1 | grep --with-http_v3_module\r\n...\n"})}),"\n",(0,t.jsx)(r.h2,{id:"\uc2dc\uc2a4\ud15c-\ud655\uc778",children:"\uc2dc\uc2a4\ud15c \ud655\uc778"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh",children:"# core \uc218 \ud655\uc778\r\nnproc\r\n# or\r\ngrep -c ^processor /proc/cpuinfo\r\n\r\n# worker_processes \uc124\uc815\r\nworker_processes auto;  # CPU \ucf54\uc5b4 \uac1c\uc218\ub9cc\ud07c \uc790\ub3d9 \uc124\uc815\r\nworker_processes 4;  # 4\uac1c\uc758 worker process \uc0dd\uc131\r\n# \uc11c\ubc84\uc5d0 \ub744\uc6b4 \ud504\ub85c\uc138\uc2a4\uc758 \uc218\uc5d0 \ub9de\ucdb0\uc11c \uc870\uc808\r\n# (e.g. nestjs 1, postgres 1 \uac00 \ud55c \uc11c\ubc84\uc5d0 \uc788\ub2e4\uba74 2\ub85c \uc124\uc815)\n"})}),"\n",(0,t.jsx)(r.h2,{id:"defaultconf",children:"default.conf"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-conf",children:'client_max_body_size 500M;\r\n\r\n# gzip\r\ngzip on;\r\ngzip_disable "MSIE [1-6]\\.(?!.*SV1)";  # IE6 \uc774\ud558 \ube44\ud65c\uc131\ud654\r\ngzip_vary on;  # \uce90\uc2f1 \ucd5c\uc801\ud654 (Vary: Accept-Encoding)\r\ngzip_comp_level 5;  # \uc555\ucd95\ub960\uacfc \uc18d\ub3c4\uc758 \uade0\ud615\r\ngzip_proxied expired no-cache no-store private auth;  # \ud504\ub85d\uc2dc \uc694\uccad \uc870\uac74\ubd80 \ud5c8\uc6a9\r\ngzip_types text/plain text/css text/javascript application/javascript application/json application/xml application/xml+rss image/svg+xml;\r\n\r\n# brotli\r\n# brotli_static on;\r\n\r\n# rate limiting: \ucd08\ub2f9 10\uac1c\uc758 \uc694\uccad\ub9cc \ud5c8\uc6a9\r\nlimit_req_zone $binary_remote_addr zone=req_limit_per_ip:10m rate=10r/s;\r\n# slow rate limiting: \ucd08\ub2f9 5\uac1c\uc758 \uc694\uccad\ub9cc \ud5c8\uc6a9\r\nlimit_req_zone $binary_remote_addr zone=req_limit_api_slow:10m rate=5r/s;\r\n\r\nserver {\r\n    server_name example.com;\r\n\r\n    listen 80;\r\n    listen [::]:80;\r\n\r\n    location /.well-known/acme-challenge/ {\r\n        allow all;\r\n        root /var/www/certbot;\r\n    }\r\n\r\n    return 301 https://$host$request_uri;\r\n}\r\n\r\nserver {\r\n    server_name example.com;\r\n    # http2 \ud65c\uc131\ud654\r\n    http2 on;\r\n    listen 443 ssl;\r\n\r\n    # http3 \ud65c\uc131\ud654\r\n    http3 on; # http3 \uc9c0\uc6d0\uc744 \ud65c\uc131\ud654\r\n    listen 443 quic reuseport;  # UDP listener for QUIC+HTTP/3\r\n    quic_gso on; # GSO\ub97c \ud65c\uc131\ud654\ud569\ub2c8\ub2e4\r\n    quic_retry on; # \uc8fc\uc18c \ud655\uc778 \ud5c8\uc6a9\r\n    # QUIC\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ube0c\ub77c\uc6b0\uc800\uc5d0 \uc54c\ub9bc (\uc791\ub3d9\ud558\uc9c0 \uc54a\uc73c\uba74 http \ube14\ub85d\uc774\ub098 location \ube14\ub85d\uc5d0 \ucd94\uac00)\r\n    add_header Alt-Svc \'h3=":443"; ma=86400\';\r\n\r\n    ssl_protocols TLSv1.2 TLSv1.3;\r\n    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;\r\n    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;\r\n\r\n    # (optional) enable OCSP stapling\r\n    ssl_trusted_certificate /etc/letsencrypt/live/example.com/chain.pem;\r\n    ssl_stapling on;\r\n    ssl_stapling_verify on;\r\n    resolver 8.8.8.8 1.1.1.1; # \ub124\uc784\uc11c\ubc84\uc758 \uc8fc\uc18c (\ud638\uc2a4\ud305 \uc5c5\uccb4\uc758)\r\n\r\n    location = / {\r\n        try_files \'\' @ssr;\r\n    }\r\n\r\n    location / {\r\n        # rate limiting\r\n        limit_req zone=req_limit_per_ip burst=20 nodelay;\r\n\r\n        root /app/client/browser;\r\n        index index.html index.htm;\r\n        try_files $uri $uri/ @ssr;\r\n    }\r\n\r\n    location /admin {\r\n        # rate limiting\r\n        limit_req zone=req_limit_per_ip burst=20 nodelay;\r\n\r\n        alias /app/admin;\r\n        index index.html index.htm;\r\n        try_files $uri $uri/ /admin/index.html =404;\r\n    }\r\n\r\n    location /api/v1/ {\r\n        # slow rate limiting\r\n        limit_req zone=req_limit_api_slow burst=10 nodelay;\r\n\r\n        proxy_pass http://server:3000;\r\n    }\r\n\r\n    location /api/v1/sse/ {\r\n        proxy_set_header  X-Forwarded-For $remote_addr;\r\n\r\n        proxy_set_header Connection "";\r\n        proxy_http_version 1.1;\r\n        chunked_transfer_encoding off;\r\n\r\n        proxy_buffering off;\r\n        proxy_cache off;\r\n        proxy_pass http://server:3000;\r\n    }\r\n\r\n    location @ssr {\r\n        internal;\r\n        proxy_pass http://localhost:4000;\r\n        error_page 500 502 503 504 = @fallback;\r\n    }\r\n\r\n    location @fallback {\r\n        internal;\r\n        index index.csr.html index.html;\r\n        try_files $uri $uri/ /index.csr.html =404;\r\n    }\r\n}\n'})})]})}function d(n={}){const{wrapper:r}={...(0,o.R)(),...n.components};return r?(0,t.jsx)(r,{...n,children:(0,t.jsx)(p,{...n})}):p(n)}},529087:(n,r,e)=>{e.d(r,{R:()=>l,x:()=>s});var i=e(596363);const t={},o=i.createContext(t);function l(n){const r=i.useContext(o);return i.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function s(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),i.createElement(o.Provider,{value:r},n.children)}}}]);