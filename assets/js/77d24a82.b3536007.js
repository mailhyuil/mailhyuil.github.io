"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[522456],{526825:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>d,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"javascript/js deadlock - \uad50\ucc29\uc0c1\ud0dc","title":"js deadlock","description":"\ub450\uac1c \uc774\uc0c1\uc758 \uacf5\uc720\uc790\uc6d0\uc774 \uc788\uc744 \ub54c \ub450\uac1c \uc774\uc0c1\uc758 task\uac00 \uac01 \uc790\uc6d0\uc744 \uc120\uc810\ud558\uace0 \uc11c\ub85c\uc758 \uacf5\uc720\uc790\uc6d0\uc744 \uc0ac\uc6a9\ud558\ub824\uace0 \ub04a\uc784\uc5c6\uc774 \uae30\ub2e4\ub9ac\ub294 \uc0c1\ud0dc","source":"@site/docs/javascript/js deadlock - \uad50\ucc29\uc0c1\ud0dc.md","sourceDirName":"javascript","slug":"/javascript/js deadlock - \uad50\ucc29\uc0c1\ud0dc","permalink":"/docs/javascript/js deadlock - \uad50\ucc29\uc0c1\ud0dc","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"js currying","permalink":"/docs/javascript/js currying"},"next":{"title":"decorator stage 3","permalink":"/docs/javascript/js decorator stage 3"}}');var s=r(447259),o=r(529087);const c={},a="js deadlock",i={},l=[];function u(e){const n={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"js-deadlock",children:"js deadlock"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\ub450\uac1c \uc774\uc0c1\uc758 \uacf5\uc720\uc790\uc6d0\uc774 \uc788\uc744 \ub54c \ub450\uac1c \uc774\uc0c1\uc758 task\uac00 \uac01 \uc790\uc6d0\uc744 \uc120\uc810\ud558\uace0 \uc11c\ub85c\uc758 \uacf5\uc720\uc790\uc6d0\uc744 \uc0ac\uc6a9\ud558\ub824\uace0 \ub04a\uc784\uc5c6\uc774 \uae30\ub2e4\ub9ac\ub294 \uc0c1\ud0dc"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'function makeFuture() {\r\n  let resolve;\r\n  let reject;\r\n  let promise = new Promise((d, e) => {\r\n    resolve = d;\r\n    reject = e;\r\n  });\r\n  return [promise, resolve, reject];\r\n}\r\n\r\nclass Lock {\r\n  constructor() {\r\n    this.q = [];\r\n    this.running = false;\r\n  }\r\n  async runQueue() {\r\n    if (this.running) return;\r\n    this.running = true;\r\n    while (this.q.length > 0) {\r\n      const { asyncFunction, resolve, reject } = this.q.shift();\r\n      try {\r\n        let result = await asyncFunction();\r\n        resolve(await asyncFunction());\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    }\r\n    this.running = false;\r\n  }\r\n  runTask(asyncFunction) {\r\n    const [promise, resolve, reject] = makeFuture();\r\n    this.q.push({ asyncFunction, resolve, reject });\r\n    this.runQueue();\r\n    return promise;\r\n  }\r\n}\r\n\r\nconst dbLock = new Lock();\r\n\r\nlet taskResultPromise = dbLock.runTask(async () => {\r\n  console.log("about to deadlock");\r\n  let value = await dbLock.runTask(async () => {\r\n    return "value";\r\n  });\r\n  value; //?\r\n  console.log("did not deadlock");\r\n  return value;\r\n});\n'})})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},529087:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>a});var t=r(596363);const s={},o=t.createContext(s);function c(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);