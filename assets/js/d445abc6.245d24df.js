"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["851257"],{314690:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>s,toc:()=>i,default:()=>d,metadata:()=>t,assets:()=>l,contentTitle:()=>a});var t=JSON.parse('{"id":"db-prisma/prisma lock \uBE44\uAD00\uC801 \uB77D row lock exclusive lock","title":"prisma lock exclusive lock","description":"prisma\uB294 \uC544\uC9C1 lock\uC744 \uC9C0\uC6D0\uD558\uC9C0 \uC54A\uAE30 \uB54C\uBB38\uC5D0 $queryRaw\uB97C \uC0AC\uC6A9\uD574\uC57C \uD55C\uB2E4.","source":"@site/docs/db-prisma/prisma lock \uBE44\uAD00\uC801 \uB77D row lock exclusive lock.md","sourceDirName":"db-prisma","slug":"/db-prisma/prisma lock \uBE44\uAD00\uC801 \uB77D row lock exclusive lock","permalink":"/docs/db-prisma/prisma lock \uBE44\uAD00\uC801 \uB77D row lock exclusive lock","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"prisma optimistic lock (\uB099\uAD00\uC801 \uB77D)","permalink":"/docs/db-prisma/prisma lock \uB099\uAD00\uC801 \uB77D"},"next":{"title":"prisma lock share lock","permalink":"/docs/db-prisma/prisma lock \uBE44\uAD00\uC801 \uB77D row lock share lock"}}'),o=r(447259),c=r(255511);let s={},a="prisma lock exclusive lock",l={},i=[];function p(e){let n={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"prisma-lock-exclusive-lock",children:"prisma lock exclusive lock"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"prisma\uB294 \uC544\uC9C1 lock\uC744 \uC9C0\uC6D0\uD558\uC9C0 \uC54A\uAE30 \uB54C\uBB38\uC5D0 $queryRaw\uB97C \uC0AC\uC6A9\uD574\uC57C \uD55C\uB2E4."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"SELECT * FROM table_name FOR UPDATE;"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"\uC77D\uAE30\uC640 \uC4F0\uAE30 \uBAA8\uB450 \uBD88\uAC00\uB2A5\uD558\uB2E4."}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"FOR SHARE \uCC28\uB2E8"}),"\n",(0,o.jsx)(n.p,{children:"FOR UPDATE \uCC28\uB2E8"}),"\n",(0,o.jsx)(n.p,{children:"UPDATE, DELETE \uCC28\uB2E8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const paymentId = 1;\r\n\r\nawait prisma.$transaction(async (tx) => {\r\n  const payment = await tx.$queryRaw<RawPayment[]>`SELECT amount FROM payments WHERE id = ${paymentId} FOR UPDATE`;\r\n  // \uC774 \uC791\uC5C5\uC774 \uB05D\uB098\uAE30 \uC804\uAE4C\uC9C0 \uB2E4\uB978 \uD2B8\uB79C\uC7AD\uC158\uC5D0\uC11C\uB294 \uD574\uB2F9 payment\uB97C \uC77D\uAC70\uB098 \uC218\uC815\uD560 \uC218 \uC5C6\uB2E4.\r\n  const updated = await tx.payment.update({\r\n    where: { id: paymentId },\r\n    data: { amount: payment.amount + 100 },\r\n  });\r\n  return updated;\r\n});\n"})})]})}function d(e={}){let{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},255511:function(e,n,r){r.d(n,{R:()=>s,x:()=>a});var t=r(596363);let o={},c=t.createContext(o);function s(e){let n=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);