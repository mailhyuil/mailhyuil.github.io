"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[686712],{529087:(n,e,r)=>{r.d(e,{R:()=>a,x:()=>d});var o=r(596363);const t={},s=o.createContext(t);function a(n){const e=o.useContext(s);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),o.createElement(s.Provider,{value:e},n.children)}},831725:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>i,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"nestjs/nest advanced cqrs command","title":"nest CQRS Command","description":"\uc77c\ubc18 \ucee4\ub9e8\ub4dc \ud328\ud134\uc774 \uc544\ub2cc \ucee4\ub9e8\ub4dc \ubc84\uc2a4 \ud328\ud134","source":"@site/docs/nestjs/nest advanced cqrs command.md","sourceDirName":"nestjs","slug":"/nestjs/nest advanced cqrs command","permalink":"/docs/nestjs/nest advanced cqrs command","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest cqrs AggregateRoot","permalink":"/docs/nestjs/nest advanced cqrs AggregateRoot"},"next":{"title":"nest CQRS Event","permalink":"/docs/nestjs/nest advanced cqrs event"}}');var t=r(447259),s=r(529087);const a={},d="nest CQRS Command",l={},c=[{value:"Command",id:"command",level:2},{value:"Command handler",id:"command-handler",level:2},{value:"controller",id:"controller",level:2}];function m(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"nest-cqrs-command",children:"nest CQRS Command"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\uc77c\ubc18 \ucee4\ub9e8\ub4dc \ud328\ud134\uc774 \uc544\ub2cc \ucee4\ub9e8\ub4dc \ubc84\uc2a4 \ud328\ud134"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Command\ub294 DTO \uc5ed\ud560\uc744 \uc218\ud589\ud558\uace0 Handler\ub294 Command\ub97c \ucc98\ub9ac\ud558\ub294 \uc5ed\ud560\uc744 \uc218\ud589\ud55c\ub2e4."}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Write Transaction\uc758 Trigger \uc5ed\ud560\uc744 \uc218\ud589\ud55c\ub2e4."}),"\n",(0,t.jsx)(e.p,{children:"\ud558\ub098\uc758 Command\ub85c \ub05d\ub0a0 \uc218\ub3c4 \uc788\uace0, Saga\ub97c \ud1b5\ud574 \uc5ec\ub7ec Command\ub97c \ucc98\ub9ac\ud560 \uc218\ub3c4 \uc788\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"command",children:"Command"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:"export class KillDragonCommand {\r\n  constructor(public readonly heroId: string, public readonly dragonId: string) {}\r\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"command-handler",children:"Command handler"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'import { CommandHandler, EventPublisher, ICommandHandler } from "@nestjs/cqrs";\r\nimport { HeroRepository } from "../../repository/hero.repository";\r\nimport { KillDragonCommand } from "../impl/kill-dragon.command";\r\n\r\n@CommandHandler(KillDragonCommand)\r\nexport class KillDragonHandler implements ICommandHandler<KillDragonCommand> {\r\n  constructor(private readonly repository: HeroRepository, private readonly publisher: EventPublisher) {}\r\n\r\n  async execute(command: KillDragonCommand) {\r\n    const { heroId, dragonId } = command;\r\n    const hero = this.publisher.mergeObjectContext(await this.repository.findOneById(+heroId));\r\n    hero.killEnemy(dragonId);\r\n    hero.commit();\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"controller",children:"controller"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'import { CommandBus } from "@nestjs/cqrs";\r\n\r\n@Controller("hero")\r\nexport class HeroesGameController {\r\n  constructor(private readonly commandBus: CommandBus) {}\r\n\r\n  @Post(":id/kill")\r\n  async killDragon(@Param("id") id: string, @Body() dto: KillDragonDto) {\r\n    return this.commandBus.execute(new KillDragonCommand(id, dto.dragonId));\r\n  }\r\n}\n'})})]})}function i(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(m,{...n})}):m(n)}}}]);