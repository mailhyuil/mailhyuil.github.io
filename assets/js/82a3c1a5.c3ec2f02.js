"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[671459],{529087:(r,e,n)=>{n.d(e,{R:()=>a,x:()=>d});var o=n(596363);const t={},s=o.createContext(t);function a(r){const e=o.useContext(s);return o.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function d(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(t):r.components||t:a(r.components),o.createElement(s.Provider,{value:e},r.children)}},565358:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>i,contentTitle:()=>d,default:()=>m,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"nodejs/commander ts-morph","title":"commander ts-morph","description":"commander ts-morph","source":"@site/docs/nodejs/commander ts-morph.md","sourceDirName":"nodejs","slug":"/nodejs/commander ts-morph","permalink":"/docs/nodejs/commander ts-morph","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"commander Dir + File \uc0dd\uc131","permalink":"/docs/nodejs/commander Dir + File \uc0dd\uc131"},"next":{"title":"commander","permalink":"/docs/nodejs/commander"}}');var t=n(447259),s=n(529087);const a={},d=void 0,i={},c=[{value:"commander ts-morph",id:"commander-ts-morph",level:2},{value:"install",id:"install",level:2},{value:"usage",id:"usage",level:2}];function l(r){const e={code:"code",h2:"h2",pre:"pre",...(0,s.R)(),...r.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"commander-ts-morph",children:"commander ts-morph"}),"\n",(0,t.jsx)(e.h2,{id:"install",children:"install"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sh",children:"npm i -D commander\r\nnpm i -D ts-morph\n"})}),"\n",(0,t.jsx)(e.h2,{id:"usage",children:"usage"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-ts",children:'const { execSync } = require("child_process");\r\nconst fs = require("fs");\r\nconst path = require("path");\r\nconst { Command } = require("commander");\r\nconst { Project, SyntaxKind } = require("ts-morph");\r\nconst program = new Command();\r\n\r\nprogram\r\n  .version("1.0.0")\r\n  .description("Custom NestJS project initializer")\r\n  .action(() => {\r\n    const newModuleName = "DiscoveryModule";\r\n    // ts-morph project \uc124\uc815\r\n    const project = new Project();\r\n    const appModulePath = path.join(__dirname, "guards/app.module.ts");\r\n\r\n    // \ud504\ub85c\uc81d\ud2b8\uc5d0 app.module.ts \ud30c\uc77c \ucd94\uac00\r\n    const sourceFile = project.addSourceFileAtPath(appModulePath);\r\n\r\n    // AppModule \ud074\ub798\uc2a4 \uc120\uc5b8 \ucc3e\uae30\r\n    const appModuleClass = sourceFile.getClass("AppModule");\r\n    if (!appModuleClass) {\r\n      throw new Error("AppModule class not found");\r\n    }\r\n\r\n    // AppModule \ub370\ucf54\ub808\uc774\ud130 \ucc3e\uae30\r\n    const decorator = appModuleClass.getDecorator("Module");\r\n    if (!decorator) {\r\n      throw new Error("Module decorator not found");\r\n    }\r\n\r\n    // \ub370\ucf54\ub808\uc774\ud130\uc758 \uc778\uc218(\uac1d\uccb4 \ub9ac\ud130\ub7f4) \uac00\uc838\uc624\uae30\r\n    const decoratorArgument = decorator.getArguments()[0];\r\n    if (!decoratorArgument || !decoratorArgument.isKind(SyntaxKind.ObjectLiteralExpression)) {\r\n      throw new Error("Module decorator argument is not an object literal");\r\n    }\r\n\r\n    const importsProperty = decoratorArgument.asKindOrThrow(SyntaxKind.ObjectLiteralExpression).getProperty("imports");\r\n\r\n    if (importsProperty && importsProperty.isKind(SyntaxKind.PropertyAssignment)) {\r\n      const importsArray = importsProperty.getInitializerIfKindOrThrow(SyntaxKind.ArrayLiteralExpression);\r\n\r\n      // \uc911\ubcf5 \uc5ec\ubd80 \uccb4\ud06c\r\n      const isModuleAlreadyImported = importsArray.getElements().some((el: any) => el.getText() === newModuleName);\r\n\r\n      if (!isModuleAlreadyImported) {\r\n        importsArray.addElement(newModuleName);\r\n        sourceFile.addImportDeclaration({\r\n          namedImports: [newModuleName],\r\n          moduleSpecifier: "./path/to/your-module", // \uc2e4\uc81c \ubaa8\ub4c8 \uacbd\ub85c\ub85c \ubc14\uafb8\uc138\uc694\r\n        });\r\n\r\n        console.log(`${newModuleName} has been added to imports array.`);\r\n      } else {\r\n        console.log(`${newModuleName} is already in the imports array.`);\r\n      }\r\n    } else {\r\n      console.error("Imports array not found or not properly formatted.");\r\n    }\r\n\r\n    // \ubcc0\uacbd \uc0ac\ud56d \uc800\uc7a5\r\n    sourceFile.saveSync();\r\n  });\r\n\r\nprogram.parse();\n'})})]})}function m(r={}){const{wrapper:e}={...(0,s.R)(),...r.components};return e?(0,t.jsx)(e,{...r,children:(0,t.jsx)(l,{...r})}):l(r)}}}]);