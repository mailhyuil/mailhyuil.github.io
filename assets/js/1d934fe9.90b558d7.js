"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[185160],{513556:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>p});const i=JSON.parse('{"id":"nestjs/nest base pipe image-upload","title":"nest base pipe image-upload","description":"large, medium, small\uc744 \ubc30\uc5f4\ub85c \ubc18\ud658\ud558\ub294 \uc774\uc720","source":"@site/docs/nestjs/nest base pipe image-upload.md","sourceDirName":"nestjs","slug":"/nestjs/nest base pipe image-upload","permalink":"/docs/nestjs/nest base pipe image-upload","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest image resize (sharp)","permalink":"/docs/nestjs/nest base pipe image-resize - sharp"},"next":{"title":"pipe","permalink":"/docs/nestjs/nest base pipe"}}');var s=n(447259),t=n(529087);const a={},o="nest base pipe image-upload",l={},p=[{value:"image-upload.pipe.ts",id:"image-uploadpipets",level:2}];function c(e){const r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"nest-base-pipe-image-upload",children:"nest base pipe image-upload"})}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"large, medium, small\uc744 \ubc30\uc5f4\ub85c \ubc18\ud658\ud558\ub294 \uc774\uc720"}),"\n",(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsx)(r.p,{children:"\uc774\ubbf8\uc9c0 \ud06c\uae30\ub97c \ub7f0\ud0c0\uc784\uc5d0 \ub3d9\uc801\uc73c\ub85c \ucc98\ub9ac\ud558\uae30\uac00 \uc27d\ub2e4"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"image-uploadpipets",children:"image-upload.pipe.ts"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:'import { Injectable, PipeTransform } from "@nestjs/common";\r\nimport { CreateImageDTO } from "../app/file/file.dto";\r\nimport { FileService } from "../app/file/file.service";\r\nimport { PrismaService } from "../prisma/prisma.service";\r\nimport { hashFile } from "../utils/hash-file";\r\n\r\n@Injectable()\r\nexport class ImageUploadPipe implements PipeTransform<Express.Multer.File[], Promise<CreateImageDTO>> {\r\n  constructor(private readonly fileService: FileService, private readonly prisma: PrismaService) {}\r\n  async transform(files: Express.Multer.File[]): Promise<CreateImageDTO> {\r\n    if (!files) return undefined;\r\n    if (!(files instanceof Array)) return;\r\n    const found = await this.prisma.image.findUnique({\r\n      where: {\r\n        originalUrl: await this.fileService.createUrl(files[0]),\r\n      },\r\n      select: {\r\n        hash: true,\r\n      },\r\n    });\r\n    if (found?.hash === (await hashFile(files[0]))) return undefined;\r\n    return await this.fileService.uploadImage(files);\r\n  }\r\n}\n'})})]})}function m(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},529087:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>o});var i=n(596363);const s={},t=i.createContext(s);function a(e){const r=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:r},e.children)}}}]);