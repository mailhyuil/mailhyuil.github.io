"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["264948"],{374528:function(e,r,n){n.r(r),n.d(r,{frontMatter:()=>i,toc:()=>p,default:()=>u,metadata:()=>l,assets:()=>o,contentTitle:()=>s});var l=JSON.parse('{"id":"linux/linux shellscript deploy with rollback","title":"shellscript deploy with rollback","description":"","source":"@site/docs/linux/linux shellscript deploy with rollback.md","sourceDirName":"linux","slug":"/linux/linux shellscript deploy with rollback","permalink":"/docs/linux/linux shellscript deploy with rollback","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"linux shellscript $() & ${}","permalink":"/docs/linux/linux shellscript ${} vs $"},"next":{"title":"linux shell script exit","permalink":"/docs/linux/linux shellscript exit & return"}}'),t=n(447259),c=n(255511);let i={},s="shellscript deploy with rollback",o={},p=[];function a(e){let r={code:"code",h1:"h1",header:"header",pre:"pre",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"shellscript-deploy-with-rollback",children:"shellscript deploy with rollback"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-sh",children:'#!/bin/bash\r\n\r\nBACKUP_DIR=/app/backup\r\nSERVER_DIR=/app/server\r\n\r\nrollback() {\r\n  echo "Deploy failed, Start rollback..."\r\n\r\n  # \uB864\uBC31 \uC791\uC5C5 \uC218\uD589\r\n  rm -rf $SERVER_DIR\r\n  cp -r $BACKUP_DIR $SERVER_DIR\r\n\r\n  echo "Rollback completed."\r\n  exit 1\r\n}\r\n\r\ntrap rollback EXIT\r\n\r\n# backup\r\ncp -r $SERVER_DIR $BACKUP_DIR\r\n\r\n# build\r\nnx build server\r\necho "Build completed."\r\n\r\n# file copy\r\nrm -rf $SERVER_DIR\r\ncp -r dist/apps/server $SERVER_DIR\r\ncp -r prisma $SERVER_DIR/prisma\r\ncp apps/server/.env.production $SERVER_DIR/.env\r\ncp ecosystem.config.js $SERVER_DIR/ecosystem.config.js\r\ncd $SERVER_DIR\r\necho "File copy completed."\r\n\r\n# deploy\r\nnpm install\r\nnpx prisma migrate deploy\r\npm2 reload ecosystem.config.js --update-env\r\n\r\n# \uC131\uACF5 \uC2DC\uC5D0\uB294 \uB864\uBC31 \uD568\uC218 \uB4F1\uB85D \uD574\uC81C\r\ntrap - EXIT\r\necho "Deployment completed successfully."\r\nexit 0\n'})})]})}function u(e={}){let{wrapper:r}={...(0,c.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},255511:function(e,r,n){n.d(r,{R:()=>i,x:()=>s});var l=n(596363);let t={},c=l.createContext(t);function i(e){let r=l.useContext(c);return l.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),l.createElement(c.Provider,{value:r},e.children)}}}]);