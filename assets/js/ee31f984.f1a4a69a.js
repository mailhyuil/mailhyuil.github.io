"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[168510],{53712:(r,n,e)=>{e.r(n),e.d(n,{assets:()=>p,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"nestjs/nest pagination cursor","title":"nest pagination cursor","description":"cursor.dto.ts","source":"@site/docs/nestjs/nest pagination cursor.md","sourceDirName":"nestjs","slug":"/nestjs/nest pagination cursor","permalink":"/docs/nestjs/nest pagination cursor","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest null\uc744 \ub9ac\ud134\ud558\uc9c0 \ub9d0\uc544\ub77c","permalink":"/docs/nestjs/nest null\uc744 \ub9ac\ud134\ud558\uc9c0 \ub9d0\uc544\ub77c"},"next":{"title":"nest pagination offset","permalink":"/docs/nestjs/nest pagination offset"}}');var s=e(447259),o=e(529087);const i={},a="nest pagination cursor",p={},l=[{value:"cursor.dto.ts",id:"cursordtots",level:2},{value:"controller",id:"controller",level:2},{value:"service",id:"service",level:2},{value:"angular",id:"angular",level:2}];function c(r){const n={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,o.R)(),...r.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"nest-pagination-cursor",children:"nest pagination cursor"})}),"\n",(0,s.jsx)(n.h2,{id:"cursordtots",children:"cursor.dto.ts"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { ApiProperty } from "@nestjs/swagger";\r\nimport { IsArray, IsEnum, IsNumber, IsOptional, IsString } from "class-validator";\r\n\r\nexport class CursorResponseDTO<T> {\r\n  @ApiProperty({ type: Object, isArray: true })\r\n  @IsArray()\r\n  items: T[];\r\n\r\n  @ApiProperty()\r\n  @IsOptional()\r\n  @IsString()\r\n  nextCursor?: string;\r\n}\r\n\r\nexport class CursorOptionsDTO {\r\n  @ApiProperty({ description: "\ud398\uc774\uc9c0 \ud06c\uae30", required: false, nullable: true })\r\n  @IsOptional()\r\n  @IsNumber()\r\n  pageSize?: number;\r\n  @ApiProperty({ description: "\uc815\ub82c \uae30\uc900", required: false, nullable: true })\r\n  @IsOptional()\r\n  @IsString()\r\n  orderBy?: string;\r\n  @ApiProperty({ description: "\uc815\ub82c \ubc29\ud5a5", required: false, nullable: true })\r\n  @IsOptional()\r\n  @IsEnum(["asc", "desc"])\r\n  align?: "asc" | "desc";\r\n  @ApiProperty({ description: "\uac80\uc0c9\uc5b4", required: false, nullable: true })\r\n  @IsOptional()\r\n  @IsString()\r\n  query?: string;\r\n  @ApiProperty({ description: "\ucee4\uc11c", required: false, nullable: true })\r\n  @IsOptional()\r\n  @IsString()\r\n  cursor?: string;\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"controller",children:"controller"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'  @Get("feed")\r\n  @ApiOperation({\r\n    summary: "News \ud53c\ub4dc",\r\n  })\r\n  @ApiOkResponse({ type: CursorResponseDTO<NewsDTO> })\r\n  async feed(@Query() query: NewsCursorOptionsDTO) {\r\n    return await this.newsService.feed(query);\r\n  }\n'})}),"\n",(0,s.jsx)(n.h2,{id:"service",children:"service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'  async feed(options: NewsCursorOptionsDTO) {\r\n    const { pageSize, query, orderBy, align, cursor } = options;\r\n\r\n    const where: Prisma.NewsWhereInput = {\r\n      title: { contains: query },\r\n      type: options.type === "ALL" ? undefined : options.type,\r\n    };\r\n\r\n    const found = await this.prisma.news.findMany({\r\n      where,\r\n      orderBy: { [orderBy || "createdAt"]: align || "desc" },\r\n      take: pageSize,\r\n      skip: cursor ? 1 : 0,\r\n      cursor: cursor ? { id: cursor } : undefined,\r\n    });\r\n\r\n    const nextCursor = found[pageSize - 1]?.id;\r\n\r\n    return plainToInstance(CursorResponseDTO<NewsDTO>, {\r\n      items: found,\r\n      nextCursor,\r\n    });\r\n  }\n'})}),"\n",(0,s.jsx)(n.h2,{id:"angular",children:"angular"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { NewsDto } from "@/api";\r\nimport NormalButtonComponent from "@/client/app/components/normal-button/normal-button.component";\r\nimport SearchComponent from "@/client/app/components/search/search.component";\r\nimport { SegmentGroupComponent } from "@/client/app/components/segment/segment-group/segment-group.component";\r\nimport { SegmentItemComponent } from "@/client/app/components/segment/segment-item/segment-item.component";\r\nimport { NewsApiService } from "@/client/app/services/news-api.service";\r\nimport { NewsTypeMap } from "@/common";\r\nimport { CommonModule } from "@angular/common";\r\nimport { Component, inject, signal } from "@angular/core";\r\nimport { toObservable } from "@angular/core/rxjs-interop";\r\nimport { FormsModule } from "@angular/forms";\r\nimport { RouterModule } from "@angular/router";\r\nimport { NewsControllerFeed$Params } from "api/src/lib/fn/news/news-controller-feed";\r\nimport { switchMap } from "rxjs";\r\n@Component({\r\n  selector: "app-news-list",\r\n  templateUrl: "./news-list.component.html",\r\n  styleUrls: ["./news-list.component.scss"],\r\n  standalone: true,\r\n  imports: [\r\n    CommonModule,\r\n    RouterModule,\r\n    NormalButtonComponent,\r\n    SegmentGroupComponent,\r\n    SegmentItemComponent,\r\n    FormsModule,\r\n    SearchComponent,\r\n  ],\r\n})\r\nexport default class NewsListComponent {\r\n  newsApi = inject(NewsApiService);\r\n\r\n  options = signal<NewsControllerFeed$Params>({\r\n    align: "desc",\r\n    orderBy: "createdAt",\r\n    pageSize: 4,\r\n    query: "",\r\n    type: "ALL",\r\n    cursor: undefined,\r\n  });\r\n\r\n  data = signal<NewsDto[]>([]);\r\n  cursor = signal<string | undefined>(undefined);\r\n\r\n  NewsTypeMap = NewsTypeMap;\r\n\r\n  constructor() {\r\n    toObservable(this.options)\r\n      .pipe(\r\n        switchMap(options =>\r\n          this.newsApi.feed({\r\n            ...options,\r\n          }),\r\n        ),\r\n      )\r\n      .subscribe(res => {\r\n        this.data.update(prev => [...prev, ...(res.items as NewsDto[])]);\r\n        this.cursor.set(res.nextCursor);\r\n      });\r\n  }\r\n\r\n  optionsChange(options: Partial<NewsControllerFeed$Params>) {\r\n    this.options.update(prev => {\r\n      if (options.type) {\r\n        this.data.set([]);\r\n        prev.cursor = undefined;\r\n      }\r\n      return {\r\n        ...prev,\r\n        ...options,\r\n      };\r\n    });\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'@if (cursor()) {\r\n<button\r\n  (click)="\r\n            optionsChange({\r\n              cursor: cursor()\r\n            })\r\n          "\r\n>\r\n  \ub354\ubcf4\uae30\r\n</button>\r\n}\n'})})]})}function u(r={}){const{wrapper:n}={...(0,o.R)(),...r.components};return n?(0,s.jsx)(n,{...r,children:(0,s.jsx)(c,{...r})}):c(r)}},529087:(r,n,e)=>{e.d(n,{R:()=>i,x:()=>a});var t=e(596363);const s={},o=t.createContext(s);function i(r){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof r?r(n):{...n,...r}},[n,r])}function a(r){let n;return n=r.disableParentContext?"function"==typeof r.components?r.components(s):r.components||s:i(r.components),t.createElement(o.Provider,{value:n},r.children)}}}]);