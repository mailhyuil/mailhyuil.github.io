"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[890336],{529087:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>a});var o=r(596363);const t={},c=o.createContext(t);function s(e){const n=o.useContext(c);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(c.Provider,{value:n},e.children)}},589876:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"db-prisma/prisma lock \ube44\uad00\uc801 \ub77d row lock exclusive lock","title":"prisma lock exclusive lock","description":"prisma\ub294 \uc544\uc9c1 lock\uc744 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 $queryRaw\ub97c \uc0ac\uc6a9\ud574\uc57c \ud55c\ub2e4.","source":"@site/docs/db-prisma/prisma lock \ube44\uad00\uc801 \ub77d row lock exclusive lock.md","sourceDirName":"db-prisma","slug":"/db-prisma/prisma lock \ube44\uad00\uc801 \ub77d row lock exclusive lock","permalink":"/docs/db-prisma/prisma lock \ube44\uad00\uc801 \ub77d row lock exclusive lock","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"prisma optimistic lock (\ub099\uad00\uc801 \ub77d)","permalink":"/docs/db-prisma/prisma lock \ub099\uad00\uc801 \ub77d"},"next":{"title":"prisma lock share lock","permalink":"/docs/db-prisma/prisma lock \ube44\uad00\uc801 \ub77d row lock share lock"}}');var t=r(447259),c=r(529087);const s={},a="prisma lock exclusive lock",i={},l=[];function p(e){const n={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"prisma-lock-exclusive-lock",children:"prisma lock exclusive lock"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"prisma\ub294 \uc544\uc9c1 lock\uc744 \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 $queryRaw\ub97c \uc0ac\uc6a9\ud574\uc57c \ud55c\ub2e4."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"SELECT * FROM table_name FOR UPDATE;"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\uc77d\uae30\uc640 \uc4f0\uae30 \ubaa8\ub450 \ubd88\uac00\ub2a5\ud558\ub2e4."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"FOR SHARE \ucc28\ub2e8"}),"\n",(0,t.jsx)(n.p,{children:"FOR UPDATE \ucc28\ub2e8"}),"\n",(0,t.jsx)(n.p,{children:"UPDATE, DELETE \ucc28\ub2e8"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const paymentId = 1;\r\n\r\nawait prisma.$transaction(async (tx) => {\r\n  const payment = await tx.$queryRaw<RawPayment[]>`SELECT amount FROM payments WHERE id = ${paymentId} FOR UPDATE`;\r\n  // \uc774 \uc791\uc5c5\uc774 \ub05d\ub098\uae30 \uc804\uae4c\uc9c0 \ub2e4\ub978 \ud2b8\ub79c\uc7ad\uc158\uc5d0\uc11c\ub294 \ud574\ub2f9 payment\ub97c \uc77d\uac70\ub098 \uc218\uc815\ud560 \uc218 \uc5c6\ub2e4.\r\n  const updated = await tx.payment.update({\r\n    where: { id: paymentId },\r\n    data: { amount: payment.amount + 100 },\r\n  });\r\n  return updated;\r\n});\n"})})]})}function d(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}}}]);