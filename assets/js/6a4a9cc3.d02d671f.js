"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["256264"],{310326:function(e,t,r){r.r(t),r.d(t,{frontMatter:()=>a,toc:()=>d,default:()=>i,metadata:()=>n,assets:()=>l,contentTitle:()=>c});var n=JSON.parse('{"id":"kubernetes/kube ControlPlane etcd snapshot - backup & restore","title":"etcd snapshot (backup & restore)","description":"trusted-ca-file, cert-file, key-file \uC778\uC99D\uC11C\uAC00 \uD544\uC694","source":"@site/docs/kubernetes/kube ControlPlane etcd snapshot - backup & restore.md","sourceDirName":"kubernetes","slug":"/kubernetes/kube ControlPlane etcd snapshot - backup & restore","permalink":"/docs/kubernetes/kube ControlPlane etcd snapshot - backup & restore","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"CoreDNS & kube-dns","permalink":"/docs/kubernetes/kube ControlPlane CoreDNS & kube-dns"},"next":{"title":"etcd","permalink":"/docs/kubernetes/kube ControlPlane etcd"}}'),s=r(447259),o=r(255511);let a={},c="etcd snapshot (backup & restore)",l={},d=[{value:"Backup (snapshot save)",id:"backup-snapshot-save",level:2},{value:"Restore (snapshot restore)",id:"restore-snapshot-restore",level:2}];function p(e){let t={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"etcd-snapshot-backup--restore",children:"etcd snapshot (backup & restore)"})}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"trusted-ca-file, cert-file, key-file \uC778\uC99D\uC11C\uAC00 \uD544\uC694"}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"ps -ef | grep kube | grep <option_name>"})," \uC73C\uB85C \uC778\uC99D\uC11C \uACBD\uB85C \uD655\uC778"]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"ETCDCTL_API=3 \uB294 version\uC744 \uBA85\uC2DC\uD558\uB294 \uAC83"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"backup-snapshot-save",children:"Backup (snapshot save)"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"# master node\uC5D0\uC11C \uC2E4\uD589\r\netcd --version\r\netcdctl version\r\n\r\n# backup\r\nETCDCTL_API=3 etcdctl \\\r\n--endpoints=https://127.0.0.1:2379 \\\r\n--cacert=<trusted-ca-file> \\\r\n--cert=<cert-file> \\\r\n--key=<key-file> \\\r\nsnapshot save <backup-file-location>\r\n\r\n# trusted-ca-file, cert-file, key-file \uC778\uC99D\uC11C \uACBD\uB85C \uD655\uC778\r\nps -ef | grep kube | grep trusted-ca-file\r\nps -ef | grep kube | grep cert-file\r\nps -ef | grep kube | grep key-file\r\n\r\n# example\r\n## backup\r\nETCDCTL_API=3 etcdctl \\\r\n--endpoints=https://127.0.0.1:2379 \\\r\n--cacert=/etc/kubernetes/pki/etcd/ca.crt \\\r\n--cert=/etc/kubernetes/pki/etcd/server.crt \\\r\n--key=/etc/kubernetes/pki/etcd/server.key \\\r\nsnapshot save /opt/snapshot-pre-boot.db\r\n\r\n## restore\r\nETCDCTL_API=3 etcdctl \\\r\n--data-dir /var/lib/etcd-from-backup \\\r\nsnapshot restore /opt/snapshot-pre-boot.db\n"})}),"\n",(0,s.jsx)(t.h2,{id:"restore-snapshot-restore",children:"Restore (snapshot restore)"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sh",children:"etcdutl --data-dir <data-dir-location> snapshot restore <backup-file>\r\n# backup-file = snapshot save \uBA85\uB839\uC5B4\uB85C \uBC31\uC5C5\uB41C \uD30C\uC77C\r\n# data-dir-location = restore\uB41C etcd \uB370\uC774\uD130\uAC00 \uC800\uC7A5\uB420 \uB514\uB809\uD1A0\uB9AC\r\n\r\n# \uD655\uC778\r\ndocker ps -a | grep etcd\r\n\r\n# /etc/kubernetes/manifests/etcd.yaml \uD30C\uC77C\uC5D0\uC11C\r\n# hostPath.path\uB97C <data-dir-location> \uC73C\uB85C \uBCC0\uACBD\r\n# yaml \uD30C\uC77C\uC744 \uBCC0\uACBD\uD558\uBA74 etcd pod\uAC00 \uC7AC\uC2DC\uC791\uB418\uC5B4 etcd\uAC00 \uC0C8\uB86D\uAC8C \uC124\uCE58\uB41C\uB2E4.\r\n- hostPath:\r\n    path: <data-dir-location>\r\n    type: DirectoryOrCreate\r\n    name: etcd-data\n"})})]})}function i(e={}){let{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},255511:function(e,t,r){r.d(t,{R:()=>a,x:()=>c});var n=r(596363);let s={},o=n.createContext(s);function a(e){let t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);