"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[121820],{529087:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var r=n(596363);const o={},s=r.createContext(o);function i(e){const t=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:t},e.children)}},629727:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"javascript/js Proxy usage","title":"js Proxy","description":"\uc774\ubbf8 \uc788\ub294 readonly \uac1d\uccb4\uc5d0 \uc0c8\ub85c\uc6b4 \uae30\ub2a5\uc744 \ucd94\uac00\ud560 \uc218 \uc788\uc74c","source":"@site/docs/javascript/js Proxy usage.md","sourceDirName":"javascript","slug":"/javascript/js Proxy usage","permalink":"/docs/javascript/js Proxy usage","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Promise","permalink":"/docs/javascript/js Promise"},"next":{"title":"js AOP Proxy","permalink":"/docs/javascript/js Proxy"}}');var o=n(447259),s=n(529087);const i={},a="js Proxy",c={},l=[{value:"\ud568\uc218 \ub4a4\uc5d0 \ud638\ucd9c\ud558\uae30",id:"\ud568\uc218-\ub4a4\uc5d0-\ud638\ucd9c\ud558\uae30",level:2}];function u(e){const t={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"js-proxy",children:"js Proxy"})}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsx)(t.p,{children:"\uc774\ubbf8 \uc788\ub294 readonly \uac1d\uccb4\uc5d0 \uc0c8\ub85c\uc6b4 \uae30\ub2a5\uc744 \ucd94\uac00\ud560 \uc218 \uc788\uc74c"}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:"type Client = typeof client;\r\n\r\nconst buildClientProxy = (timeoutMs: number) => {\r\n\tconst startTime = Date.now();\r\n\r\n\tconst handler = {\r\n\t\tget(target: Client, key: keyof Client) {\r\n\t\t\tif (Date.now() >= startTime + timeoutMs) {\r\n\t\t\t\tthrow new Error('Lock has expired.');\r\n\t\t\t}\r\n\t\t\tconst prop = Reflect.get(target, key); // target[key] \ub300\uc2e0 Reflect.get(target, key)\ub97c \uc0ac\uc6a9\ud558\uba74 property\uac00 \uc5c6\uc744 \ub54c undefined\uac00 \uc544\ub2cc \uc5d0\ub7ec\ub97c \ubc1c\uc0dd\uc2dc\ud0b4\r\n\t\t\treturn typeof prop === 'function' ? prop.bind(target) : prop;\r\n\t\t}\r\n\t};\r\n\r\n\treturn new Proxy(client, handler) as Client;\r\n};\r\n\r\nconst clientProxy = buildClientProxy(timeoutMs);\r\n\r\nclientProxy.rPush(bidHistoryKey(attrs.itemId), serialized);\r\nclientProxy.hSet(itemsKey(item.id), {\r\n    bids: item.bids + 1,\r\n    price: attrs.amount,\r\n    highestBidUserId: attrs.userId\r\n});\n"})}),"\n",(0,o.jsx)(t.h2,{id:"\ud568\uc218-\ub4a4\uc5d0-\ud638\ucd9c\ud558\uae30",children:"\ud568\uc218 \ub4a4\uc5d0 \ud638\ucd9c\ud558\uae30"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:'class Client {\r\n  rPush(key: string, value: string) {\r\n    console.log(`rPush ${key} ${value}`);\r\n  }\r\n  hSet(key: string, value: any) {\r\n    console.log(`hSet ${key} ${value}`);\r\n  }\r\n}\r\nconst client = new Client();\r\n\r\nconst buildClientProxy = () => {\r\n  const handler = {\r\n    get(target: Client, key: keyof Client) {\r\n      const prop = Reflect.get(target, key); // target[key] \ub300\uc2e0 Reflect.get(target, key)\ub97c \uc0ac\uc6a9\ud558\uba74 property\uac00 \uc5c6\uc744 \ub54c undefined\uac00 \uc544\ub2cc \uc5d0\ub7ec\ub97c \ubc1c\uc0dd\uc2dc\ud0b4\r\n      console.log("before");\r\n      if (typeof prop === "function") {\r\n        return function () {\r\n          // \ubc18\ub4dc\uc2dc function\uc744 \uc0ac\uc6a9 (\ud654\uc0b4\ud45c \ud568\uc218 x)\r\n          const fn = prop.bind(target)(arguments[0], arguments[1]);\r\n          console.log("after");\r\n          return fn;\r\n        };\r\n      }\r\n      return prop;\r\n    },\r\n  };\r\n  return new Proxy(client, handler) as Client;\r\n};\r\n\r\nconst clientProxy = buildClientProxy();\r\n\r\nclientProxy.hSet("key", "value");\r\nclientProxy.rPush("key", "value");\n'})})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}}}]);