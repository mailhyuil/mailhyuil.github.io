"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["863934"],{87412:function(n,r,o){o.r(r),o.d(r,{frontMatter:()=>a,toc:()=>s,default:()=>p,metadata:()=>e,assets:()=>c,contentTitle:()=>t});var e=JSON.parse('{"id":"logging & monitoring & profiling & tracing/loki","title":"loki","description":"log \uC218\uC9D1 \uBC0F \uBD84\uC11D\uC744 \uC704\uD55C \uC624\uD508\uC18C\uC2A4 \uD50C\uB7AB\uD3FC","source":"@site/docs/logging & monitoring & profiling & tracing/loki.md","sourceDirName":"logging & monitoring & profiling & tracing","slug":"/logging & monitoring & profiling & tracing/loki","permalink":"/docs/logging & monitoring & profiling & tracing/loki","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"loki","permalink":"/docs/logging & monitoring & profiling & tracing/loki json to logfmt"},"next":{"title":"opentelemetry","permalink":"/docs/logging & monitoring & profiling & tracing/opentelemetry"}}'),i=o(447259),l=o(255511);let a={},t="loki",c={},s=[{value:"copy config",id:"copy-config",level:2},{value:"docker-compose.yml",id:"docker-composeyml",level:2},{value:"/promtail/config.yml",id:"promtailconfigyml",level:2}];function g(n){let r={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,l.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"loki",children:"loki"})}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"log \uC218\uC9D1 \uBC0F \uBD84\uC11D\uC744 \uC704\uD55C \uC624\uD508\uC18C\uC2A4 \uD50C\uB7AB\uD3FC"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"prometheus\uB294 metric\uC744 \uC218\uC9D1\uD558\uACE0, loki\uB294 log\uB97C \uC218\uC9D1\uD55C\uB2E4."}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"winston\uC744 \uC0AC\uC6A9\uD574\uC11C /var/log\uC5D0 \uB85C\uADF8\uB97C \uC800\uC7A5\uD558\uACE0 promtail\uC744 \uC0AC\uC6A9\uD574\uC11C loki\uB85C \uC804\uC1A1\uD55C\uB2E4."}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"\uC218\uC9D1\uD55C \uB370\uC774\uD130\uB294 grafana\uB97C \uD1B5\uD574\uC11C \uBCFC \uC218 \uC788\uB2E4."}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"docker-compose.yaml \uC2E4\uD589 -> grafana\uC5D0 \uC811\uC18D \uD6C4 loki datasource \uCD94\uAC00"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"copy-config",children:"copy config"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sh",children:"docker create --name dummy grafana/loki:latest &&\r\ndocker cp dummy:/loki ./loki/data &&\r\ndocker cp dummy:/etc/loki ./loki/config &&\r\ndocker rm -f dummy\r\n\r\n# chmod 777 ./loki/data\n"})}),"\n",(0,i.jsx)(r.h2,{id:"docker-composeyml",children:"docker-compose.yml"}),"\n",(0,i.jsxs)(r.blockquote,{children:["\n",(0,i.jsx)(r.p,{children:"default port: 3100"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'services:\r\n  loki:\r\n    image: grafana/loki:latest\r\n    ports:\r\n      - "3100:3100"\r\n    command: -config.file=/etc/loki/local-config.yaml\r\n    volumes:\r\n      - ./loki/data:/loki\r\n      - ./loki/config:/etc/loki\r\n    networks:\r\n      - loki\r\n\r\n  promtail:\r\n    image: grafana/promtail:latest\r\n    volumes:\r\n      - /var/log:/var/log\r\n      - ./promtail:/etc/promtail\r\n    command: -config.file=/etc/promtail/config.yml\r\n    networks:\r\n      - loki\r\n\r\n  grafana:\r\n    environment:\r\n      - GF_PATHS_PROVISIONING=/etc/grafana/provisioning\r\n      - GF_FEATURE_TOGGLES_ENABLE=alertingSimplifiedRouting,alertingQueryAndExpressionsStepMode\r\n    entrypoint:\r\n      - sh\r\n      - -euc\r\n      - |\r\n        mkdir -p /etc/grafana/provisioning/datasources\r\n        cat <<EOF > /etc/grafana/provisioning/datasources/ds.yaml\r\n        apiVersion: 1\r\n        datasources:\r\n        - name: Loki\r\n          type: loki\r\n          access: proxy \r\n          orgId: 1\r\n          url: http://loki:3100\r\n          basicAuth: false\r\n          isDefault: true\r\n          version: 1\r\n          editable: false\r\n        EOF\r\n        /run.sh\r\n    image: grafana/grafana:latest\r\n    ports:\r\n      - "3000:3000"\r\n    volumes:\r\n      - ./grafana/config:/etc/grafana\r\n      - ./grafana/data:/var/lib/grafana\r\n      - ./grafana/logs:/var/log/grafana\r\n    networks:\r\n      - loki\r\nnetworks:\r\n  loki:\n'})}),"\n",(0,i.jsx)(r.h2,{id:"promtailconfigyml",children:"/promtail/config.yml"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"server:\r\n  http_listen_port: 9080\r\n  grpc_listen_port: 0\r\n\r\npositions:\r\n  filename: /tmp/positions.yaml\r\n\r\nclients:\r\n  - url: http://loki:3100/loki/api/v1/push\r\n\r\nscrape_configs:\r\n  - job_name: myapp\r\n    static_configs:\r\n      - targets:\r\n          - localhost\r\n        labels:\r\n          job: myapp-info\r\n          __path__: /var/log/myapp/info/*log\r\n      - targets:\r\n          - localhost\r\n        labels:\r\n          job: myapp-error\r\n          __path__: /var/log/myapp/error/*log\r\n      - targets:\r\n          - localhost\r\n        labels:\r\n          job: myapp-warn\r\n          __path__: /var/log/myapp/warn/*log\n"})})]})}function p(n={}){let{wrapper:r}={...(0,l.R)(),...n.components};return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(g,{...n})}):g(n)}},255511:function(n,r,o){o.d(r,{R:()=>a,x:()=>t});var e=o(596363);let i={},l=e.createContext(i);function a(n){let r=e.useContext(l);return e.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function t(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),e.createElement(l.Provider,{value:r},n.children)}}}]);