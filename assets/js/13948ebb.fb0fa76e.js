"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["623742"],{31041:function(e,t,n){n.r(t),n.d(t,{frontMatter:()=>c,toc:()=>i,default:()=>d,metadata:()=>r,assets:()=>a,contentTitle:()=>l});var r=JSON.parse('{"id":"nestjs/nest base guard RoleGuard","title":"nest roleGuard","description":"\uAE30\uBCF8\uC73C\uB85C Member, Admin, Guest \uAD8C\uD55C\uC744 \uC0DD\uC131\uD574\uB77C","source":"@site/docs/nestjs/nest base guard RoleGuard.md","sourceDirName":"nestjs","slug":"/nestjs/nest base guard RoleGuard","permalink":"/docs/nestjs/nest base guard RoleGuard","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nestjs AuthGuard","permalink":"/docs/nestjs/nest base guard AuthGuard"},"next":{"title":"nestjs guard","permalink":"/docs/nestjs/nest base guard"}}'),s=n(447259),o=n(255511);let c={},l="nest roleGuard",a={},i=[];function u(e){let t={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"nest-roleguard",children:"nest roleGuard"})}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"\uAE30\uBCF8\uC73C\uB85C Member, Admin, Guest \uAD8C\uD55C\uC744 \uC0DD\uC131\uD574\uB77C"}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"ForbiddenException\uC744 \uB358\uC838\uB77C"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:'import { CanActivate, ExecutionContext, ForbiddenException, Injectable } from "@nestjs/common";\r\nimport { Reflector } from "@nestjs/core";\r\nimport { Role } from "@prisma/client";\r\n\r\n@Injectable()\r\nexport class RoleGuard implements CanActivate {\r\n  constructor(private readonly reflector: Reflector) {}\r\n  async canActivate(context: ExecutionContext) {\r\n    const req = context.switchToHttp().getRequest();\r\n    const roles = this.reflector.getAllAndOverride<string[]>("roles", [context.getHandler(), context.getClass()]);\r\n\r\n    const user = await req.user;\r\n\r\n    const userRoles: Role[] = user.roles;\r\n\r\n    const intersections = userRoles?.filter(role => roles.includes(role));\r\n\r\n    if (!intersections || !intersections.length) {\r\n      throw new ForbiddenException("\uC0AC\uC6A9 \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");\r\n    }\r\n    return true;\r\n  }\r\n}\n'})})]})}function d(e={}){let{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},255511:function(e,t,n){n.d(t,{R:()=>c,x:()=>l});var r=n(596363);let s={},o=r.createContext(s);function c(e){let t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);