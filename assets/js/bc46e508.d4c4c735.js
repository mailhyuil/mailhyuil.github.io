"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["416587"],{906546:function(n,e,o){o.r(e),o.d(e,{frontMatter:()=>c,toc:()=>u,default:()=>d,metadata:()=>t,assets:()=>i,contentTitle:()=>l});var t=JSON.parse('{"id":"nestjs/nest graceful shutdown","title":"nest graceful shutdown","description":"log\uC758 \uACBD\uC6B0 buffer\uC5D0 \uB0A8\uC740 \uB85C\uADF8\uAC00 \uC788\uC744 \uC218 \uC788\uC73C\uBBC0\uB85C, log\uB97C flush\uD558\uB294 \uC791\uC5C5\uC774 \uD544\uC694\uD558\uB2E4.","source":"@site/docs/nestjs/nest graceful shutdown.md","sourceDirName":"nestjs","slug":"/nestjs/nest graceful shutdown","permalink":"/docs/nestjs/nest graceful shutdown","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest graceful shutdown","permalink":"/docs/nestjs/nest graceful shutdown onApplicationShutdown"},"next":{"title":"nest helmet","permalink":"/docs/nestjs/nest helmet"}}'),s=o(447259),r=o(255511);let c={},l="nest graceful shutdown",i={},u=[{value:"main.ts",id:"maints",level:2}];function a(n){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"nest-graceful-shutdown",children:"nest graceful shutdown"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"log\uC758 \uACBD\uC6B0 buffer\uC5D0 \uB0A8\uC740 \uB85C\uADF8\uAC00 \uC788\uC744 \uC218 \uC788\uC73C\uBBC0\uB85C, log\uB97C flush\uD558\uB294 \uC791\uC5C5\uC774 \uD544\uC694\uD558\uB2E4."}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"consumer\uC758 \uACBD\uC6B0 consume\uC744 \uC911\uB2E8\uD558\uACE0 \uB0A8\uC740 \uBA54\uC2DC\uC9C0\uB97C \uCC98\uB9AC\uD574\uC57C \uD55C\uB2E4."}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"\uD504\uB85C\uC138\uC2A4 \uC885\uB8CC\uB294 SIGINT\uB97C \uBCF4\uB0B8\uB2E4. (pm2 \uAE30\uC900) (SIGTERM\uC73C\uB85C \uB300\uCCB4\uD560 \uC218\uB3C4 \uC788\uC74C)"}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"SIGINT\uB97C \uBC1B\uACE0 1.6s \uB3D9\uC548 exit\uD558\uC9C0 \uC54A\uC73C\uBA74 SIGKILL\uC744 \uBCF4\uB0B8\uB2E4."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"maints",children:"main.ts"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:'async function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n\r\n  const server = app.listen(3000, () => console.log("Running\u2026"));\r\n\r\n  setInterval(() => server.getConnections((err, connections) => console.log(`${connections} connections currently open`)), 1000);\r\n\r\n  // SIGTERM, SIGINT\uB97C \uBC1B\uC73C\uBA74 shutDown \uD568\uC218\uB97C \uC2E4\uD589\uD55C\uB2E4.\r\n  process.on("SIGTERM", shutDown);\r\n  process.on("SIGINT", shutDown);\r\n\r\n  // \uCD94\uAC00\uB41C connection\uC744 connections\uC5D0 \uCD94\uAC00\uD558\uACE0, close\uB418\uB294 connection\uC744 connections\uC5D0\uC11C \uC81C\uAC70\uD55C\uB2E4.\r\n  const connections = [];\r\n  server.on("connection", (connection) => {\r\n    connections.push(connection);\r\n    connection.on("close", () => (connections = connections.filter((curr) => curr !== connection)));\r\n  });\r\n}\r\n\r\nfunction shutDown() {\r\n  console.log("Received kill signal, shutting down gracefully");\r\n  app.close(() => {\r\n    console.log("Closed out remaining connections");\r\n    process.exit(0);\r\n  });\r\n\r\n  setTimeout(() => {\r\n    console.error("Could not close connections in time, forcefully shutting down");\r\n    process.exit(1);\r\n  }, 10000);\r\n\r\n  connections.forEach((curr) => curr.end()); // close all open connections\r\n  setTimeout(() => connections.forEach((curr) => curr.destroy()), 5000); // destroy all open connections\r\n}\n'})})]})}function d(n={}){let{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},255511:function(n,e,o){o.d(e,{R:()=>c,x:()=>l});var t=o(596363);let s={},r=t.createContext(s);function c(n){let e=t.useContext(r);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);