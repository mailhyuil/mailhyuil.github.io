"use strict";(globalThis.webpackChunkmy_blog=globalThis.webpackChunkmy_blog||[]).push([[558739],{179876:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"express/express long polling","title":"express long polling","description":"send() \uba54\uc11c\ub4dc\ub97c \ubbf8\ub8f8\uc73c\ub85c\uc368 \uc5f0\uacb0\uc744 \uc9c0\uc18d\uc2dc\ud0a8\ub2e4.","source":"@site/docs/express/express long polling.md","sourceDirName":"express","slug":"/express/express long polling","permalink":"/docs/express/express long polling","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"http connection \uc720\uc9c0","permalink":"/docs/express/express connection \uc720\uc9c0"},"next":{"title":"express on close","permalink":"/docs/express/express on close"}}');var t=r(447259),o=r(529087);const c={},i="express long polling",l={},a=[{value:"client",id:"client",level:2},{value:"server",id:"server",level:2}];function u(e){const s={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"express-long-polling",children:"express long polling"})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"send() \uba54\uc11c\ub4dc\ub97c \ubbf8\ub8f8\uc73c\ub85c\uc368 \uc5f0\uacb0\uc744 \uc9c0\uc18d\uc2dc\ud0a8\ub2e4."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"client",children:"client"}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"\uc7ac\uadc0\ud568\uc218\ub97c \ud1b5\ud574\uc11c \uc11c\ubc84\uc640 \uc5f0\uacb0\uc744 \uc720\uc9c0"}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"\uc5f0\uacb0\uc774 \ub04a\uae30\uba74 \ub2e4\uc2dc \uc5f0\uacb0\uc744 \uc2dc\ub3c4"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"async function subscribe() {\r\n  let response = await fetch(\"/subscribe\");\r\n\r\n  if (response.status == 502) {\r\n    // Status 502 is a connection timeout error,\r\n    // may happen when the connection was pending for too long,\r\n    // and the remote server or a proxy closed it\r\n    // let's reconnect\r\n    await subscribe();\r\n  } else if (response.status != 200) {\r\n    // An error - let's show it\r\n    showMessage(response.statusText);\r\n    // Reconnect in one second\r\n    await new Promise((resolve) => setTimeout(resolve, 1000));\r\n    await subscribe();\r\n  } else {\r\n    // Get and show the message\r\n    let message = await response.text();\r\n    showMessage(message);\r\n    // Call subscribe() again to get the next message\r\n    await subscribe();\r\n  }\r\n}\r\n\r\nsubscribe();\n"})}),"\n",(0,t.jsx)(s.h2,{id:"server",children:"server"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:'const express = require("express");\r\nconst router = express.Router();\r\n\r\nconst subscribers = new Map();\r\n\r\n/// /subscribe\uc5d0 get\uc694\uccad\uc774 \uc624\uba74 subscribers\uc5d0 \ucd94\uac00\r\nrouter.get("/subscribe", function (req, res, next) {\r\n  const subscriber = {\r\n    id: Math.random(),\r\n    res,\r\n    send(message) {\r\n      this.res.send(message);\r\n    },\r\n  };\r\n\r\n  subscribers.set(subscriber.id, subscriber);\r\n\r\n  req.on("close", () => {\r\n    subscribers.delete(subscriber.id);\r\n  });\r\n});\r\n\r\n/// /publish\uc5d0 post\uc694\uccad\uc73c\ub85c \uba54\uc2dc\uc9c0\ub97c \ubcf4\ub0b4\uba74 subscribers\uc5d0 \uc788\ub294 \ubaa8\ub4e0 \uad6c\ub3c5\uc790\uc5d0\uac8c \uba54\uc2dc\uc9c0\ub97c \ubcf4\ub0c4\r\n/// \uadf8\ub9ac\uace0 subscribers\ub97c \ube44\uc6c0\r\nrouter.post("/publish", function (req, res, next) {\r\n  const message = req.body.message;\r\n\r\n  for (const subscriber of subscribers.values()) {\r\n    subscriber.send(message);\r\n  }\r\n\r\n  subscribers.clear();\r\n\r\n  res.send("ok");\r\n});\r\n\r\nmodule.exports = router;\n'})})]})}function p(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},529087:(e,s,r)=>{r.d(s,{R:()=>c,x:()=>i});var n=r(596363);const t={},o=n.createContext(t);function c(e){const s=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),n.createElement(o.Provider,{value:s},e.children)}}}]);