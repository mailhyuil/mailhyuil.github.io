"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["190905"],{707897:function(r,e,n){n.r(e),n.d(e,{frontMatter:()=>a,toc:()=>c,default:()=>u,metadata:()=>t,assets:()=>l,contentTitle:()=>i});var t=JSON.parse('{"id":"angular/angular base ErrorHandler HttpErrorHandler","title":"angular ErrorHandler HttpErrorHandler","description":"httpClient\uC5D0\uC11C \uBC1C\uC0DD\uD558\uB294 \uC5D0\uB7EC\uB97C \uC7A1\uC544\uC11C \uCC98\uB9AC\uD558\uB294 \uD578\uB4E4\uB7EC","source":"@site/docs/angular/angular base ErrorHandler HttpErrorHandler.md","sourceDirName":"angular","slug":"/angular/angular base ErrorHandler HttpErrorHandler","permalink":"/docs/angular/angular base ErrorHandler HttpErrorHandler","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"angular ErrorHandler GlobalErrorHandler","permalink":"/docs/angular/angular base ErrorHandler GlobalErrorHandler"},"next":{"title":"angular Renderer2","permalink":"/docs/angular/angular base Renderer2"}}'),o=n(447259),s=n(255511);let a={},i="angular ErrorHandler HttpErrorHandler",l={},c=[{value:"http-error.interceptor.ts",id:"http-errorinterceptorts",level:2},{value:"http-error.handler.ts",id:"http-errorhandlerts",level:2},{value:"error-message.ts",id:"error-messagets",level:2}];function p(r){let e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"angular-errorhandler-httperrorhandler",children:"angular ErrorHandler HttpErrorHandler"})}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"httpClient\uC5D0\uC11C \uBC1C\uC0DD\uD558\uB294 \uC5D0\uB7EC\uB97C \uC7A1\uC544\uC11C \uCC98\uB9AC\uD558\uB294 \uD578\uB4E4\uB7EC"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"http-errorinterceptorts",children:"http-error.interceptor.ts"}),"\n",(0,o.jsxs)(e.blockquote,{children:["\n",(0,o.jsx)(e.p,{children:"HttpErrorResponse\uB294 \uC575\uADE4\uB7EC\uC5D0\uC11C \uC81C\uACF5\uD558\uB294 \uC5D0\uB7EC \uAC1D\uCCB4\uC774\uB2E4. (Error\uB97C \uC0C1\uC18D\uD558\uC9C0 \uC54A\uB294\uB2E4.)"}),"\n"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:"return next(apiReq).pipe(\r\n  catchError(error => {\r\n    if (error instanceof HttpErrorResponse) {\r\n      httpErrorHandler.handleError(error);\r\n    }\r\n    throw error;\r\n  }),\r\n);\n"})}),"\n",(0,o.jsx)(e.h2,{id:"http-errorhandlerts",children:"http-error.handler.ts"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:'import { ErrorMessage, ToastService } from "@/common";\r\nimport { HttpErrorResponse } from "@angular/common/http";\r\nimport { ErrorHandler, Injectable, inject } from "@angular/core";\r\nimport { Router } from "@angular/router";\r\nimport { CookieService } from "ngx-cookie-service";\r\nimport { switchMap } from "rxjs";\r\nimport { AuthApiService } from "../services/auth-api.service";\r\nimport { UserApiService } from "../services/user-api.service";\r\nimport { AuthStore } from "../stores/auth.store";\r\nimport { UserFriendlyError } from "./user-friendly.error";\r\n\r\nfunction isJsonString(str: string) {\r\n  try {\r\n    JSON.parse(str);\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: "root",\r\n})\r\nexport class HttpErrorHandler implements ErrorHandler {\r\n  authStore = inject(AuthStore);\r\n  toastService = inject(ToastService);\r\n  router = inject(Router);\r\n  cookieService = inject(CookieService);\r\n  authApi = inject(AuthApiService);\r\n  userApi = inject(UserApiService);\r\n\r\n  handleError(httpError: HttpErrorResponse) {\r\n    const status: number = httpError.status;\r\n    const error: any = httpError.error;\r\n    const response = isJsonString(error) ? JSON.parse(error) : error;\r\n\r\n    if (status === 0) {\r\n      this.toastService.openDanger("\uC11C\uBC84\uC5D0 \uC5F0\uACB0\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");\r\n      return;\r\n    }\r\n\r\n    if (status === 401) {\r\n      this.handleUnauthorized();\r\n      return;\r\n    }\r\n\r\n    if (status === 498) {\r\n      this.handleInvalidToken();\r\n      return;\r\n    }\r\n\r\n    throw new UserFriendlyError(\r\n      ErrorMessage[response.error.code] ||\r\n        response.error.message ||\r\n        response.message ||\r\n        "\uC54C \uC218 \uC5C6\uB294 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4.",\r\n    );\r\n  }\r\n\r\n  private async handleInvalidToken() {\r\n    this.authStore.clearAuth();\r\n    this.authApi\r\n      .getAccessTokenByRefreshToken()\r\n      .pipe(switchMap(() => this.userApi.me()))\r\n      .subscribe(user => {\r\n        if (user) {\r\n          this.authStore.setAuth(user);\r\n        }\r\n      });\r\n  }\r\n\r\n  private async handleUnauthorized(): Promise<void> {\r\n    this.authStore.clearAuth();\r\n    this.toastService.openDanger("\uC0AC\uC6A9 \uAD8C\uD55C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uB85C\uADF8\uC778\uD574\uC8FC\uC138\uC694.");\r\n    this.router.navigateByUrl("/login");\r\n  }\r\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"error-messagets",children:"error-message.ts"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-ts",children:'export const ErrorMessage: Record<number, string> = {\r\n  1001: "\uC720\uC800\uC758 \uC815\uBCF4\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",\r\n  1002: "\uC774\uBBF8 \uC874\uC7AC\uD558\uB294 \uC720\uC800\uC785\uB2C8\uB2E4.",\r\n  1003: "\uACF5\uC9C0\uC0AC\uD56D\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",\r\n  1004: "\uACF5\uC9C0\uC0AC\uD56D \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  1005: "\uACF5\uC9C0\uC0AC\uD56D \uC218\uC815\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  1006: "\uBC30\uB108\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",\r\n  1007: "\uBC30\uB108 \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  1008: "\uBC30\uB108 \uC218\uC815\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  1009: "\uBC30\uB108\uC758 \uC21C\uC11C\uB97C \uBCC0\uACBD\uD558\uB294\uB370 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.",\r\n  // PrismaException\uC73C\uB85C \uC7A1\uC9C0 \uBABB\uD55C \uC5D0\uB7EC \uCC98\uB9AC\r\n  9998: "\uB370\uC774\uD130\uBCA0\uC774\uC2A4 \uC791\uC5C5 \uC911 \uC608\uAE30\uCE58 \uC54A\uC740 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. \uBB38\uC81C\uAC00 \uC9C0\uC18D\uB418\uBA74 \uAC1C\uBC1C\uC790\uC5D0\uAC8C \uBB38\uC758\uD558\uC138\uC694.",\r\n};\n'})})]})}function u(r={}){let{wrapper:e}={...(0,s.R)(),...r.components};return e?(0,o.jsx)(e,{...r,children:(0,o.jsx)(p,{...r})}):p(r)}},255511:function(r,e,n){n.d(e,{R:()=>a,x:()=>i});var t=n(596363);let o={},s=t.createContext(o);function a(r){let e=t.useContext(s);return t.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function i(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(o):r.components||o:a(r.components),t.createElement(s.Provider,{value:e},r.children)}}}]);