"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["871031"],{96921:function(n,e,r){r.r(e),r.d(e,{frontMatter:()=>i,toc:()=>c,default:()=>u,metadata:()=>t,assets:()=>p,contentTitle:()=>a});var t=JSON.parse('{"id":"nestjs/nest pagination offset","title":"nest pagination offset","description":"pagination.dto.ts","source":"@site/docs/nestjs/nest pagination offset.md","sourceDirName":"nestjs","slug":"/nestjs/nest pagination offset","permalink":"/docs/nestjs/nest pagination offset","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"nest pagination cursor","permalink":"/docs/nestjs/nest pagination cursor"},"next":{"title":"nest oauth passport","permalink":"/docs/nestjs/nest passport jwt"}}'),s=r(447259),o=r(255511);let i={},a="nest pagination offset",p={},c=[{value:"pagination.dto.ts",id:"paginationdtots",level:2},{value:"service",id:"service",level:2},{value:"controller",id:"controller",level:2}];function l(n){let e={code:"code",h1:"h1",h2:"h2",header:"header",pre:"pre",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"nest-pagination-offset",children:"nest pagination offset"})}),"\n",(0,s.jsx)(e.h2,{id:"paginationdtots",children:"pagination.dto.ts"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:'import { ApiProperty, ApiPropertyOptional } from "@nestjs/swagger";\r\nimport { Type } from "class-transformer";\r\nimport { IsEnum, IsNotEmpty, IsNumber, IsOptional, IsString } from "class-validator";\r\n\r\nexport class PageInfoDTO {\r\n  @ApiProperty({ description: "\uD604\uC7AC \uD398\uC774\uC9C0" })\r\n  @IsNumber()\r\n  pageIndex: number;\r\n  @ApiProperty({ description: "\uD398\uC774\uC9C0 \uD06C\uAE30" })\r\n  @IsNumber()\r\n  pageSize: number;\r\n  @ApiProperty({ description: "\uD604\uC7AC \uD398\uC774\uC9C0 \uC544\uC774\uD15C \uAC1C\uC218" })\r\n  @IsNumber()\r\n  itemsOnPageCount: number;\r\n  @ApiProperty({ description: "\uCD1D \uD398\uC774\uC9C0" })\r\n  @IsNumber()\r\n  totalPageCount: number;\r\n  @ApiProperty({ description: "\uC804\uCCB4 \uC544\uC774\uD15C \uAC1C\uC218" })\r\n  @IsNumber()\r\n  totalItemsCount: number;\r\n}\r\n\r\nexport class PaginationResponseDTO<T> {\r\n  @ApiProperty({ type: Object, isArray: true })\r\n  items: T[];\r\n  @ApiProperty({ type: PageInfoDTO })\r\n  @Type(() => PageInfoDTO)\r\n  pageInfo: PageInfoDTO;\r\n}\r\n\r\nexport class PaginationOptionsDTO {\r\n  @ApiProperty({ description: "\uD398\uC774\uC9C0 \uBC88\uD638" })\r\n  @IsNotEmpty()\r\n  @IsNumber()\r\n  pageIndex: number;\r\n  @ApiProperty({ description: "\uD398\uC774\uC9C0 \uD06C\uAE30" })\r\n  @IsNotEmpty()\r\n  @IsNumber()\r\n  pageSize: number;\r\n  @ApiProperty({ description: "\uC815\uB82C \uAE30\uC900" })\r\n  @IsNotEmpty()\r\n  @IsString()\r\n  orderBy: string;\r\n  @ApiProperty({ description: "\uC815\uB82C \uBC29\uD5A5", enum: ["asc", "desc"] })\r\n  @IsNotEmpty()\r\n  @IsEnum(["asc", "desc"])\r\n  align: "asc" | "desc";\r\n  @ApiPropertyOptional({ description: "\uAC80\uC0C9\uC5B4" })\r\n  @IsOptional()\r\n  @IsString()\r\n  query?: string;\r\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"service",children:"service"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"async search(\r\n  options: PaginationOptionsDTO\r\n): Promise<PaginationResponseDTO<ExampleDTO>> {\r\n  const { items, count } = await this.prisma.$transaction(async (tx) => {\r\n    const where: Prisma.ExampleWhereInput = {\r\n        title: {\r\n          contains: options.query,\r\n        },\r\n    };\r\n    const items = await tx.example.findMany({\r\n      where,\r\n      orderBy: {\r\n        [options.orderBy || 'createdAt']: options.align || 'desc',\r\n      },\r\n      skip: (options.pageIndex - 1) * options.pageSize,\r\n      take: options.pageSize,\r\n    });\r\n\r\n    const count = await tx.example.count({ where });\r\n\r\n    const itemsWithRowNumber = items.map((item, index) => {\r\n      const rowNumber = count - options.pageSize * (options.pageIndex - 1) - index;\r\n      return { ...item, rowNumber };\r\n    });\r\n\r\n    return { items: itemsWithRowNumber, count };\r\n  });\r\n\r\n  return {\r\n    items: plainToInstance(ExampleDTO, items),\r\n    pageInfo: {\r\n      pageIndex: options.pageIndex,\r\n      pageSize: options.pageSize,\r\n      totalPageCount: Math.ceil(count / options.pageSize),\r\n      itemsOnPageCount: items.length,\r\n      totalItemsCount: count,\r\n    },\r\n  };\r\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"controller",children:"controller"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:"@Get('search')\r\n@ApiOperation({\r\n  summary: 'JobPosting \uAC80\uC0C9',\r\n})\r\n@ApiOkResponse({ type: PaginationResponseDTO<ExampleDTO> })\r\nasync search(@Query() query: PaginationOptionsDTO) {\r\n  return await this.jobPostingService.search(query);\r\n}\n"})})]})}function u(n={}){let{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},255511:function(n,e,r){r.d(e,{R:()=>i,x:()=>a});var t=r(596363);let s={},o=t.createContext(s);function i(n){let e=t.useContext(o);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);